Index: app.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+># app.py (final)\r\nfrom flask import Flask, render_template, request, redirect, url_for, flash, session, jsonify, current_app\r\nfrom dotenv import load_dotenv\r\nimport os\r\nimport pyodbc\r\nfrom datetime import datetime, timedelta, timezone, date, time as datetime_time\r\nimport webbrowser\r\nimport threading\r\nfrom dateutil import parser as dateparser  # pip install python-dateutil\r\n\r\nfrom dateutil.rrule import rrule, rruleset, DAILY, WEEKLY, MONTHLY\r\nfrom dateutil.relativedelta import relativedelta\r\n\r\n\r\nimport uuid\r\n\r\n\r\n\r\nfrom flask_login import (\r\n    LoginManager, UserMixin,\r\n    login_user, logout_user, login_required, current_user\r\n)\r\n\r\nfrom passlib.hash import bcrypt\r\nfrom ldap3 import Server, Connection, ALL\r\n\r\nload_dotenv()\r\n\r\nDB_HOST = os.getenv(\"DB_HOST\")\r\nDB_DATABASE = os.getenv(\"DB_DATABASE\")\r\nDB_USERNAME = os.getenv(\"DB_USERNAME\")\r\nDB_PASSWORD = os.getenv(\"DB_PASSWORD\")\r\nDB_ENCRYPT = os.getenv(\"DB_ENCRYPT\", \"no\")\r\nAD_SERVER = os.getenv(\"AD_SERVER\")\r\nAD_PORT = int(os.getenv(\"AD_PORT\", \"389\"))\r\nAD_USE_SSL = os.getenv(\"AD_USE_SSL\", \"no\").lower() == \"yes\"\r\nAD_USER_DOMAIN = os.getenv(\"AD_USER_DOMAIN\", \"\")\r\nAD_TEST_USER = os.getenv(\"AD_TEST_USER\")\r\nAD_TEST_PASS = os.getenv(\"AD_TEST_PASS\")\r\nFLASK_SECRET_KEY = os.getenv(\"FLASK_SECRET_KEY\")\r\n\r\napp = Flask(__name__)\r\napp.secret_key = FLASK_SECRET_KEY or os.urandom(24)\r\napp.permanent_session_lifetime = timedelta(days=7)\r\nNATIONAL_ADMINS = ['admin', 'systemadmin']  # add more if needed\r\n\r\n\r\ndef get_db_connection():\r\n    \"\"\"\r\n    Cross-platform SQL Server connection.\r\n    FreeTDS for Linux (Docker), ODBC17/18/NativeClient for Windows.\r\n    Compatible with SQL Server 2008.\r\n    \"\"\"\r\n    import platform\r\n\r\n    # --- Windows (PyCharm local dev) ---\r\n    if platform.system() == \"Windows\":\r\n        # Try Driver 17/18\r\n        possible_drivers = [\r\n            \"{ODBC Driver 18 for SQL Server}\",\r\n            \"{ODBC Driver 17 for SQL Server}\",\r\n            \"{SQL Server Native Client 11.0}\",\r\n            \"{SQL Server}\"\r\n        ]\r\n        driver = None\r\n\r\n        for d in possible_drivers:\r\n            try:\r\n                pyodbc.connect(\r\n                    f\"DRIVER={d};SERVER={DB_HOST};UID={DB_USERNAME};PWD={DB_PASSWORD};\",\r\n                    timeout=1\r\n                )\r\n                driver = d\r\n                break\r\n            except:\r\n                pass\r\n\r\n        if not driver:\r\n            raise Exception(\"No usable SQL Server ODBC driver found in Windows.\")\r\n\r\n        conn_str = (\r\n            f\"DRIVER={driver};\"\r\n            f\"SERVER={DB_HOST};\"\r\n            f\"DATABASE={DB_DATABASE};\"\r\n            f\"UID={DB_USERNAME};\"\r\n            f\"PWD={DB_PASSWORD};\"\r\n            \"Encrypt=no;\"\r\n            \"TrustServerCertificate=yes;\"\r\n        )\r\n        return pyodbc.connect(conn_str, autocommit=False)\r\n\r\n    # --- Linux (Docker) → Use FreeTDS ---\r\n    else:\r\n        conn_str = (\r\n            \"DRIVER={FreeTDS};\"\r\n            f\"SERVER={DB_HOST};\"\r\n            f\"DATABASE={DB_DATABASE};\"\r\n            f\"UID={DB_USERNAME};\"\r\n            f\"PWD={DB_PASSWORD};\"\r\n            \"Port=1433;\"\r\n            \"TDS_Version=7.3;\"\r\n        )\r\n        return pyodbc.connect(conn_str, autocommit=False)\r\n\r\n\r\n\r\nlogin_manager = LoginManager()\r\nlogin_manager.login_view = 'login'\r\nlogin_manager.init_app(app)\r\n\r\nclass User(UserMixin):\r\n    def __init__(self, id, username, email=None, display_name=None, role='user'):\r\n        self.id = str(id)\r\n        self.username = username\r\n        self.email = email\r\n        self.display_name = display_name or username\r\n        self.role = role\r\n\r\n    def is_admin(self):\r\n        return (self.role or '').lower() == 'admin'\r\n\r\ndef rows_to_dicts(cursor):\r\n    columns = [col[0] for col in cursor.description]\r\n    return [dict(zip(columns, row)) for row in cursor.fetchall()]\r\n\r\ndef get_group_approver(group_code):\r\n    try:\r\n        conn = get_db_connection(); cur = conn.cursor()\r\n        cur.execute(\"SELECT TOP 1 approver_username FROM dbo.group_approvers WHERE group_code = ? AND is_primary = 1 ORDER BY id DESC\", (group_code,))\r\n        row = cur.fetchone(); conn.close()\r\n        return row[0] if row else None\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F get_group_approver error:\", e)\r\n        return None\r\ndef get_approvers_for_location(location_name):\r\n    \"\"\"\r\n    Returns list of approvers for a given location.\r\n    Uses group_approvers table where group_code == location_name.\r\n    Only returns active approvers.\r\n    \"\"\"\r\n    print(\"⚠\uFE0F Approver Location_name:\", location_name)\r\n    try:\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n        cur.execute(\"\"\"\r\n            SELECT approver_username\r\n            FROM dbo.group_approvers (NOLOCK) \r\n            WHERE group_code = ? AND is_active = 1\r\n        \"\"\", (location_name,))\r\n        rows = cur.fetchall()\r\n        conn.close()\r\n        return [r[0] for r in rows]\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F get_approvers_for_location error:\", e)\r\n        return []\r\n\r\ndef is_user_group_admin(username, group_code):\r\n    try:\r\n        conn = get_db_connection(); cur = conn.cursor()\r\n        cur.execute(\"SELECT COUNT(*) FROM dbo.group_approvers WHERE group_code = ? AND approver_username = ?\", (group_code, username))\r\n        row = cur.fetchone(); conn.close()\r\n        return (row[0] if row else 0) > 0\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F is_user_group_admin error:\", e)\r\n        return False\r\n# is_admin = (current_user.username.lower() == \"admin\")\r\n@app.route('/approvals/<int:res_id>/approve', methods=['POST'])\r\n@login_required\r\ndef approve_reservation(res_id):\r\n    username = current_user.username.lower()\r\n\r\n    is_national_admin = username in [a.lower() for a in NATIONAL_ADMINS]\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n    # Load user's assigned locations\r\n    cur = conn.cursor()\r\n    cur.execute(\"\"\"\r\n        SELECT ul.location_name\r\n        FROM user_locations ul\r\n        JOIN users u ON ul.user_id = u.id\r\n        WHERE u.username = ?\r\n    \"\"\", (username,))\r\n    assigned_locations = [row[0] for row in cur.fetchall()]\r\n\r\n\r\n    # Fetch reservation + location\r\n    cur.execute(\"\"\"\r\n        SELECT r.room_id, rm.location, r.status\r\n        FROM reservations r\r\n        JOIN rooms rm ON r.room_id = rm.id\r\n        WHERE r.id = ?\r\n    \"\"\", (res_id,))\r\n    row = cur.fetchone()\r\n\r\n    if not row:\r\n        conn.close()\r\n        flash(\"Reservation not found.\", \"danger\")\r\n        return redirect(url_for('approvals'))\r\n\r\n    room_id, location, status = row\r\n\r\n    if status != 'Pending':\r\n        conn.close()\r\n        flash(\"Reservation no longer pending.\", \"warning\")\r\n        return redirect(url_for('approvals'))\r\n\r\n    # National admin → full approve rights\r\n    if is_national_admin:\r\n        cur.execute(\"\"\"\r\n            UPDATE reservations\r\n            SET status='Approved', approved_by=?, approved_at=GETDATE()\r\n            WHERE id=?\r\n        \"\"\", (username, res_id))\r\n        conn.commit()\r\n        conn.close()\r\n        flash(\"✔ Approved (National Admin)\", \"success\")\r\n        return redirect(url_for('approvals'))\r\n\r\n    # Local approver check\r\n    cur.execute(\"\"\"\r\n        SELECT COUNT(*)\r\n        FROM group_approvers\r\n        WHERE group_code = ? AND approver_username = ? AND is_active = 1\r\n    \"\"\", (location, username))\r\n    (is_approver,) = cur.fetchone()\r\n\r\n    # Location assignment check\r\n    cur.execute(\"\"\"\r\n        SELECT COUNT(*)\r\n        FROM user_locations ul\r\n        JOIN users u ON ul.user_id = u.id\r\n        WHERE ul.location_name = ? AND u.username = ?\r\n    \"\"\", (location, username))\r\n    (in_location,) = cur.fetchone()\r\n\r\n    # # Load user’s assigned locations\r\n    # cur = conn.cursor()\r\n    # cur.execute(\"\"\"\r\n    #     SELECT ul.location_name\r\n    #     FROM user_locations ul\r\n    #     JOIN users u ON ul.user_id = u.id\r\n    #     WHERE u.username = ?\r\n    # \"\"\", (username,))\r\n    # assigned_locations = [row[0] for row in cur.fetchall()]\r\n\r\n    if not (is_approver and in_location):\r\n        conn.close()\r\n        flash(\"❌ You are not authorized to approve this reservation.\", \"danger\")\r\n        return redirect(url_for('approvals'))\r\n\r\n    # Authorized approver approves\r\n    cur.execute(\"\"\"\r\n        UPDATE reservations\r\n        SET status='Approved', approved_by=?, approved_at=GETDATE()\r\n        WHERE id=?\r\n    \"\"\", (username, res_id))\r\n    conn.commit()\r\n    conn.close()\r\n\r\n    flash(\"✔ Reservation approved\", \"success\")\r\n    return redirect(url_for('approvals'))\r\n\r\n@app.route('/approvals')\r\n@login_required\r\ndef approvals():\r\n    username = current_user.username.lower()\r\n    is_national_admin = username in [a.lower() for a in NATIONAL_ADMINS]\r\n\r\n    filter_location = request.args.get(\"location\", \"\").strip()\r\n    filter_room = request.args.get(\"room\", \"\").strip()\r\n    search_text = request.args.get(\"search\", \"\").strip()\r\n    filter_date = request.args.get(\"date\", \"\").strip()\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    # Load user’s assigned locations (SECTION C1)\r\n    cur.execute(\"\"\"\r\n        SELECT ul.location_name\r\n        FROM user_locations ul\r\n        JOIN users u ON ul.user_id = u.id\r\n        WHERE u.username = ?\r\n    \"\"\", (username,))\r\n    assigned_locations = [row[0] for row in cur.fetchall()]\r\n\r\n    # Base SQL\r\n    sql = \"\"\"\r\n        SELECT r.id, r.room_id, rm.name AS room_name, rm.location,\r\n               r.reserved_by, r.start_time, r.end_time, r.remarks,\r\n               r.status, r.approver_username\r\n        FROM dbo.reservations r\r\n        JOIN dbo.rooms rm ON r.room_id = rm.id\r\n        WHERE r.status = 'Pending'\r\n    \"\"\"\r\n    params = []\r\n\r\n    # National admin sees ALL\r\n    if not is_national_admin:\r\n        sql += \"\"\"\r\n            AND (\r\n                r.approver_username = ?\r\n                OR ? IN (\r\n                    SELECT approver_username\r\n                    FROM dbo.group_approvers\r\n                    WHERE group_code = rm.location AND is_active = 1\r\n                )\r\n            )\r\n            AND rm.location IN (\r\n                SELECT ul.location_name \r\n                FROM user_locations ul \r\n                JOIN users u ON ul.user_id = u.id\r\n                WHERE u.username = ?\r\n            )\r\n        \"\"\"\r\n        params.extend([username, username, username])\r\n\r\n    # Filters\r\n    if filter_location:\r\n        sql += \" AND rm.location = ?\"\r\n        params.append(filter_location)\r\n\r\n    if filter_room:\r\n        sql += \" AND rm.name = ?\"\r\n        params.append(filter_room)\r\n\r\n    if filter_date:\r\n        sql += \" AND CAST(r.start_time AS DATE) = ?\"\r\n        params.append(filter_date)\r\n\r\n    if search_text:\r\n        sql += \" AND (r.reserved_by LIKE ? OR rm.name LIKE ? OR r.remarks LIKE ?)\"\r\n        s = f\"%{search_text}%\"\r\n        params.extend([s, s, s])\r\n\r\n    sql += \" ORDER BY rm.location, r.start_time\"\r\n    print(sql)\r\n    cur.execute(sql, params)\r\n    rows = rows_to_dicts(cur)\r\n\r\n    # Dropdown lists\r\n    cur.execute(\"SELECT DISTINCT location FROM rooms ORDER BY location\")\r\n    locations = [r[0] for r in cur.fetchall()]\r\n\r\n    cur.execute(\"SELECT DISTINCT name FROM rooms ORDER BY name\")\r\n    rooms = [r[0] for r in cur.fetchall()]\r\n\r\n    # Pending count for sidebar\r\n    cur.execute(\"SELECT COUNT(*) FROM reservations WHERE status='Pending'\")\r\n    (pending_count,) = cur.fetchone()\r\n\r\n    conn.close()\r\n\r\n    # PASS assigned_locations TO TEMPLATE (SECTION C2)\r\n    return render_template(\r\n        \"approvals.html\",\r\n        reservations=rows,\r\n        locations=locations,\r\n        rooms=rooms,\r\n        assigned_locations=assigned_locations,\r\n        pending_count=pending_count,\r\n        filter_location=filter_location,\r\n        filter_room=filter_room,\r\n        filter_date=filter_date,\r\n        search_text=search_text,\r\n        is_admin=is_national_admin\r\n    )\r\n\r\n\r\n\r\n@app.route('/reservation/<int:reservation_id>/<string:action>', methods=['GET'])\r\n@login_required\r\ndef update_reservation_status(reservation_id, action):\r\n    try:\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n\r\n        if action == 'approve':\r\n            cur.execute(\"\"\"\r\n                UPDATE reservations\r\n                SET status = 'Approved', updated_at = GETDATE()\r\n                WHERE id = ?\r\n            \"\"\", (reservation_id,))\r\n            conn.commit()\r\n            flash(\"✅ Reservation approved successfully!\", \"success\")\r\n\r\n        elif action == 'cancel':\r\n            cur.execute(\"\"\"\r\n                UPDATE reservations\r\n                SET status = 'Cancelled', updated_at = GETDATE()\r\n                WHERE id = ?\r\n            \"\"\", (reservation_id,))\r\n            conn.commit()\r\n            flash(\"❌ Reservation cancelled.\", \"warning\")\r\n\r\n        conn.close()\r\n    except Exception as e:\r\n        print(f\"⚠\uFE0F Error updating reservation: {e}\")\r\n        flash(\"⚠\uFE0F Error while updating reservation.\", \"danger\")\r\n\r\n    return redirect(url_for('admin_dashboard'))\r\n\r\n@app.route('/approvals/<int:res_id>/deny', methods=['POST'])\r\n@login_required\r\ndef deny_reservation(res_id):\r\n    username = current_user.username.lower()\r\n    is_national_admin = username in [a.lower() for a in NATIONAL_ADMINS]\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    cur.execute(\"\"\"\r\n        SELECT r.room_id, rm.location, r.status\r\n        FROM reservations r (NOLOCK)\r\n        JOIN rooms rm ON r.room_id = rm.id\r\n        WHERE r.id = ?\r\n    \"\"\", (res_id,))\r\n    row = cur.fetchone()\r\n\r\n    if not row:\r\n        conn.close()\r\n        flash(\"Not found\", \"danger\")\r\n        return redirect(url_for('approvals'))\r\n\r\n    room_id, location, status = row\r\n\r\n    if status != 'Pending':\r\n        conn.close()\r\n        flash(\"Reservation not pending.\", \"warning\")\r\n        return redirect(url_for('approvals'))\r\n\r\n    if is_national_admin:\r\n        cur.execute(\"\"\"\r\n            UPDATE reservations\r\n            SET status='Cancelled', approved_by=?, approved_at=GETDATE()\r\n            WHERE id=?\r\n        \"\"\", (username, res_id))\r\n        conn.commit()\r\n        conn.close()\r\n        flash(\"❌ Denied (National Admin)\", \"info\")\r\n        return redirect(url_for('approvals'))\r\n\r\n    cur.execute(\"\"\"\r\n        SELECT COUNT(*)\r\n        FROM group_approvers\r\n        WHERE group_code = ? AND approver_username = ? AND is_active = 1\r\n    \"\"\", (location, username))\r\n    (is_approver,) = cur.fetchone()\r\n\r\n    cur.execute(\"\"\"\r\n        SELECT COUNT(*)\r\n        FROM user_locations ul\r\n        JOIN users u ON ul.user_id = u.id\r\n        WHERE ul.location_name = ? AND u.username = ?\r\n    \"\"\", (location, username))\r\n    (in_location,) = cur.fetchone()\r\n\r\n    if not (is_approver and in_location):\r\n        conn.close()\r\n        flash(\"❌ Not authorized to deny this.\", \"danger\")\r\n        return redirect(url_for('approvals'))\r\n\r\n    cur.execute(\"\"\"\r\n        UPDATE reservations\r\n        SET status='Cancelled', approved_by=?, approved_at=GETDATE()\r\n        WHERE id=?\r\n    \"\"\", (username, res_id))\r\n    conn.commit()\r\n    conn.close()\r\n\r\n    flash(\"❌ Reservation denied\", \"info\")\r\n    return redirect(url_for('approvals'))\r\n\r\n@login_manager.user_loader\r\ndef load_user(user_id):\r\n    try:\r\n        conn = get_db_connection(); cursor = conn.cursor()\r\n        cursor.execute(\"SELECT id, username, email, display_name, role FROM dbo.users WHERE id = ?\", (int(user_id),))\r\n        row = cursor.fetchone(); conn.close()\r\n        if row:\r\n            uid, username, email, display_name, role = row\r\n            return User(uid, username, email, display_name, role)\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F load_user error:\", e)\r\n    return None\r\n\r\ndef log_audit(action, details=None):\r\n    try:\r\n        conn = get_db_connection(); cursor = conn.cursor()\r\n        username = \"system\"\r\n        try:\r\n            if current_user and getattr(current_user, \"is_authenticated\", False):\r\n                username = current_user.username\r\n        except Exception:\r\n            username = \"system\"\r\n        ip = request.remote_addr if request else \"127.0.0.1\"\r\n        try:\r\n            cursor.execute(\"\"\"\r\n                INSERT INTO dbo.audit_log (username, action, details, ip_address)\r\n                VALUES (?, ?, ?, ?)\r\n            \"\"\", (username, action, details, ip))\r\n            conn.commit()\r\n        except Exception as e:\r\n            print(\"⚠\uFE0F Audit log insert failed (check dbo.audit_log exists):\", e)\r\n        finally:\r\n            conn.close()\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F Audit logging failed (DB connection):\", e)\r\n\r\ndef ensure_default_admin():\r\n    try:\r\n        conn = get_db_connection(); cursor = conn.cursor()\r\n        cursor.execute(\"SELECT COUNT(*) FROM dbo.users WHERE role = 'admin'\")\r\n        row = cursor.fetchone(); admin_count = row[0] if row else 0\r\n        if admin_count == 0:\r\n            default_admin = \"admin\"\r\n            cursor.execute(\"\"\"\r\n                INSERT INTO dbo.users (username, display_name, email, role, status)\r\n                VALUES (?, ?, ?, 'admin', 'active')\r\n            \"\"\", (default_admin, 'System Administrator', f'{default_admin}@{AD_USER_DOMAIN or \"local\"}'))\r\n            conn.commit()\r\n            print(f\"\uD83D\uDEE0\uFE0F Default admin '{default_admin}' created.\")\r\n        conn.close()\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F ensure_default_admin error:\", e)\r\n\r\ndef authenticate_local(username, password):\r\n    try:\r\n        conn = get_db_connection(); cursor = conn.cursor()\r\n        cursor.execute(\"SELECT id, username, password_hash, email, display_name, role FROM dbo.users WHERE username = ?\", (username,))\r\n        row = cursor.fetchone(); conn.close()\r\n        if not row:\r\n            return None\r\n        uid, uname, pw_hash, email, display_name, role = row\r\n        if not pw_hash:\r\n            return None\r\n        if bcrypt.verify(password, pw_hash):\r\n            return User(uid, uname, email, display_name, role)\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F authenticate_local error:\", e)\r\n    return None\r\n\r\ndef authenticate_ldap(username, password, timeout=3):\r\n    if not AD_SERVER:\r\n        return False\r\n    user_principal = username if ('@' in username or '\\\\' in username) else f\"{username}@{AD_USER_DOMAIN}\" if AD_USER_DOMAIN else username\r\n    try:\r\n        server = Server(AD_SERVER, port=AD_PORT, use_ssl=AD_USE_SSL, get_info=ALL, connect_timeout=timeout)\r\n        conn_ldap = Connection(server, user=user_principal, password=password, auto_bind=True)\r\n        conn_ldap.unbind()\r\n        return True\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F LDAP bind failed:\", e)\r\n        return False\r\ndef is_approval_required_for_room(room_id):\r\n    try:\r\n        conn = get_db_connection(); cur = conn.cursor()\r\n        cur.execute(\"SELECT approvals_required, location FROM rooms WHERE id = ?\", (room_id,))\r\n        row = cur.fetchone()\r\n        conn.close()\r\n\r\n        if not row:\r\n            return True  # default safety\r\n\r\n        room_flag = row[0]     # may be NULL\r\n        location = row[1]\r\n\r\n        # room override\r\n        if room_flag is not None:\r\n            return bool(room_flag)\r\n\r\n        # fallback: location approval rule\r\n        conn = get_db_connection(); cur = conn.cursor()\r\n        cur.execute(\"SELECT approvals_required FROM locations WHERE name = ?\", (location,))\r\n        loc_row = cur.fetchone()\r\n        conn.close()\r\n\r\n        if loc_row is not None:\r\n            return bool(loc_row[0])\r\n\r\n        return True\r\n    except:\r\n        return True\r\n\r\n\r\n@app.route('/login', methods=['GET', 'POST'])\r\ndef login():\r\n    if current_user.is_authenticated:\r\n        return redirect(url_for('main_menu'))\r\n    if request.method == 'POST':\r\n        username = request.form.get('username', '').strip()\r\n        password = request.form.get('password', '').strip()\r\n        remember = bool(request.form.get('remember'))\r\n        if not username or not password:\r\n            flash(\"Please enter username and password.\")\r\n            return redirect(url_for('login'))\r\n        user = None\r\n        ad_ok = False\r\n        if AD_SERVER:\r\n             ad_ok = True\r\n            # ad_ok = authenticate_ldap(username, password)\r\n        if ad_ok:\r\n            conn = get_db_connection(); cursor = conn.cursor()\r\n            cursor.execute(\"SELECT id, username, email, display_name, role FROM dbo.users WHERE username = ?\", (username,))\r\n            row = cursor.fetchone(); conn.close()\r\n            if row:\r\n                uid, uname, email, display_name, role = row\r\n                user = User(uid, uname, email, display_name, role)\r\n        else:\r\n            user = authenticate_local(username, password)\r\n        if not user:\r\n            flash(\"❌ Invalid username or password.\")\r\n            log_audit(\"LOGIN_FAILED\", f\"Failed login for {username}\")\r\n            return redirect(url_for('login'))\r\n        login_user(user, remember=remember)\r\n        log_audit(\"LOGIN_SUCCESS\", f\"User {user.username} logged in\")\r\n        flash(f\"✅ Welcome {user.display_name or user.username}!\")\r\n        return redirect(url_for('main_menu'))\r\n    return render_template('login.html')\r\n\r\n@app.route('/logout')\r\n@login_required\r\ndef logout():\r\n    log_audit(\"LOGOUT\", f\"User {current_user.username} logged out.\")\r\n    logout_user()\r\n    flash(\"You have been logged out successfully.\")\r\n    return redirect(url_for('login'))\r\n\r\n@app.route('/rooms/maintenance')\r\n@login_required\r\ndef room_maintenance():\r\n    if not current_user.is_admin():\r\n        flash(\"Not authorized.\", \"danger\")\r\n        return redirect(url_for('main_menu'))\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    # Load rooms\r\n    # cur.execute(\"\"\"\r\n    #     SELECT id, name, location, group_code, capacity, is_combined, status,\r\n    #            approvals_required\r\n    #     FROM rooms\r\n    #     ORDER BY location, name\r\n    # \"\"\")\r\n    cur.execute(\"\"\"\r\n        SELECT id, name, location, group_code, capacity, is_combined, status,\r\n            CASE\r\n            WHEN r.approvals_required IS NULL THEN 'auto'\r\n            WHEN r.approvals_required = 1 THEN 'yes'\r\n            ELSE 'no'\r\n          END AS approvals_required, features\r\n            FROM rooms r WITH (NOLOCK)\r\n            WHERE  EXISTS (\r\n            SELECT 1\r\n            FROM dbo.user_locations ul WITH (NOLOCK)\r\n            JOIN dbo.users u WITH (NOLOCK) ON ul.user_id = u.id\r\n            WHERE u.username = ?\r\n            AND ul.location_name = r.location\r\n            )\r\n            ORDER BY location, name\r\n    \"\"\",current_user.username)\r\n    rooms = rows_to_dicts(cur)\r\n    # Load locations for dropdowns\r\n    cur.execute(\"\"\"SELECT DISTINCT location FROM rooms r WHERE  EXISTS (\r\n            SELECT 1\r\n            FROM dbo.user_locations ul WITH (NOLOCK)\r\n            JOIN dbo.users u WITH (NOLOCK) ON ul.user_id = u.id\r\n            WHERE u.username = ?\r\n            AND ul.location_name = r.location\r\n            ) ORDER BY location\"\"\", current_user.username)\r\n\r\n    locations = [row[0] for row in cur.fetchall()]\r\n\r\n    # Try to load room_approvers if table exists, otherwise keep empty dict\r\n    room_approvers = {}\r\n    try:\r\n        cur.execute(\"\"\"\r\n            SELECT room_id, approver_username\r\n            FROM room_approvers\r\n            WHERE is_active = 1\r\n        \"\"\")\r\n        for r in cur.fetchall():\r\n            room_id = r[0]\r\n            approver = r[1]\r\n            room_approvers.setdefault(room_id, []).append(approver)\r\n    except Exception as e:\r\n        # If table missing or other error, log and continue with empty approvers map\r\n        print(\"⚠\uFE0F room_approvers not available or query failed:\", e)\r\n        room_approvers = {}\r\n\r\n    conn.close()\r\n\r\n    return render_template(\r\n        \"room_maintenance.html\",\r\n        rooms=rooms,\r\n        locations=locations,\r\n        room_approvers=room_approvers\r\n    )\r\n\r\n\r\n@app.route('/rooms/add', methods=['POST'])\r\n@login_required\r\ndef add_room():\r\n    if not getattr(current_user, 'is_admin', lambda: False)():\r\n        flash(\"Not authorized.\", \"danger\"); return redirect(url_for('menu'))\r\n    name = request.form['name']\r\n    group_code = request.form.get('group_code') or None\r\n    capacity = int(request.form.get('capacity') or 0)\r\n    approver = request.form.get('approver') or None\r\n    is_combined = 1 if request.form.get('is_combined') else 0\r\n    features = request.form.get('features') or None\r\n    conn = get_db_connection(); cur = conn.cursor()\r\n    cur.execute(\"INSERT INTO dbo.rooms (name, location, capacity, group_code, description, status, is_combined,features) VALUES (?, ?, ?, ?, ?, 'Active', ?,?)\",\r\n                (name, group_code or name, capacity, group_code, '', is_combined,features))\r\n    conn.commit()\r\n    if approver and group_code:\r\n        cur.execute(\"INSERT INTO dbo.group_approvers (group_code, approver_username, is_primary) VALUES (?, ?, 1)\", (group_code, approver))\r\n        conn.commit()\r\n    conn.close()\r\n    flash(\"Room added.\", \"success\")\r\n    return redirect(url_for('room_maintenance'))\r\n\r\n@app.route('/rooms/edit/<int:id>', methods=['POST'])\r\n@login_required\r\ndef edit_room(id):\r\n    if getattr(current_user, 'role', '').lower() != 'admin':\r\n        flash(\"Not authorized.\", \"danger\")\r\n        return redirect(url_for('room_maintenance'))\r\n    name = request.form['name']\r\n    location = request.form['location']\r\n    group_code = request.form.get('group_code') or None\r\n    capacity = int(request.form.get('capacity') or 0)\r\n    is_combined = 1 if request.form.get('is_combined') else 0\r\n    approvals_raw = (request.form.get('approvals_required') or 'auto').lower().strip()\r\n    features = request.form.get('features') or None\r\n    status = request.form.get('status') or None\r\n    # If approvals_required column is BIT/NULL (recommended):\r\n    approvals_required = None\r\n    if approvals_raw == \"true\":\r\n        approvals_required = 1\r\n    elif approvals_raw == \"no\":\r\n        approvals_required = 0\r\n    # else \"auto\" -> NULL\r\n    conn = get_db_connection(); cur = conn.cursor()\r\n    cur.execute(\"\"\"\r\n        UPDATE dbo.rooms\r\n        SET name=?, location=?, group_code=?, capacity=?, is_combined=?, approvals_required=?, features=?,status=?\r\n        WHERE id=?\r\n    \"\"\", (name, location, group_code, capacity, is_combined,approvals_required, features,status,id))\r\n    conn.commit(); conn.close()\r\n    flash(\"✅ Room updated successfully.\", \"success\")\r\n    return redirect(url_for('room_maintenance'))\r\n\r\n@app.route('/rooms/deactivate/<int:id>')\r\n@login_required\r\ndef deactivate_room(id):\r\n    if not getattr(current_user, 'is_admin', lambda: False)():\r\n        flash(\"Not authorized.\", \"danger\"); return redirect(url_for('menu'))\r\n    conn = get_db_connection(); cur = conn.cursor()\r\n    cur.execute(\"UPDATE dbo.rooms SET status = 'Inactive' WHERE id = ?\", (id,))\r\n    conn.commit(); conn.close()\r\n    flash(\"Room deactivated.\", \"warning\")\r\n    return redirect(url_for('room_maintenance'))\r\n\r\n\r\n\r\ndef get_room_availability_for_date(room_id, date,\r\n                                   start_hour=None, end_hour=None):\r\n    # Default fallback from .env if not provided\r\n    if start_hour is None:\r\n        start_hour = int(os.getenv(\"TIMELINE_START\", 6))\r\n    if end_hour is None:\r\n        end_hour = int(os.getenv(\"TIMELINE_END\", 22))\r\n\r\n    conn = get_db_connection()\r\n    cursor = conn.cursor()\r\n\r\n    cursor.execute(\"\"\"\r\n        SELECT id, reserved_by, email, start_time, end_time,\r\n               status, remarks, recurrence_id\r\n        FROM reservations (NOLOCK)\r\n        WHERE room_id = ?\r\n          AND CAST(start_time AS DATE) = ?\r\n    \"\"\", (room_id, date))\r\n\r\n    rows = cursor.fetchall()\r\n\r\n    slots = {}\r\n    for hour in range(start_hour, end_hour):\r\n        for minute in [0, 30]:\r\n            t = f\"{hour:02d}:{minute:02d}\"\r\n            slots[t] = \"available\"\r\n\r\n    for r in rows:\r\n        st = r.start_time\r\n        et = r.end_time\r\n\r\n        cur = datetime.combine(date, datetime_time(start_hour, 0))\r\n        end_day = datetime.combine(date, datetime_time(end_hour, 0))\r\n\r\n        while cur < end_day:\r\n            slot = cur.strftime(\"%H:%M\")\r\n            if st <= cur < et:\r\n                slots[slot] = {\r\n                    \"status\": r.status.lower(),\r\n                    \"by\": r.reserved_by,\r\n                    \"remarks\": r.remarks,\r\n                    \"id\": r.id,\r\n                    \"reserved_by\": r.reserved_by\r\n                }\r\n            cur += timedelta(minutes=30)\r\n\r\n    return slots\r\n\r\n\r\ndef get_all_room_ids():\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n    cur.execute(\"SELECT id FROM rooms (NOLOCK) WHERE status='Active'\")\r\n    rows = cur.fetchall()\r\n    conn.close()\r\n    return [r[0] for r in rows]\r\n\r\n\r\n# --- ROOM LIST WITH LOCATION + ROOM FILTERING -------------------------------\r\n# --- ROOM LIST (FINAL PATCH) ---------------------------------------------------\r\n# --- ROOM LIST (HARDENED PATCH) --------------------------------------------\r\nimport traceback\r\nfrom datetime import date, timedelta\r\n\r\n@app.route(\"/rooms\")\r\n@login_required\r\ndef room_list():\r\n    try:\r\n        # ----------------------------------------\r\n        # 1. READ INPUTS (safe)\r\n        # ----------------------------------------\r\n        raw_date = request.args.get(\"date\") or date.today().isoformat()\r\n        selected_location = request.args.get(\"location\", \"all\")\r\n        selected_room = request.args.get(\"room\", \"all\")\r\n        focus_room = request.args.get(\"focus\")\r\n\r\n        # parse date safely (fall back to today if invalid)\r\n        try:\r\n            view_date = date.fromisoformat(raw_date)\r\n        except Exception:\r\n            # invalid incoming date format, fallback to today\r\n            view_date = date.today()\r\n            raw_date = view_date.isoformat()\r\n\r\n        # timeline range (ints)\r\n        start_hour = int(os.getenv(\"TIMELINE_START\", 6))\r\n        end_hour = int(os.getenv(\"TIMELINE_END\", 22))\r\n\r\n        # ----------------------------------------\r\n        # 2. DB CONNECTION\r\n        # ----------------------------------------\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n\r\n        # ----------------------------------------\r\n        # 3. GET USER-ASSIGNED LOCATIONS\r\n        # ----------------------------------------\r\n        if current_user.is_admin():\r\n            cur.execute(\"SELECT DISTINCT location FROM rooms WHERE status='Active'\")\r\n            allowed_locations = [r[0] for r in cur.fetchall()]\r\n        else:\r\n            cur.execute(\"\"\"\r\n                SELECT DISTINCT ul.location_name\r\n                FROM user_locations ul\r\n                WHERE ul.user_id = ?\r\n            \"\"\", (current_user.id,))\r\n            allowed_locations = [r[0] for r in cur.fetchall()]\r\n\r\n        # safe default if nothing found\r\n        if not allowed_locations:\r\n            allowed_locations = [\"Axis T1\"]\r\n\r\n        # ----------------------------------------\r\n        # 4. GET ALL ROOMS UNDER ALLOWED LOCATIONS\r\n        # ----------------------------------------\r\n        placeholders = \",\".join([\"?\"] * len(allowed_locations))\r\n        sql = f\"\"\"\r\n            SELECT id, name, location, capacity, description,\r\n                   group_code, is_combined\r\n            FROM rooms\r\n            WHERE status='Active'\r\n              AND location IN ({placeholders})\r\n            ORDER BY location, name\r\n        \"\"\"\r\n        cur.execute(sql, tuple(allowed_locations))\r\n        rows = cur.fetchall()\r\n\r\n        all_rooms = [\r\n            {\r\n                \"id\": r[0],\r\n                \"name\": r[1],\r\n                \"location\": r[2],\r\n                \"capacity\": r[3],\r\n                \"description\": r[4],\r\n                \"group_code\": r[5],\r\n                \"is_combined\": bool(r[6]),\r\n            }\r\n            for r in rows\r\n        ]\r\n\r\n        # ----------------------------------------\r\n        # 5. APPLY LOCATION FILTER\r\n        # ----------------------------------------\r\n        if selected_location != \"all\":\r\n            filtered_rooms = [r for r in all_rooms if r[\"location\"] == selected_location]\r\n        else:\r\n            filtered_rooms = all_rooms[:]\r\n\r\n        # ----------------------------------------\r\n        # 6. APPLY ROOM FILTER\r\n        # ----------------------------------------\r\n        if selected_room != \"all\":\r\n            rooms = [r for r in filtered_rooms if r[\"name\"] == selected_room]\r\n        else:\r\n            rooms = filtered_rooms[:]\r\n\r\n        # if no rooms left, show empty timeline (no DB reservations)\r\n        if not rooms:\r\n            conn.close()\r\n            return render_template(\r\n                \"index.html\",\r\n                rooms=[],\r\n                all_rooms=all_rooms,\r\n                allowed_locations=allowed_locations,\r\n                availability={},\r\n                selected_date=view_date,\r\n                selected_room=selected_room,\r\n                selected_location=selected_location,\r\n                focus_room=focus_room,\r\n                start_hour=start_hour,\r\n                end_hour=end_hour,\r\n            )\r\n\r\n        room_ids = [r[\"id\"] for r in rooms]\r\n\r\n        # ----------------------------------------\r\n        # 7. LOAD RESERVATIONS FOR SELECTED DATE\r\n        # ----------------------------------------\r\n        placeholders = \",\".join([\"?\"] * (1 + len(room_ids)))  # one for date + N room ids\r\n        sql = f\"\"\"\r\n            SELECT id, room_id, reserved_by, start_time, end_time,\r\n                   status, remarks\r\n            FROM reservations\r\n            WHERE CAST(start_time AS DATE) = ?\r\n              AND room_id IN ({','.join(['?']*len(room_ids))})\r\n        \"\"\"\r\n        params = [raw_date] + room_ids\r\n        cur.execute(sql, params)\r\n        reservations = cur.fetchall()\r\n\r\n        # ----------------------------------------\r\n        # 8. BUILD AVAILABILITY GRID\r\n        # ----------------------------------------\r\n        availability = {rid: {} for rid in room_ids}\r\n        for r in rooms:\r\n            for hour in range(start_hour, end_hour):\r\n                for minute in (0, 30):\r\n                    t = f\"{hour:02d}:{minute:02d}\"\r\n                    availability[r[\"id\"]][t] = {\r\n                        \"status\": \"available\",\r\n                        \"reserved_by\": \"\",\r\n                        \"remarks\": \"\",\r\n                        \"id\": \"\",\r\n                    }\r\n\r\n        # Apply reservations to availability\r\n        for (res_id, rid, by, s, e, status, remarks) in reservations:\r\n            cur_time = s\r\n            while cur_time < e:\r\n                t = cur_time.strftime(\"%H:%M\")\r\n                if rid in availability and t in availability[rid]:\r\n                    availability[rid][t] = {\r\n                        \"status\": (status or \"booked\").lower(),\r\n                        \"reserved_by\": by or \"\",\r\n                        \"remarks\": remarks or \"\",\r\n                        \"id\": res_id,\r\n                    }\r\n                cur_time += timedelta(minutes=30)\r\n\r\n        conn.close()\r\n\r\n        return render_template(\r\n            \"index.html\",\r\n            rooms=rooms,\r\n            all_rooms=all_rooms,\r\n            allowed_locations=allowed_locations,\r\n            availability=availability,\r\n            selected_room=selected_room,\r\n            selected_location=selected_location,\r\n            selected_date=view_date,\r\n            focus_room=focus_room,\r\n            start_hour=start_hour,\r\n            end_hour=end_hour,\r\n        )\r\n\r\n    except Exception as exc:\r\n        # log full traceback to server log so you can troubleshoot in prod\r\n        traceback.print_exc()\r\n        # return a friendly page instead of raw 500 text (helps avoid blank white)\r\n        try:\r\n            return render_template(\r\n                \"index.html\",\r\n                rooms=[],\r\n                all_rooms=[],\r\n                allowed_locations=[],\r\n                availability={},\r\n                selected_date=date.today(),\r\n                selected_room=\"all\",\r\n                selected_location=\"all\",\r\n                focus_room=None,\r\n                start_hour=int(os.getenv(\"TIMELINE_START\", 6)),\r\n                end_hour=int(os.getenv(\"TIMELINE_END\", 22)),\r\n                error_message=\"An unexpected server error occurred. Administrators have been notified.\"\r\n            ), 500\r\n        except Exception:\r\n            # fallback: simple text response\r\n            return \"Internal Server Error\", 500\r\n\r\n# This is for the View route in new module\r\n@app.route('/reserve_v2', methods=['GET'])\r\n@login_required\r\ndef reserve_v2():\r\n    import json\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    # 1. Get user-assigned locations\r\n    if current_user.is_admin():\r\n        cur.execute(\"SELECT DISTINCT location FROM rooms WHERE status='Active'\")\r\n        allowed_locations = [r[0] for r in cur.fetchall()]\r\n    else:\r\n        cur.execute(\"\"\"\r\n            SELECT DISTINCT ul.location_name\r\n            FROM user_locations ul\r\n            WHERE ul.user_id = ?\r\n        \"\"\", (current_user.id,))\r\n        allowed_locations = [r[0] for r in cur.fetchall()]\r\n\r\n    if not allowed_locations:\r\n        allowed_locations = [\"Axis T1\"]\r\n\r\n    # 2. Get all rooms under allowed locations\r\n    placeholders = \",\".join([\"?\"] * len(allowed_locations))\r\n    sql = f\"\"\"\r\n        SELECT id, name, location, ISNULL(features,'') AS features\r\n        FROM rooms\r\n        WHERE status='Active'\r\n          AND location IN ({placeholders})\r\n        ORDER BY location, name\r\n    \"\"\"\r\n    cur.execute(sql, tuple(allowed_locations))\r\n    rows = cur.fetchall()\r\n    conn.close()\r\n\r\n    rooms = []\r\n    locations_set = set()\r\n\r\n    for r in rows:\r\n        rooms.append({\r\n            \"id\": int(r[0]),\r\n            \"name\": r[1],\r\n            \"location\": r[2] or \"General\",\r\n            \"features\": r[3] or \"\"\r\n        })\r\n        locations_set.add(r[2] or \"General\")\r\n\r\n    return render_template(\r\n        \"reserve_v2.html\",\r\n        locations=sorted(locations_set),\r\n        rooms_json=json.dumps(rooms)\r\n    )\r\n\r\n\r\n@app.route('/reserve/<int:room_id>', methods=['GET', 'POST'])\r\n@login_required\r\ndef reserve(room_id):\r\n    try:\r\n        conn = get_db_connection();\r\n        cur = conn.cursor()\r\n        # cur.execute(\"SELECT id, room_id, reserved_by, status, start_time, end_time FROM dbo.reservations WHERE id = ?\",\r\n        #             (room_id,))\r\n        # row = cur.fetchone()\r\n        # if not row:\r\n        #     return jsonify({\"success\": False, \"message\": \"Reservation not found.\"}), 404\r\n        # rid = row[1];\r\n        # reserved_by = row[2] or \"\";\r\n        # status = row[3] or \"\";\r\n        # start_time = row[4];\r\n        # end_time = row[5]\r\n\r\n        # get room group_code for approver checks\r\n        cur.execute(\"SELECT group_code FROM dbo.rooms WHERE id = ?\", (room_id,))\r\n        room_row = cur.fetchone()\r\n        group_code = room_row[0] if room_row else None\r\n\r\n        # Authorization: admin OR initiator OR group approver\r\n        allowed = False\r\n        if getattr(current_user, 'role', '').lower() == 'admin':\r\n            allowed = True\r\n        elif group_code and is_user_group_admin(current_user.username, group_code):\r\n            allowed = True\r\n\r\n        if not allowed:\r\n            return jsonify({\"success\": False, \"message\": \"Unauthorized to cancel this reservation.\"}), 403\r\n\r\n        # cur.execute(\"UPDATE dbo.reservations SET status = 'Cancelled', updated_at = GETDATE() WHERE id = ?\", (room_id,))\r\n        # Cancel any auto-blocks tied to this booking (by reserved_by marker and exact start/end)\r\n        # auto_marker = f\"[AUTO BLOCK] {reserved_by}\"\r\n        cur.execute(\"\"\"\r\n               UPDATE dbo.reservations\r\n               SET status = 'Cancelled', updated_at = GETDATE()\r\n               WHERE reserved_by LIKE ? AND start_time = ? AND end_time = ? AND status = 'Blocked'\r\n           \"\"\", (auto_marker + '%', start_time, end_time))\r\n        conn.commit()\r\n        log_audit(\"RESERVATION_CANCELLED\", f\"Reservation ID {res_id} cancelled by {current_user.username}\")\r\n        return jsonify(\r\n            {\"success\": True, \"room_id\": rid, \"res_id\": res_id, \"message\": \"Reservation cancelled successfully.\"})\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F api_cancel_reservation error:\", e)\r\n        return jsonify({\"success\": False, \"message\": f\"System error: {e}\"}), 500\r\n    finally:\r\n        conn.close()\r\n\r\n@app.route('/calendar_view_v2', methods=['GET'])\r\n@login_required\r\ndef calendar_view_v2():\r\n    \"\"\"Day view grid (Excel-like) with 30-min slots.\r\n\r\n    Accepts query params:\r\n      - location: location filter (default: all)\r\n      - room: room name filter (optional)\r\n      - date: YYYY-MM-DD (default: today)\r\n    \"\"\"\r\n    from datetime import datetime\r\n\r\n    # date\r\n    date_str = request.args.get(\"date\")\r\n    try:\r\n        selected_date = datetime.strptime(date_str, \"%Y-%m-%d\").date() if date_str else datetime.now().date()\r\n    except Exception:\r\n        selected_date = datetime.now().date()\r\n\r\n    location_filter = (request.args.get(\"location\") or \"all\").strip()\r\n    room_filter = (request.args.get(\"room\") or \"all\").strip()\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    allowed_locations = get_user_locations(current_user.id)\r\n\r\n    if current_user.is_admin():\r\n        cur.execute(\"SELECT DISTINCT location FROM rooms WHERE status='Active'\")\r\n        allowed_locations = [r[0] for r in cur.fetchall()]\r\n\r\n    if not allowed_locations:\r\n        allowed_locations = [\"Axis T1\"]  # fallback\r\n\r\n    # ----------------------------------------\r\n    # 4. GET ALL ROOMS UNDER ALLOWED LOCATIONS\r\n    # ----------------------------------------\r\n    placeholders = \",\".join([\"?\"] * len(allowed_locations))\r\n\r\n    # locations for dropdown\r\n    cur.execute(\"\"\"\r\n        SELECT DISTINCT ISNULL(NULLIF(LTRIM(RTRIM(location)), ''), 'General') AS location\r\n        FROM dbo.rooms\r\n        WHERE status='Active'\r\n         \r\n        ORDER BY ISNULL(NULLIF(LTRIM(RTRIM(location)), ''), 'General')\r\n    \"\"\")\r\n    locations = [str(r[0]) for r in cur.fetchall()]\r\n\r\n    # rooms list\r\n    sql = \"\"\"\r\n        SELECT id, name, capacity,\r\n               ISNULL(NULLIF(LTRIM(RTRIM(location)), ''), 'General') AS location,\r\n               ISNULL(features,'') AS features\r\n        FROM dbo.rooms\r\n        WHERE status='Active'\r\n    \"\"\"\r\n    params = []\r\n    if location_filter.lower() != 'all':\r\n        sql += \" AND LOWER(LTRIM(RTRIM(location))) = LOWER(?)\"\r\n        params.append(location_filter)\r\n    if room_filter and room_filter.lower() != 'all':\r\n        sql += \" AND LOWER(LTRIM(RTRIM(name))) = LOWER(?)\"\r\n        params.append(room_filter)\r\n    sql += \" ORDER BY location, name\"\r\n\r\n    cur.execute(sql, params)\r\n    rows = cur.fetchall()\r\n    conn.close()\r\n\r\n    rooms = []\r\n    for r in rows:\r\n        rooms.append({\r\n            \"id\": int(r.id),\r\n            \"name\": str(r.name),\r\n            \"capacity\": int(r.capacity) if r.capacity is not None else 0,\r\n            \"location\": str(r.location) if r.location else \"General\",\r\n            \"features\": str(r.features) if r.features else \"\"\r\n        })\r\n\r\n    # 30-minute slots 06:00 to 20:00 (like Excel mock)\r\n    time_slots = []\r\n    for h in range(6, 21):\r\n        time_slots.append(f\"{h:02d}:00\")\r\n        if h != 20:\r\n            time_slots.append(f\"{h:02d}:30\")\r\n\r\n    embed = (request.args.get(\"embed\") or \"\").strip() == \"1\"\r\n\r\n    return render_template(\r\n        \"calendar_view_v2_embed.html\" if embed else \"calendar_view_v2.html\",\r\n        selected_date=selected_date,\r\n        location_filter=location_filter,\r\n        room_filter=room_filter,\r\n        locations=locations,\r\n        rooms=rooms,\r\n        time_slots=time_slots,\r\n    )\r\n\r\n@app.route(\"/api/reservations_v2_day\")\r\n@login_required\r\ndef api_reservations_v2_day():\r\n    \"\"\"\r\n    For calendar_view_v2 Excel-style grid (30-min slots).\r\n    Params:\r\n      - date=YYYY-MM-DD\r\n      - location=all|<location>\r\n      - room=all|<room name>\r\n    \"\"\"\r\n    from datetime import datetime, timedelta, time as dt_time\r\n\r\n    date_str = (request.args.get(\"date\") or \"\").strip()\r\n    location_filter = (request.args.get(\"location\") or \"all\").strip()\r\n    room_filter = (request.args.get(\"room\") or \"all\").strip()\r\n\r\n    try:\r\n        d = datetime.strptime(date_str, \"%Y-%m-%d\").date()\r\n    except:\r\n        return jsonify([])\r\n\r\n    day_start = datetime.combine(d, dt_time.min)          # 00:00\r\n    day_end = day_start + timedelta(days=1)               # next day 00:00\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    sql = \"\"\"\r\n        SELECT\r\n            r.id AS reservation_id,\r\n            r.room_id,\r\n            rm.name AS room_name,\r\n            ISNULL(NULLIF(LTRIM(RTRIM(rm.location)), ''), 'General') AS location,\r\n            r.start_time,\r\n            r.end_time,\r\n            r.reserved_by,\r\n            ISNULL(r.remarks,'') AS remarks,\r\n            r.status\r\n        FROM dbo.reservations r\r\n        INNER JOIN dbo.rooms rm ON rm.id = r.room_id\r\n        WHERE rm.status='Active'\r\n          AND r.status IN ('Approved','Pending','Blocked')\r\n          -- ✅ overlap logic (shows full duration)\r\n          AND r.start_time < ? AND r.end_time > ?\r\n    \"\"\"\r\n    params = [day_end, day_start]\r\n\r\n    if location_filter.lower() != \"all\":\r\n        sql += \" AND LOWER(LTRIM(RTRIM(rm.location))) = LOWER(?)\"\r\n        params.append(location_filter)\r\n\r\n    if room_filter.lower() != \"all\":\r\n        sql += \" AND LOWER(LTRIM(RTRIM(rm.name))) = LOWER(?)\"\r\n        params.append(room_filter)\r\n\r\n    sql += \" ORDER BY rm.location, rm.name, r.start_time\"\r\n\r\n    cur.execute(sql, params)\r\n    rows = cur.fetchall()\r\n    conn.close()\r\n\r\n    events = []\r\n    for row in rows:\r\n        events.append({\r\n            \"id\": int(row.reservation_id),   # ✅ unique reservation id\r\n            \"room_id\": int(row.room_id),\r\n            \"room\": str(row.room_name),\r\n            \"location\": str(row.location),\r\n            \"start\": row.start_time.isoformat(),\r\n            \"end\": row.end_time.isoformat(),\r\n            \"reserved_by\": str(row.reserved_by),\r\n            \"remarks\": str(row.remarks),\r\n            \"status\": str(row.status),\r\n        })\r\n\r\n    return jsonify(events)\r\n\r\n\r\n\r\n@app.route(\"/calendar_view\")\r\n@login_required\r\ndef calendar_view():\r\n    try:\r\n        selected_date = request.args.get(\"date\")\r\n        selected_location = request.args.get(\"location\")\r\n\r\n        if not selected_date:\r\n            selected_date = datetime.now().strftime(\"%Y-%m-%d\")\r\n\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n\r\n        # Determine allowed locations\r\n        if current_user.is_admin():\r\n            cur.execute(\"SELECT DISTINCT location FROM rooms WHERE status='Active'\")\r\n            allowed_locations = [row[0] for row in cur.fetchall()]\r\n        else:\r\n            cur.execute(\"\"\"\r\n                SELECT DISTINCT ul.location_name\r\n                FROM user_locations ul\r\n                WHERE ul.user_id = ?\r\n            \"\"\", (current_user.id,))\r\n            allowed_locations = [row[0] for row in cur.fetchall()]\r\n\r\n        # Validate requested location\r\n        if not selected_location or selected_location not in allowed_locations:\r\n            selected_location = allowed_locations[0]\r\n\r\n        # Load rooms for this user/location\r\n        cur.execute(\"\"\"\r\n            SELECT *\r\n            FROM rooms\r\n            WHERE status='Active'\r\n              AND location = ?\r\n        \"\"\", (selected_location,))\r\n        rows = cur.fetchall()\r\n\r\n        rooms = [\r\n            {desc[0]: value for desc, value in zip(cur.description, row)}\r\n            for row in rows\r\n        ]\r\n\r\n        # Group rooms for dropdown\r\n        grouped_rooms = {}\r\n        for r in rooms:\r\n            grouped_rooms.setdefault(r[\"location\"], []).append(r[\"name\"])\r\n\r\n        conn.close()\r\n\r\n        return render_template(\r\n            \"calendar_view.html\",\r\n            rooms=rooms,\r\n            grouped_rooms=grouped_rooms,\r\n            current_location=selected_location,\r\n            locations=allowed_locations,\r\n            selected_date=selected_date\r\n        )\r\n    except Exception as e:\r\n        print(\"❌ ERROR in calendar_view:\", e)\r\n        return \"Calendar Error\", 500\r\n\r\ndef get_room_by_id(conn, room_id):\r\n    cursor = conn.cursor()\r\n    cursor.execute(\"\"\"\r\n        SELECT id, name, group_code, location, is_combined\r\n        FROM dbo.rooms\r\n        WHERE id = ?\r\n    \"\"\", (room_id,))\r\n    row = cursor.fetchone()\r\n\r\n    if row:\r\n        return {\r\n            \"id\": row[0],\r\n            \"name\": row[1],\r\n            \"group_code\": row[2],\r\n            \"location\": row[3],          # <-- FIXED\r\n            \"is_combined\": bool(row[4])\r\n        }\r\n    return None\r\n\r\ndef get_linked_rooms(conn, group_code, exclude_id=None):\r\n    cursor = conn.cursor()\r\n    if exclude_id:\r\n        cursor.execute(\"SELECT id FROM dbo.zs WHERE group_code = ? AND id <> ?\", (group_code, exclude_id))\r\n    else:\r\n        cursor.execute(\"SELECT id FROM dbo.rooms WHERE group_code = ?\", (group_code,))\r\n    return [r[0] for r in cursor.fetchall()]\r\n\r\n@app.route('/confirm')\r\n@login_required\r\ndef confirm():\r\n    return render_template('confirmation.html')\r\n\r\n# --- Helper: get_combined_group_rooms ---\r\nimport uuid\r\n# from datetime import datetime, timedelta\r\n\r\ndef get_combined_group_rooms(room_id):\r\n    conn = get_db_connection()\r\n    cursor = conn.cursor()\r\n\r\n    cursor.execute(\"\"\"\r\n        SELECT group_code, is_combined\r\n        FROM rooms\r\n        WHERE id = ?\r\n    \"\"\", (room_id,))\r\n    row = cursor.fetchone()\r\n\r\n    if not row:\r\n        cursor.close()\r\n        conn.close()\r\n        return [room_id]\r\n\r\n    group_code, is_combined = row\r\n\r\n    # If this room is NOT combined → do not block others\r\n    if not group_code or is_combined != 1:\r\n        cursor.close()\r\n        conn.close()\r\n        return [room_id]\r\n\r\n    # Combined room → block all rooms in same group_code\r\n    cursor.execute(\"\"\"\r\n        SELECT id\r\n        FROM rooms\r\n        WHERE group_code = ?\r\n    \"\"\", (group_code,))\r\n    rooms = [r[0] for r in cursor.fetchall()]\r\n\r\n    cursor.close()\r\n    conn.close()\r\n    return rooms\r\n\r\n# @app.route('/reserve_post/<int:room_id>', methods=['POST'])\r\n# @login_required\r\n# def reserve_post(room_id):\r\n#     try:\r\n#         conn = get_db_connection();\r\n#         cur = conn.cursor()\r\n#\r\n#         # Parse payload\r\n#         payload = request.get_json() if request.is_json else request.form.to_dict()\r\n#\r\n#         start_time = payload.get(\"start_time\")\r\n#         end_time = payload.get(\"end_time\")\r\n#         remarks = payload.get(\"remarks\", \"\")\r\n#         email = payload.get(\"email\") or current_user.email\r\n#         reserved_by = payload.get(\"reserved_by\") or current_user.display_name\r\n#\r\n#         recurrence_type = payload.get(\"recurrence_type\", \"none\")\r\n#         weekdays = payload.get(\"weekdays\", \"\")  # CSV \"MO,FR\"\r\n#         weekly_interval = int(payload.get(\"weekly_interval\", 1))\r\n#\r\n#         end_mode = payload.get(\"end_mode\", \"never\")\r\n#         end_on_date = payload.get(\"end_on_date\")\r\n#         after_count = payload.get(\"end_after_count\")\r\n#\r\n#         if not start_time or not end_time:\r\n#             return jsonify(success=False, message=\"Missing start/end\"), 400\r\n#\r\n#         # Convert strings -> datetime\r\n#         start_dt = datetime.fromisoformat(start_time)\r\n#         end_dt = datetime.fromisoformat(end_time)\r\n#         base_duration = end_dt - start_dt\r\n#\r\n#         # --- Build all recurrence dates ---\r\n#         all_dates = []\r\n#         current = start_dt\r\n#\r\n#         recurrence_id = str(uuid.uuid4()) if recurrence_type != \"none\" else None\r\n#\r\n#         def add_if_match(dt):\r\n#             # Ensure dt <= end-limit rules\r\n#             if end_mode == \"on\" and dt.date() > datetime.fromisoformat(end_on_date).date():\r\n#                 return False\r\n#             return True\r\n#\r\n#         count = 0\r\n#         MAX_LIMIT = 370  # 1 year\r\n#\r\n#         if recurrence_type == \"none\":\r\n#             all_dates = [start_dt]\r\n#\r\n#         elif recurrence_type == \"daily\":\r\n#             while count < MAX_LIMIT:\r\n#                 if add_if_match(current):\r\n#                     all_dates.append(current)\r\n#                 count += 1\r\n#                 if end_mode == \"after\" and len(all_dates) >= int(after_count):\r\n#                     break\r\n#                 current += timedelta(days=1)\r\n#                 if end_mode == \"on\" and current.date() > datetime.fromisoformat(end_on_date).date():\r\n#                     break\r\n#\r\n#         elif recurrence_type == \"weekly\":\r\n#             weekday_map = [\"MO\",\"TU\",\"WE\",\"TH\",\"FR\",\"SA\",\"SU\"]\r\n#             target_days = weekdays.split(\",\") if weekdays else []\r\n#             if not target_days:\r\n#                 target_days = [weekday_map[start_dt.weekday()]]\r\n#\r\n#             # First: include the start date\r\n#             if weekday_map[start_dt.weekday()] in target_days:\r\n#                 all_dates.append(start_dt)\r\n#\r\n#             cur_dt = start_dt\r\n#             while len(all_dates) < MAX_LIMIT:\r\n#                 cur_dt += timedelta(days=1)\r\n#                 wd = weekday_map[cur_dt.weekday()]\r\n#\r\n#                 if wd in target_days:\r\n#                     if not add_if_match(cur_dt):\r\n#                         break\r\n#                     all_dates.append(cur_dt)\r\n#\r\n#                 if end_mode == \"after\" and len(all_dates) >= int(after_count):\r\n#                     break\r\n#                 if end_mode == \"on\" and cur_dt.date() > datetime.fromisoformat(end_on_date).date():\r\n#                     break\r\n#\r\n#         # MONTHLY—can add later if needed\r\n#         elif recurrence_type == \"monthly\":\r\n#             all_dates = [start_dt]  # TODO: support monthly rules\r\n#\r\n#         # =====================================================================\r\n#         # Insert reservations + auto-block for combined AXIS_HALL rooms\r\n#         # =====================================================================\r\n#         group_rooms = get_combined_group_rooms(room_id)\r\n#\r\n#         created_count = 0\r\n#         skipped = []\r\n#\r\n#         for dt in all_dates:\r\n#             new_start = dt\r\n#             new_end = dt + base_duration\r\n#\r\n#             # Check conflict in the main room\r\n#             cur.execute(\"\"\"\r\n#                 SELECT COUNT(*)\r\n#                 FROM reservations\r\n#                 WHERE room_id=?\r\n#                 AND NOT (end_time <= ? OR start_time >= ?)\r\n#                 AND status IN ('Pending','Approved','Blocked')\r\n#             \"\"\", (room_id, new_start, new_end))\r\n#             if cur.fetchone()[0] > 0:\r\n#                 skipped.append(new_start.isoformat())\r\n#                 continue\r\n#\r\n#             # Insert main reservation\r\n#             cur.execute(\"\"\"\r\n#                 INSERT INTO reservations\r\n#                     (room_id, reserved_by, email, start_time, end_time, status,\r\n#                      remarks, created_at, time_zone, recurrence_id)\r\n#                 VALUES (?, ?, ?, ?, ?, 'Pending', ?, GETDATE(),\r\n#                         'GMT+08:00 (Beijing, Singapore, Taipei)', ?)\r\n#             \"\"\", (\r\n#                 room_id,\r\n#                 reserved_by,\r\n#                 email,\r\n#                 new_start,\r\n#                 new_end,\r\n#                 remarks,\r\n#                 recurrence_id\r\n#             ))\r\n#             created_count += 1\r\n#\r\n#             # Auto-block AXIS_HALL rooms except main one\r\n#             for rid in group_rooms:\r\n#                 if rid == room_id:\r\n#                     continue\r\n#\r\n#                 cur.execute(\"\"\"\r\n#                     SELECT COUNT(*) FROM reservations\r\n#                     WHERE room_id=? AND NOT (end_time <= ? OR start_time >= ?)\r\n#                     AND status IN ('Pending','Approved','Blocked')\r\n#                 \"\"\", (rid, new_start, new_end))\r\n#                 if cur.fetchone()[0] > 0:\r\n#                     continue  # skip conflicts\r\n#\r\n#                 cur.execute(\"\"\"\r\n#                     INSERT INTO reservations\r\n#                         (room_id, reserved_by, email, start_time, end_time, status,\r\n#                          remarks, created_at, time_zone, recurrence_id)\r\n#                     VALUES (?, ?, ?, ?, ?, 'Blocked', ?, GETDATE(),\r\n#                             'GMT+08:00 (Beijing, Singapore, Taipei)', ?)\r\n#                 \"\"\", (\r\n#                     rid,\r\n#                     f\"[AUTO BLOCK] {reserved_by}\",\r\n#                     email,\r\n#                     new_start,\r\n#                     new_end,\r\n#                     f\"Blocked by combined booking of room {room_id}\",\r\n#                     recurrence_id\r\n#                 ))\r\n#\r\n#         conn.commit()\r\n#\r\n#         return jsonify(\r\n#             success=True,\r\n#             created_count=created_count,\r\n#             skipped=skipped,\r\n#             message=\"Recurring booking result\"\r\n#         )\r\n#\r\n#     except Exception as e:\r\n#         print(\"⚠\uFE0F Error Post\", e)\r\n#         try:\r\n#             if 'conn' in locals() and conn:\r\n#                 conn.rollback()\r\n#         except:\r\n#             pass\r\n#\r\n#         return jsonify(success=False, message=str(e)), 500\r\n\r\nfrom datetime import datetime, timedelta, timezone\r\n\r\ndef snap_to_30min_floor(dt: datetime) -> datetime:\r\n    \"\"\"Floor to previous :00 or :30, preserve tz awareness.\"\"\"\r\n    minutes = dt.minute\r\n    snapped_min = 0 if minutes < 30 else 30\r\n    return dt.replace(minute=snapped_min, second=0, microsecond=0)\r\n\r\n\r\ndef snap_to_30min_round(dt: datetime) -> datetime:\r\n    \"\"\"Round to nearest :00 or :30. >= :45 -> next hour; < :15 -> :00; else -> :30.\"\"\"\r\n    total_minutes = dt.minute + dt.second / 60 + dt.microsecond / 1_000_000 / 60\r\n    if total_minutes < 15:\r\n        snapped_min = 0\r\n        return dt.replace(minute=snapped_min, second=0, microsecond=0)\r\n    elif total_minutes < 45:\r\n        snapped_min = 30\r\n        return dt.replace(minute=snapped_min, second=0, microsecond=0)\r\n    else:\r\n        # round up to next hour\r\n        return dt.replace(minute=0, second=0, microsecond=0) + timedelta(hours=1)\r\n\r\n# saving of room reservation\r\n@app.route('/reserve_post/<int:room_id>', methods=['POST'])\r\n@login_required\r\ndef reserve_post(room_id):\r\n    try:\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n\r\n        # Parse payload\r\n        payload = request.get_json() if request.is_json else request.form.to_dict()\r\n\r\n        start_time = payload.get(\"start_time\")\r\n        end_time = payload.get(\"end_time\")\r\n        remarks = payload.get(\"remarks\", \"\")\r\n        email = payload.get(\"email\") or getattr(current_user, \"email\", None)\r\n        reserved_by = payload.get(\"reserved_by\") or getattr(current_user, \"display_name\", \"\") or getattr(current_user, \"username\", \"\")\r\n\r\n        recurrence_type = payload.get(\"recurrence_type\", \"none\")\r\n        weekdays = payload.get(\"weekdays\", \"\")  # CSV \"MO,FR\"\r\n        weekly_interval = int(payload.get(\"weekly_interval\", 1) or 1)\r\n\r\n        end_mode = payload.get(\"end_mode\", \"never\")\r\n        end_on_date = payload.get(\"end_on_date\")\r\n        after_count = payload.get(\"end_after_count\")\r\n\r\n        if not start_time or not end_time:\r\n            return jsonify(success=False, message=\"Missing start/end\"), 400\r\n\r\n        # Convert strings -> datetime\r\n        start_dt = datetime.fromisoformat(start_time)\r\n        end_dt = datetime.fromisoformat(end_time)\r\n\r\n        # Align to :00/:30 while keeping the same variable names\r\n        start_dt = snap_to_30min_round(start_dt)\r\n        end_dt = snap_to_30min_round(end_dt)\r\n\r\n        # Compute duration (optional)\r\n        base_duration = end_dt - start_dt\r\n\r\n        # --- Load room info (location, approval setting) ---\r\n        cur.execute(\"SELECT id, name, location, approvals_required FROM rooms WHERE id = ?\", (room_id,))\r\n        row = cur.fetchone()\r\n        if not row:\r\n            return jsonify(success=False, message=\"Room not found\"), 404\r\n\r\n        room_location = row[2] or \"\"\r\n        approvals_required_raw = row[3]  # may be 'Auto', 'Yes', 'No' or NULL\r\n\r\n        # Normalize approvals_required\r\n        approvals_required = str(approvals_required_raw).strip().lower() if approvals_required_raw is not None else \"auto\"\r\n        if approvals_required not in (\"auto\", \"yes\", \"no\"):\r\n            approvals_required = \"auto\"\r\n\r\n        # --- Fetch approvers for this location from group_approvers ---\r\n        cur.execute(\"\"\"\r\n            SELECT approver_username\r\n            FROM group_approvers\r\n            WHERE group_code = ? AND is_active = 1\r\n        \"\"\", (room_location,))\r\n        approver_rows = cur.fetchall()\r\n        approvers = [r[0] for r in approver_rows] if approver_rows else []\r\n\r\n        # Helper: determine status for a single created reservation\r\n        def decide_status():\r\n            # approvals_required: \"no\" | \"yes\" | \"auto\"\r\n            if approvals_required == \"no\":\r\n                return \"Approved\"\r\n            if approvals_required == \"yes\":\r\n                # always pending for manual approval (route to approvers or admin)\r\n                return \"Pending\"\r\n            # auto\r\n            if approvals_required == \"auto\":\r\n                return \"Pending\" if approvers else \"Approved\"\r\n            # fallback\r\n            return \"Pending\"\r\n\r\n        # --- Build recurrence dates ---\r\n        all_dates = []\r\n        current = start_dt\r\n\r\n        recurrence_id = str(uuid.uuid4()) if recurrence_type != \"none\" else None\r\n\r\n        def add_if_match(dt):\r\n            if end_mode == \"on\" and end_on_date:\r\n                try:\r\n                    end_limit = datetime.fromisoformat(end_on_date).date()\r\n                except Exception:\r\n                    return False\r\n                return dt.date() <= end_limit\r\n            return True\r\n\r\n        count = 0\r\n        MAX_LIMIT = 370  # about 1 year\r\n\r\n        if recurrence_type == \"none\":\r\n            all_dates = [start_dt]\r\n\r\n        elif recurrence_type == \"daily\":\r\n            while count < MAX_LIMIT:\r\n                if add_if_match(current):\r\n                    all_dates.append(current)\r\n                count += 1\r\n                if end_mode == \"after\" and after_count and len(all_dates) >= int(after_count):\r\n                    break\r\n                current += timedelta(days=1)\r\n                if end_mode == \"on\" and end_on_date and current.date() > datetime.fromisoformat(end_on_date).date():\r\n                    break\r\n\r\n        elif recurrence_type == \"weekly\":\r\n            weekday_map = [\"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\"]\r\n            target_days = [d for d in (weekdays.split(\",\") if weekdays else []) if d]\r\n            if not target_days:\r\n                target_days = [weekday_map[start_dt.weekday()]]\r\n\r\n            # include start date if it matches\r\n            if weekday_map[start_dt.weekday()] in target_days:\r\n                all_dates.append(start_dt)\r\n\r\n            cur_dt = start_dt\r\n            while len(all_dates) < MAX_LIMIT:\r\n                cur_dt += timedelta(days=1)\r\n                wd = weekday_map[cur_dt.weekday()]\r\n                if wd in target_days:\r\n                    if not add_if_match(cur_dt):\r\n                        break\r\n                    all_dates.append(cur_dt)\r\n\r\n                if end_mode == \"after\" and after_count and len(all_dates) >= int(after_count):\r\n                    break\r\n                if end_mode == \"on\" and end_on_date and cur_dt.date() > datetime.fromisoformat(end_on_date).date():\r\n                    break\r\n\r\n        elif recurrence_type == \"monthly\":\r\n            # minimal support: keep just the single start date for now\r\n            all_dates = [start_dt]\r\n\r\n        # =====================================================================\r\n        # Insert reservations + auto-block for combined group rooms\r\n        # =====================================================================\r\n        group_rooms = get_combined_group_rooms(room_id)  # keep your helper\r\n\r\n        created_count = 0\r\n        skipped = []\r\n\r\n        for dt in all_dates:\r\n            new_start = dt\r\n            new_end = dt + base_duration\r\n\r\n            # conflict check for the main room\r\n            cur.execute(\"\"\"\r\n                SELECT COUNT(*)\r\n                FROM reservations\r\n                WHERE room_id=?\r\n                  AND NOT (end_time <= ? OR start_time >= ?)\r\n                  AND status IN ('Pending','Approved','Blocked')\r\n            \"\"\", (room_id, new_start, new_end))\r\n            if cur.fetchone()[0] > 0:\r\n                skipped.append(new_start.isoformat())\r\n                continue\r\n\r\n            # decide status based on approver presence and room setting\r\n            status_to_use = decide_status()  # \"Pending\" or \"Approved\"\r\n\r\n            # Insert main reservation (status varies)\r\n            cur.execute(\"\"\"\r\n                INSERT INTO reservations\r\n                    (room_id, reserved_by, email, start_time, end_time, status,\r\n                     remarks, created_at, time_zone, recurrence_id)\r\n                VALUES (?, ?, ?, ?, ?, ?, ?, GETDATE(), 'GMT+08:00 (Beijing, Singapore, Taipei)', ?)\r\n            \"\"\", (\r\n                room_id,\r\n                reserved_by,\r\n                email,\r\n                new_start,\r\n                new_end,\r\n                status_to_use,\r\n                remarks,\r\n                recurrence_id\r\n            ))\r\n            created_count += 1\r\n\r\n            # Optional: If status is Pending and approvers is empty for \"yes\", you may want to notify admin here.\r\n            # (You said you have admin users — implement notification outside this function.)\r\n\r\n            # Auto-block combined group rooms (same as before)\r\n            for rid in group_rooms:\r\n                if rid == room_id:\r\n                    continue\r\n\r\n                cur.execute(\"\"\"\r\n                    SELECT COUNT(*) FROM reservations\r\n                    WHERE room_id=? AND NOT (end_time <= ? OR start_time >= ?)\r\n                    AND status IN ('Pending','Approved','Blocked')\r\n                \"\"\", (rid, new_start, new_end))\r\n                if cur.fetchone()[0] > 0:\r\n                    continue  # skip conflicts\r\n\r\n                cur.execute(\"\"\"\r\n                    INSERT INTO reservations\r\n                        (room_id, reserved_by, email, start_time, end_time, status,\r\n                         remarks, created_at, time_zone, recurrence_id)\r\n                    VALUES (?, ?, ?, ?, ?, 'Blocked', ?, GETDATE(),\r\n                            'GMT+08:00 (Beijing, Singapore, Taipei)', ?)\r\n                \"\"\", (\r\n                    rid,\r\n                    f\"[AUTO BLOCK] {reserved_by}\",\r\n                    email,\r\n                    new_start,\r\n                    new_end,\r\n                    f\"Blocked by combined booking of room {room_id}\",\r\n                    recurrence_id\r\n                ))\r\n\r\n        conn.commit()\r\n        conn.close()\r\n\r\n        return jsonify(\r\n            success=True,\r\n            created_count=created_count,\r\n            skipped=skipped,\r\n            message=\"Recurring booking result\"\r\n        )\r\n\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F Error Post\", e)\r\n        try:\r\n            if 'conn' in locals() and conn:\r\n                conn.rollback()\r\n                conn.close()\r\n        except:\r\n            pass\r\n\r\n        return jsonify(success=False, message=str(e)), 500\r\n\r\n@app.route('/api/cancel_reservation/<int:res_id>', methods=['POST'])\r\n@login_required\r\ndef api_cancel_reservation(res_id):\r\n    try:\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n\r\n        # FIXED SQL WITH JOIN + NOLOCK + CORRECT QUOTING\r\n        cur.execute(\"\"\"\r\n            SELECT \r\n                r.id,\r\n                r.room_id,\r\n                u.username AS reserved_by,\r\n                r.status,\r\n                r.start_time,\r\n                r.end_time\r\n            FROM dbo.reservations r WITH (NOLOCK)\r\n            JOIN dbo.users u WITH (NOLOCK)\r\n                ON r.reserved_by = u.display_name\r\n            WHERE r.id = ?\r\n        \"\"\", (res_id,))\r\n\r\n        row = cur.fetchone()\r\n\r\n        if not row:\r\n            return jsonify({\"success\": False, \"message\": \"Reservation not found.\"}), 404\r\n\r\n        rid         = row[1]\r\n        reserved_by = row[2] or \"\"\r\n        status      = row[3] or \"\"\r\n        start_time  = row[4]\r\n        end_time    = row[5]\r\n\r\n        # Get room group_code\r\n        cur.execute(\"SELECT group_code FROM dbo.rooms WHERE id = ?\", (rid,))\r\n        room_row = cur.fetchone()\r\n        group_code = room_row[0] if room_row else None\r\n\r\n        # Authorization: admin OR initiator OR location approver\r\n        allowed = False\r\n        if (current_user.role or \"\").lower() == \"admin\":\r\n            allowed = True\r\n        elif current_user.username.lower() == reserved_by.lower():\r\n            allowed = True\r\n        elif group_code and is_user_group_admin(current_user.username, group_code):\r\n            allowed = True\r\n\r\n        if not allowed:\r\n            return jsonify({\"success\": False, \"message\": \"Unauthorized to cancel this reservation.\"}), 403\r\n\r\n        # Already cancelled\r\n        if status == \"Cancelled\":\r\n            return jsonify({\"success\": False, \"message\": \"Reservation already cancelled.\"}), 400\r\n\r\n        # Cancel main reservation\r\n        cur.execute(\"\"\"\r\n            UPDATE dbo.reservations\r\n            SET status = 'Cancelled', updated_at = GETDATE()\r\n            WHERE id = ?\r\n        \"\"\", (res_id,))\r\n\r\n        # Cancel auto-blocks\r\n        auto_marker = f\"[AUTO BLOCK] {reserved_by}\"\r\n        # UPDATE dbo.reservations\r\n        #     SET status = 'Cancelled', updated_at = GETDATE()\r\n        #     WHERE reserved_by LIKE ?\r\n        #       AND start_time = ?\r\n        #       AND end_time = ?\r\n        #       AND status = 'Blocked'\r\n\r\n        cur.execute(\"\"\"\r\n            UPDATE crev\r\n                SET crev.status = 'Cancelled',\r\n                    crev.updated_at = GETDATE()\r\n                FROM \r\n                    reservations AS rev (NOLOCK)\r\n                    JOIN rooms AS r (NOLOCK) \r\n                        ON rev.room_id = r.id\r\n                    LEFT JOIN rooms AS comr (NOLOCK)\r\n                        ON r.group_code = comr.group_code\r\n                       AND comr.is_combined <> 1\r\n                    JOIN reservations AS crev (NOLOCK)\r\n                        ON comr.id = crev.room_id\r\n                       AND crev.start_time = rev.start_time\r\n                       AND crev.end_time   = rev.end_time\r\n                WHERE\r\n                    rev.id = ?\r\n                    AND r.is_combined = 1\r\n                    AND crev.reserved_by LIKE '%' + rev.reserved_by + '%'\r\n                    AND crev.status = 'Blocked';\r\n\r\n        \"\"\", (res_id))\r\n\r\n        conn.commit()\r\n\r\n        log_audit(\"RESERVATION_CANCELLED\",\r\n                  f\"Reservation ID {res_id} cancelled by {current_user.username}\")\r\n\r\n        return jsonify({\r\n            \"success\": True,\r\n            \"room_id\": rid,\r\n            \"res_id\": res_id,\r\n            \"message\": \"Reservation cancelled successfully.\"\r\n        })\r\n\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F api_cancel_reservation error:\", e)\r\n        return jsonify({\"success\": False, \"message\": f\"System error: {e}\"}), 500\r\n\r\n    finally:\r\n        conn.close()\r\n\r\n\r\n\r\n@app.route('/api/booked_slots')\r\n@login_required\r\ndef api_booked_slots():\r\n    \"\"\"Return all bookings for a given room and date for visual timeline.\"\"\"\r\n    try:\r\n        room_id = int(request.args.get('room_id', 0))\r\n        date_str = request.args.get('date')\r\n        if not room_id or not date_str:\r\n            return jsonify({'error': 'Missing parameters'}), 400\r\n\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n        sql = \"\"\"\r\n            SELECT reserved_by,\r\n                   CONVERT(VARCHAR(5), start_time, 108) AS start_time,\r\n                   CONVERT(VARCHAR(5), end_time, 108) AS end_time,\r\n                   status\r\n            FROM reservations\r\n            WHERE room_id = ?\r\n              AND CONVERT(date, start_time) = ?\r\n              AND status != 'Cancelled'\r\n            ORDER BY start_time\r\n        \"\"\"\r\n        cur.execute(sql, (room_id, date_str))\r\n        rows = cur.fetchall()\r\n        conn.close()\r\n\r\n        slots = [\r\n            {\r\n                'reserved_by': r[0],\r\n                'start_time': r[1],\r\n                'end_time': r[2],\r\n                'status': r[3]\r\n            }\r\n            for r in rows\r\n        ]\r\n        return jsonify({'slots': slots})\r\n    except Exception as e:\r\n        print(f\"⚠\uFE0F api_booked_slots error: {e}\")\r\n        return jsonify({'error': str(e)}), 500\r\n\r\n@app.route('/room_schedule', methods=['GET'])\r\n@login_required\r\ndef room_schedule():\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    date_str = request.args.get('date')\r\n    if date_str:\r\n        try:\r\n            selected_date = datetime.strptime(date_str, \"%Y-%m-%d\")\r\n        except ValueError:\r\n            selected_date = datetime.utcnow()\r\n    else:\r\n        selected_date = datetime.utcnow()\r\n\r\n    # day window\r\n    start_day = selected_date.replace(hour=0, minute=0, second=0, microsecond=0)\r\n    end_day = start_day + timedelta(days=1)\r\n\r\n    # fetch rooms\r\n    # 4. GET ALL ROOMS FOR DROPDOWN (based on user's allowed locations)\r\n    cur.execute(\"\"\"\r\n        SELECT id, name, location, capacity, description, group_code, is_combined\r\n        FROM rooms\r\n        WHERE status='Active'\r\n          AND location IN ({})\r\n        ORDER BY location, name\r\n    \"\"\".format(\",\".join(\"?\" * len(allowed_locations))), allowed_locations)\r\n\r\n    all_room_rows = cur.fetchall()\r\n\r\n    # Convert ALL rooms to list (for dropdown)\r\n    all_rooms = [\r\n        {\r\n            \"id\": r[0],\r\n            \"name\": r[1],\r\n            \"location\": r[2],\r\n            \"capacity\": r[3],\r\n            \"description\": r[4],\r\n            \"group_code\": r[5],\r\n            \"is_combined\": bool(r[6]),\r\n        }\r\n        for r in all_room_rows\r\n    ]\r\n\r\n    # 5. FILTER ROOMS BASED ON SELECTED LOCATION\r\n    if selected_location and selected_location != \"all\":\r\n        filtered_rooms = [r for r in all_rooms if r[\"location\"] == selected_location]\r\n    else:\r\n        filtered_rooms = all_rooms[:]  # all rooms by default\r\n\r\n    # 6. FILTER ROOMS AGAIN BASED ON SELECTED ROOM\r\n    if selected_room and selected_room != \"all\":\r\n        rooms = [r for r in filtered_rooms if r[\"name\"] == selected_room]\r\n    else:\r\n        rooms = filtered_rooms[:]\r\n\r\n    # fetch reservations for selected day\r\n    cur.execute(\"\"\"\r\n        SELECT id, room_id, reserved_by, email, start_time, end_time, status, remarks, purpose\r\n        FROM dbo.reservations\r\n        WHERE start_time < ? AND end_time > ?\r\n    \"\"\", (end_day, start_day))\r\n    raw_res = cur.fetchall()\r\n    reservations = []\r\n    for rr in raw_res:\r\n        # convert DB row to dictionary and format datetimes to ISO strings\r\n        reservations.append({\r\n            \"id\": rr.id,\r\n            \"room_id\": rr.room_id,\r\n            \"reserved_by\": rr.reserved_by,\r\n            \"email\": rr.email,\r\n            \"start_time\": rr.start_time.isoformat() if isinstance(rr.start_time, datetime) else str(rr.start_time),\r\n            \"end_time\": rr.end_time.isoformat() if isinstance(rr.end_time, datetime) else str(rr.end_time),\r\n            \"status\": rr.status,\r\n            \"remarks\": rr.remarks,\r\n            \"purpose\": getattr(rr, 'purpose', None),\r\n        })\r\n\r\n    conn.close()\r\n    return render_template('room_schedule.html',\r\n                           rooms=rooms,\r\n                           reservations=reservations,\r\n                           selected_date=selected_date)\r\n\r\n@app.route('/export_excel')\r\n@login_required\r\ndef export_excel():\r\n    start = request.args.get('start')\r\n    end = request.args.get('end')\r\n    room = request.args.get('room', 'all')\r\n    group = request.args.get('group', 'all')\r\n\r\n    # --- Parse date range safely ---\r\n    try:\r\n        start_date = datetime.strptime(start, \"%Y-%m-%d\")\r\n        end_date = datetime.strptime(end, \"%Y-%m-%d\") + timedelta(days=1)\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F Invalid date params:\", e)\r\n        return \"Invalid date format. Expected YYYY-MM-DD\", 400\r\n\r\n    # --- Connect DB ---\r\n    conn = get_db_connection()\r\n    cursor = conn.cursor()\r\n\r\n    # --- Build SQL ---\r\n    query = \"\"\"\r\n        SELECT rm.name AS Room, rm.location AS Location,\r\n               r.reserved_by AS ReservedBy,\r\n               CONVERT(VARCHAR(19), r.start_time, 120) AS StartTime,\r\n               CONVERT(VARCHAR(19), r.end_time, 120) AS EndTime,\r\n               ISNULL(r.remarks,'') AS Remarks,\r\n               r.status AS Status\r\n        FROM dbo.reservations r (NOLOCK)\r\n        INNER JOIN dbo.rooms rm (NOLOCK) ON rm.id = r.room_id\r\n        WHERE r.start_time >= ? AND r.end_time < ?\r\n    \"\"\"\r\n    params = [start_date, end_date]\r\n\r\n    if group and group != \"all\":\r\n        query += \" AND rm.location = ?\"\r\n        params.append(group)\r\n    if room and room != \"all\":\r\n        query += \" AND rm.name = ?\"\r\n        params.append(room)\r\n\r\n    query += \" ORDER BY rm.name, r.start_time\"\r\n\r\n    print(f\"\\n\uD83E\uDDFE Export Query:\\n{query}\\nParams: {params}\")\r\n\r\n    cursor.execute(query, params)\r\n    rows = cursor.fetchall()\r\n    conn.close()\r\n\r\n    # --- Build grouped data ---\r\n    reservations_by_room = {}\r\n    for row in rows:\r\n        room_name = row[0]\r\n        reservations_by_room.setdefault(room_name, []).append(row)\r\n\r\n    # --- Create Excel output ---\r\n    output = BytesIO()\r\n    workbook = pd.ExcelWriter(output, engine=\"xlsxwriter\")\r\n    wb = workbook.book\r\n\r\n    # --- Styles ---\r\n    title_fmt = wb.add_format({\r\n        \"bold\": True, \"font_size\": 14, \"align\": \"center\",\r\n        \"valign\": \"vcenter\", \"bg_color\": \"#0047AB\", \"font_color\": \"white\"\r\n    })\r\n    time_fmt = wb.add_format({\"align\": \"center\", \"valign\": \"vcenter\", \"border\": 1, \"bold\": True})\r\n    available_fmt = wb.add_format({\"align\": \"center\", \"valign\": \"vcenter\", \"border\": 1, \"bg_color\": \"#E8F5E9\"})\r\n    booked_fmt = wb.add_format({\r\n        \"align\": \"center\", \"valign\": \"vcenter\", \"border\": 1, \"bg_color\": \"#BBDEFB\", \"text_wrap\": True\r\n    })\r\n    pending_fmt = wb.add_format({\r\n        \"align\": \"center\", \"valign\": \"vcenter\", \"border\": 1, \"bg_color\": \"#FFE0B2\", \"text_wrap\": True\r\n    })\r\n\r\n    # --- Case: No data ---\r\n    if not reservations_by_room:\r\n        ws = wb.add_worksheet(\"No Data\")\r\n        ws.merge_range(\"A1:C1\", f\"No reservations found between {start} and {end}\", title_fmt)\r\n        ws.set_column(\"A:C\", 40)\r\n        workbook.close()\r\n        output.seek(0)\r\n        return send_file(\r\n            output,\r\n            as_attachment=True,\r\n            download_name=f\"Room_Schedule_{start}_to_{end}.xlsx\",\r\n            mimetype=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"\r\n        )\r\n\r\n    # --- Create one sheet per room ---\r\n    for room_name, bookings in reservations_by_room.items():\r\n        ws = wb.add_worksheet(room_name[:31])\r\n        ws.merge_range(\"A1:D1\",\r\n            f\"{room_name} — Schedule ({start} to {end})\",\r\n            title_fmt\r\n        )\r\n        ws.write(\"A3\", \"Time\", time_fmt)\r\n        ws.write(\"B3\", \"Reservation Details\", time_fmt)\r\n        ws.set_column(\"A:A\", 12)\r\n        ws.set_column(\"B:B\", 60)\r\n\r\n        # Generate half-hour grid (6:00–20:00)\r\n        row_idx = 3\r\n        base = datetime.strptime(start, \"%Y-%m-%d\")\r\n        for h in range(6, 20):\r\n            for m in [0, 30]:\r\n                slot_label = f\"{h:02d}:{m:02d}\"\r\n                ws.write(row_idx, 0, slot_label, time_fmt)\r\n\r\n                slot_start = base.replace(hour=h, minute=m)\r\n                slot_end = slot_start + timedelta(minutes=30)\r\n                matched = None\r\n\r\n                for b in bookings:\r\n                    b_start = datetime.strptime(b[3], \"%Y-%m-%d %H:%M:%S\")\r\n                    b_end = datetime.strptime(b[4], \"%Y-%m-%d %H:%M:%S\")\r\n                    if b_start < slot_end and b_end > slot_start:\r\n                        matched = b\r\n                        break\r\n\r\n                if matched:\r\n                    details = f\"{matched[2]} ({matched[6]})\\n{matched[5]}\"\r\n                    fmt = booked_fmt if matched[6] == \"Approved\" else pending_fmt\r\n                    ws.write(row_idx, 1, details, fmt)\r\n                else:\r\n                    ws.write(row_idx, 1, \"\", available_fmt)\r\n\r\n                row_idx += 1\r\n\r\n        # --- Print settings for posting ---\r\n        ws.fit_to_pages(1, 1)\r\n        ws.set_landscape()\r\n        ws.set_paper(9)  # A4\r\n        ws.center_horizontally()\r\n        ws.set_margins(left=0.3, right=0.3, top=0.5, bottom=0.5)\r\n\r\n    # --- Finalize workbook ---\r\n    workbook.close()\r\n    output.seek(0)\r\n    filename = f\"Room_Schedule_{start}_to_{end}.xlsx\"\r\n\r\n    return send_file(\r\n        output,\r\n        as_attachment=True,\r\n        download_name=filename,\r\n        mimetype=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"\r\n    )\r\n\r\n@app.route(\"/api/reservations\")\r\n@login_required\r\ndef api_reservations():\r\n    room = request.args.get(\"room\", \"all\")\r\n    group = request.args.get(\"group\", \"all\")\r\n    start = request.args.get(\"start\")\r\n    end = request.args.get(\"end\")\r\n\r\n    # --- Parse FullCalendar range ---\r\n    try:\r\n        start_dt = dateparser.isoparse(start)\r\n        end_dt = dateparser.isoparse(end)\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F Invalid date range:\", e)\r\n        return jsonify([])\r\n\r\n    conn = get_db_connection()\r\n    cursor = conn.cursor()\r\n\r\n    # ==========================================================\r\n    # 1\uFE0F⃣ Base SQL – Admin sees all, User limited to assigned locations\r\n    # ==========================================================\r\n    if current_user.role == \"admin\":\r\n        query = \"\"\"\r\n            SELECT r.id AS reservation_id,\r\n                   rm.id AS room_id,\r\n                   rm.name AS room_name,\r\n                   rm.location,\r\n                   r.reserved_by,\r\n                   r.start_time,\r\n                   r.end_time,\r\n                   ISNULL(r.remarks,'') AS remarks,\r\n                   r.status\r\n            FROM reservations r\r\n            INNER JOIN rooms rm ON rm.id = r.room_id\r\n            WHERE r.status IN ('Approved','Pending')\r\n              AND r.start_time >= ? AND r.start_time < ?\r\n        \"\"\"\r\n        params = [start_dt, end_dt]\r\n\r\n    else:\r\n        query = \"\"\"\r\n            SELECT r.id AS reservation_id,\r\n                   rm.id AS room_id,\r\n                   rm.name AS room_name,\r\n                   rm.location,\r\n                   r.reserved_by,\r\n                   r.start_time,\r\n                   r.end_time,\r\n                   ISNULL(r.remarks,'') AS remarks,\r\n                   r.status\r\n            FROM reservations r\r\n            INNER JOIN rooms rm ON rm.id = r.room_id\r\n            INNER JOIN user_locations ul\r\n                ON ul.location_name = rm.location\r\n            WHERE ul.user_id = ?\r\n              AND r.status IN ('Approved','Pending')\r\n              AND r.start_time >= ? AND r.start_time < ?\r\n        \"\"\"\r\n        params = [current_user.id, start_dt, end_dt]\r\n\r\n    # ==========================================================\r\n    # 2\uFE0F⃣ Apply UI filters (location + room)\r\n    # ==========================================================\r\n    if group and group.lower() != \"all\":\r\n        query += \" AND rm.location = ?\"\r\n        params.append(group)\r\n\r\n    if room and room.lower() != \"all\":\r\n        query += \" AND rm.name = ?\"\r\n        params.append(room)\r\n\r\n    query += \" ORDER BY r.start_time\"\r\n\r\n    # Debug logs\r\n    print(\"\uD83E\uDDE9 SQL:\", query)\r\n    print(\"\uD83E\uDDE9 PARAMS:\", params)\r\n\r\n    cursor.execute(query, params)\r\n    rows = cursor.fetchall()\r\n    conn.close()\r\n\r\n    # ==========================================================\r\n    # 3\uFE0F⃣ Build FullCalendar Events\r\n    # ==========================================================\r\n    tz = timezone(timedelta(hours=8))\r\n    events = []\r\n\r\n    for (reservation_id, room_id, room_name, location,\r\n         reserved_by, start_time, end_time, remarks, status) in rows:\r\n\r\n        start_local = start_time.replace(tzinfo=tz)\r\n        end_local = end_time.replace(tzinfo=tz)\r\n\r\n        color = \"#0047AB\" if status == \"Approved\" else \"#FFA726\"\r\n\r\n        events.append({\r\n            \"id\": reservation_id,         # FIXED\r\n            \"room_id\": room_id,\r\n            \"title\": f\"{room_name} - {reserved_by}\",\r\n            \"start\": start_local.isoformat(),\r\n            \"end\": end_local.isoformat(),\r\n            \"room\": room_name,\r\n            \"location\": location,\r\n            \"description\": remarks,\r\n            \"status\": status,\r\n            \"color\": color\r\n        })\r\n\r\n    print(f\"✅ Returned {len(events)} events (Group={group}, Room={room})\")\r\n    return jsonify(events)\r\n\r\n@app.route(\"/api/room_availability/<int:room_id>\")\r\n@login_required\r\ndef api_room_availability(room_id):\r\n    try:\r\n        selected_date = request.args.get(\"date\")\r\n        if not selected_date:\r\n            # from datetime import datetime\r\n            selected_date = datetime.now().strftime(\"%Y-%m-%d\")\r\n\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n\r\n        sql = \"\"\"\r\n            SELECT \r\n                id,\r\n                reserved_by,\r\n                email,\r\n                CONVERT(VARCHAR(5), start_time, 108) AS start_time,\r\n                CONVERT(VARCHAR(5), end_time, 108) AS end_time,\r\n                status,\r\n                remarks\r\n            FROM reservations\r\n            WHERE room_id = ?\r\n              AND CAST(start_time AS DATE) = ?\r\n              AND status != 'Cancelled'\r\n            ORDER BY start_time\r\n        \"\"\"\r\n        cur.execute(sql, (room_id, selected_date))\r\n        rows = cur.fetchall()\r\n        conn.close()\r\n\r\n        results = []\r\n        for r in rows:\r\n            results.append({\r\n                \"id\": r.id,\r\n                \"reserved_by\": r.reserved_by,\r\n                \"email\": r.email,\r\n                \"start\": r.start_time,\r\n                \"end\": r.end_time,\r\n                \"status\": r.status,\r\n                \"remarks\": r.remarks,\r\n            })\r\n\r\n        return jsonify(results)\r\n    except Exception as e:\r\n        print(f\"⚠\uFE0F Error loading room availability for {room_id}: {e}\")\r\n        return jsonify([])\r\n\r\n# (remaining routes & functions—api_reservations, api_room_availability, api_booked_slots, room_schedule, admin dashboard, etc.—should remain as in your working copy)\r\n# Keep the rest of your original file unchanged below this line (export_excel, api_reservations, api_room_availability, api_booked_slots, room_schedule, etc.)\r\n\r\ndef assign_user_locations(user_id, locations):\r\n   \"\"\"Replace all user-location assignments.\"\"\"\r\n   try:\r\n       conn = get_db_connection(); cur = conn.cursor()\r\n       cur.execute(\"DELETE FROM dbo.user_locations WHERE user_id = ?\", (user_id,))\r\n       for loc in locations:\r\n           cur.execute(\r\n               \"INSERT INTO dbo.user_locations (user_id, location_name) VALUES (?, ?)\",\r\n               (user_id, loc)\r\n           )\r\n       conn.commit()\r\n   except Exception as e:\r\n       print(\"⚠ assign_user_locations error:\", e)\r\n   finally:\r\n       conn.close()\r\ndef get_user_locations(user_id):\r\n   try:\r\n       conn = get_db_connection(); cur = conn.cursor()\r\n       cur.execute(\"SELECT location_name FROM dbo.user_locations WHERE user_id = ?\", (user_id,))\r\n       rows = [r[0] for r in cur.fetchall()]\r\n       conn.close()\r\n       return rows\r\n   except:\r\n       return []\r\ndef assign_location_approvers(location, usernames):\r\n   \"\"\"Replace all approvers of a location.\"\"\"\r\n   try:\r\n       conn = get_db_connection(); cur = conn.cursor()\r\n       cur.execute(\"DELETE FROM dbo.group_approvers WHERE group_code = ?\", (location,))\r\n       for user in usernames:\r\n           cur.execute(\"\"\"\r\n               INSERT INTO dbo.group_approvers (group_code, approver_username, is_active)\r\n               VALUES (?, ?, 1)\r\n           \"\"\", (location, user))\r\n       conn.commit()\r\n   except Exception as e:\r\n       print(\"⚠ assign_location_approvers error:\", e)\r\n   finally:\r\n       conn.close()\r\ndef get_location_approvers(location):\r\n   try:\r\n       conn = get_db_connection(); cur = conn.cursor()\r\n       cur.execute(\"\"\"\r\n           SELECT approver_username\r\n           FROM dbo.group_approvers\r\n           WHERE group_code = ? AND is_active = 1\r\n       \"\"\", (location,))\r\n       rows = [r[0] for r in cur.fetchall()]\r\n       conn.close()\r\n       return rows\r\n   except:\r\n       return []\r\ndef get_all_room_locations():\r\n    try:\r\n        conn = get_db_connection(); cur = conn.cursor()\r\n        cur.execute(\"SELECT DISTINCT location FROM dbo.rooms WHERE location IS NOT NULL\")\r\n        rows = [r[0] for r in cur.fetchall()]\r\n        conn.close()\r\n        return rows\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F get_all_room_locations error:\", e)\r\n        return []\r\n\r\n# --- Edit User ---\r\n@app.route('/edit_user/<int:user_id>', methods=['GET', 'POST'])\r\n@login_required\r\ndef edit_user(user_id):\r\n    if not current_user.is_admin():\r\n        flash(\"Access denied: Admins only.\", \"warning\")\r\n        return redirect(url_for('main_menu'))\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    if request.method == 'POST':\r\n        display_name = request.form['display_name'].strip()\r\n        email = request.form['email'].strip()\r\n        role = request.form['role']\r\n        status = request.form['status']\r\n\r\n        try:\r\n            cur.execute(\"\"\"\r\n                UPDATE dbo.users\r\n                SET display_name = ?, email = ?, role = ?, status = ?, updated_at = GETDATE()\r\n                WHERE id = ?\r\n            \"\"\", (display_name, email, role, status, user_id))\r\n            conn.commit()\r\n            flash(\"✅ User updated successfully.\", \"success\")\r\n            print(f\"✅ Updated user ID {user_id}\")\r\n            return redirect(url_for('user_maintenance'))\r\n        except Exception as e:\r\n            import traceback\r\n            traceback.print_exc()\r\n            flash(f\"⚠\uFE0F Error updating user: {e}\", \"danger\")\r\n        finally:\r\n            cur.close()\r\n            conn.close()\r\n\r\n    # For GET requests: load the user details into the edit form\r\n    cur.execute(\"SELECT id, username, display_name, email, role, status FROM dbo.users WHERE id = ?\", (user_id,))\r\n    user = cur.fetchone()\r\n    conn.close()\r\n\r\n    if not user:\r\n        flash(\"⚠\uFE0F User not found.\", \"warning\")\r\n        return redirect(url_for('user_maintenance'))\r\n    #\r\n    # return render_template('edit_user.html', user=user)\r\n    locations = get_all_room_locations()\r\n    user_locations = get_user_locations(user_id)\r\n\r\n    username = user[1]  # from SELECT id, username, display_name...\r\n    approver_locations = []\r\n    for loc in locations:\r\n        if username in get_location_approvers(loc):\r\n            approver_locations.append(loc)\r\n\r\n    return render_template(\r\n        \"edit_user.html\",\r\n        user=user,\r\n        locations=locations,\r\n        user_locations=user_locations,\r\n        approver_locations=approver_locations\r\n    )\r\n\r\n\r\n# @app.route('/user_edit/<int:user_id>', methods=['GET', 'POST'])\r\n# @login_required\r\n# def user_edit(user_id):\r\n#     if not current_user.is_admin():\r\n#         flash(\"Access denied: Admins only.\")\r\n#         return redirect(url_for('main_menu'))\r\n#\r\n#     conn = get_db_connection()\r\n#     cursor = conn.cursor()\r\n#\r\n#     if request.method == 'POST':\r\n#         display_name = request.form.get('display_name')\r\n#         email = request.form.get('email')\r\n#         role = request.form.get('role')\r\n#         status = request.form.get('status')\r\n#\r\n#         try:\r\n#             cursor.execute(\"\"\"\r\n#                 UPDATE dbo.users\r\n#                 SET display_name = ?, email = ?, role = ?, status = ?, updated_at = GETDATE()\r\n#                 WHERE id = ?\r\n#             \"\"\", (display_name, email, role, status, user_id))\r\n#             conn.commit()\r\n#             flash(\"✅ User updated successfully.\", \"success\")\r\n#             log_audit(\"USER_UPDATED\", f\"Updated user ID {user_id} ({display_name})\")\r\n#             return redirect(url_for('user_maintenance'))\r\n#         except Exception as e:\r\n#             flash(f\"⚠\uFE0F Error updating user: {e}\", \"danger\")\r\n#         finally:\r\n#             conn.close()\r\n#\r\n#     # --- For GET: Load user info for the form ---\r\n#     cursor.execute(\"SELECT id, username, display_name, email, role, status FROM dbo.users WHERE id = ?\", (user_id,))\r\n#     user = cursor.fetchone()\r\n#     conn.close()\r\n#\r\n#     if not user:\r\n#         flash(\"⚠\uFE0F User not found.\", \"warning\")\r\n#         return redirect(url_for('user_maintenance'))\r\n#\r\n#     return render_template(\"edit_user.html\", user=user)\r\n# --- Admin dashboard ---\r\n@app.route('/user_edit/<int:user_id>', methods=['GET', 'POST'])\r\n@login_required\r\ndef user_edit(user_id):\r\n    if not current_user.is_admin():\r\n        flash(\"Access denied: Admins only.\")\r\n        return redirect(url_for('main_menu'))\r\n\r\n    conn = get_db_connection(); cursor = conn.cursor()\r\n\r\n    if request.method == 'POST':\r\n        display_name = request.form.get('display_name', '').strip()\r\n        email = request.form.get('email', '').strip()\r\n        role = request.form.get('role', 'user')\r\n        status = request.form.get('status', 'active')\r\n        locations = request.form.getlist('locations') or []\r\n        approver_locations = request.form.getlist('approver_locations') or []\r\n\r\n        try:\r\n            # update basic fields\r\n            cursor.execute(\"\"\"\r\n                UPDATE dbo.users\r\n                SET display_name = ?, email = ?, role = ?, status = ?, updated_at = GETDATE()\r\n                WHERE id = ?\r\n            \"\"\", (display_name, email, role, status, user_id))\r\n            conn.commit()\r\n\r\n            # update user locations\r\n            assign_user_locations(user_id, locations)\r\n\r\n            # update approver assignments:\r\n            # we'll merge this user into approver lists for selected approver_locations,\r\n            # and remove them from locations unchecked.\r\n            all_locations = get_all_room_locations()\r\n            for loc in all_locations:\r\n                existing = get_location_approvers(loc)\r\n                if loc in approver_locations:\r\n                    # ensure username present\r\n                    if current_user.username not in existing:\r\n                        # but we need to know the username of edited user\r\n                        pass\r\n\r\n            # *** We need the username of the edited user to add/remove approver rows: fetch it ***\r\n            cursor.execute(\"SELECT username FROM dbo.users WHERE id = ?\", (user_id,))\r\n            row = cursor.fetchone()\r\n            username = row[0] if row else None\r\n\r\n            # Add user to approver lists for approver_locations\r\n            for loc in approver_locations:\r\n                existing = get_location_approvers(loc)\r\n                if username and username not in existing:\r\n                    new_list = existing + [username]\r\n                    assign_location_approvers(loc, new_list)\r\n\r\n            # Remove user as approver from locations that were unchecked\r\n            for loc in get_all_room_locations():\r\n                if loc not in approver_locations:\r\n                    existing = get_location_approvers(loc)\r\n                    if username and username in existing:\r\n                        new_list = [u for u in existing if u != username]\r\n                        assign_location_approvers(loc, new_list)\r\n\r\n            log_audit(\"USER_UPDATED\", f\"Updated user {username}: locations={locations}, approver_locations={approver_locations}\")\r\n            flash(\"✅ User updated successfully.\", \"success\")\r\n            return redirect(url_for('user_maintenance'))\r\n        except Exception as e:\r\n            import traceback\r\n            traceback.print_exc()\r\n            flash(f\"⚠\uFE0F Error updating user: {e}\", \"danger\")\r\n        finally:\r\n            cursor.close()\r\n            conn.close()\r\n\r\n    # GET: show form — load user & context\r\n    cursor.execute(\"SELECT id, username, display_name, email, role, status FROM dbo.users WHERE id = ?\", (user_id,))\r\n    user = cursor.fetchone()\r\n    if not user:\r\n        flash(\"⚠\uFE0F User not found.\", \"warning\")\r\n        return redirect(url_for('user_maintenance'))\r\n\r\n    # data for form\r\n    locations = get_all_room_locations()\r\n    user_locations = get_user_locations(user_id)\r\n    username = user[1]\r\n    approver_locations = [loc for loc in locations if username in get_location_approvers(loc)]\r\n\r\n    return render_template(\"edit_user.html\", user=user, locations=locations, user_locations=user_locations, approver_locations=approver_locations)\r\n\r\n@app.route('/admin')\r\n@login_required\r\ndef admin_dashboard():\r\n    if not current_user.is_admin():\r\n        flash(\"Access denied: Admins only.\")\r\n        return redirect(url_for('main_menu'))\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n    parent_filter = request.args.get('parent_group', '')\r\n\r\n    # --- Base Query ---\r\n    sql = \"\"\"\r\n        SELECT r.id, rm.name AS room_name, rm.parent_group, r.reserved_by, r.email, \r\n               r.start_time, r.end_time, r.status, r.remarks\r\n        FROM reservations r\r\n        JOIN rooms rm ON r.room_id = rm.id\r\n    \"\"\"\r\n    params = []\r\n    if parent_filter:\r\n        sql += \" WHERE rm.parent_group = ?\"\r\n        params.append(parent_filter)\r\n\r\n    sql += \" ORDER BY r.created_at DESC\"\r\n    cur.execute(sql, params)\r\n    reservations = cur.fetchall()\r\n\r\n    # --- Stats for cards ---\r\n    cur.execute(\"SELECT COUNT(*) FROM reservations\")\r\n    (total_reservations,) = cur.fetchone()\r\n\r\n    cur.execute(\"SELECT COUNT(*) FROM reservations WHERE status='Approved'\")\r\n    (total_approved,) = cur.fetchone()\r\n\r\n    cur.execute(\"SELECT COUNT(*) FROM reservations WHERE status='Pending'\")\r\n    (total_pending,) = cur.fetchone()\r\n\r\n    cur.execute(\"SELECT COUNT(*) FROM reservations WHERE status='Cancelled'\")\r\n    (total_cancelled,) = cur.fetchone()\r\n\r\n    # --- Chart 1: Reservation Status Distribution ---\r\n    cur.execute(\"\"\"\r\n        SELECT status, COUNT(*) \r\n        FROM reservations\r\n        GROUP BY status\r\n    \"\"\")\r\n    status_data = cur.fetchall()\r\n    status_labels = [row[0] for row in status_data]\r\n    status_counts = [row[1] for row in status_data]\r\n\r\n    # --- Chart 2: Room Utilization by Location ---\r\n    cur.execute(\"\"\"\r\n        SELECT rm.parent_group, COUNT(*) \r\n        FROM reservations r\r\n        JOIN rooms rm ON r.room_id = rm.id\r\n        GROUP BY rm.parent_group\r\n        ORDER BY rm.parent_group\r\n    \"\"\")\r\n    loc_data = cur.fetchall()\r\n    loc_labels = [row[0] for row in loc_data]\r\n    loc_counts = [row[1] for row in loc_data]\r\n\r\n    # --- Load parent groups for filter dropdown ---\r\n    cur.execute(\"SELECT DISTINCT parent_group FROM rooms ORDER BY parent_group\")\r\n    parent_groups = [r[0] for r in cur.fetchall()]\r\n\r\n    conn.close()\r\n\r\n    return render_template(\r\n        'admin.html',\r\n        reservations=reservations,\r\n        parent_groups=parent_groups,\r\n        total_reservations=total_reservations,\r\n        total_approved=total_approved,\r\n        total_pending=total_pending,\r\n        total_cancelled=total_cancelled,\r\n        status_labels=status_labels,\r\n        status_counts=status_counts,\r\n        loc_labels=loc_labels,\r\n        loc_counts=loc_counts\r\n    )\r\n\r\n# User maintenance (admin-only)\r\n@app.route('/add_user', methods=['POST'])\r\n@login_required\r\ndef add_user():\r\n    if not current_user.is_admin():\r\n        flash(\"Access denied: Admins only.\", \"warning\")\r\n        return redirect(url_for('main_menu'))\r\n\r\n    username = request.form.get('username', '').strip()\r\n    email = request.form.get('email', '').strip()\r\n    display_name = request.form.get('display_name', '').strip()\r\n    role = request.form.get('role', 'user')\r\n    status = request.form.get('status', 'active')\r\n\r\n    locations = request.form.getlist('locations') or []\r\n    approver_locations = request.form.getlist('approver_locations') or []\r\n\r\n    print(\"\\n\uD83D\uDD0D ADD USER DEBUG\")\r\n    print(\"username:\", username)\r\n    print(\"locations:\", locations)\r\n    print(\"approver_locations:\", approver_locations)\r\n\r\n    if not username:\r\n        flash(\"Username required.\", \"warning\")\r\n        return redirect(url_for('user_maintenance'))\r\n\r\n    try:\r\n        conn = get_db_connection()\r\n        cur = conn.cursor()\r\n\r\n        # Check duplicate\r\n        cur.execute(\"SELECT COUNT(*) FROM dbo.users WHERE username = ?\", (username,))\r\n        exists = cur.fetchone()[0]\r\n        if exists:\r\n            flash(f\"⚠\uFE0F User {username} already exists.\", \"warning\")\r\n            return redirect(url_for('user_maintenance'))\r\n\r\n        # Insert user\r\n        cur.execute(\"\"\"\r\n            INSERT INTO dbo.users (username, display_name, email, role, status, created_at, updated_at)\r\n            VALUES (?, ?, ?, ?, ?, GETDATE(), GETDATE())\r\n        \"\"\", (username, display_name, email, role, status))\r\n        conn.commit()\r\n\r\n        # Fetch new ID\r\n        cur.execute(\"SELECT id FROM dbo.users WHERE username = ?\", (username,))\r\n        row = cur.fetchone()\r\n\r\n        if not row:\r\n            flash(\"⚠\uFE0F Failed to fetch new user ID!\", \"danger\")\r\n            print(\"❌ ERROR: Could not fetch inserted user row.\")\r\n            return redirect(url_for('user_maintenance'))\r\n\r\n        new_user_id = row[0]\r\n        print(\"✔ New user_id:\", new_user_id)\r\n\r\n        # Assign locations\r\n        assign_user_locations(new_user_id, locations)\r\n\r\n        # Assign approver roles — merge, don't overwrite others\r\n        for loc in approver_locations:\r\n            existing = get_location_approvers(loc)\r\n            if username not in existing:\r\n                assign_location_approvers(loc, existing + [username])\r\n\r\n        log_audit(\"USER_ADDED\", f\"Added user {username} with {locations}\")\r\n        flash(f\"✅ User {username} added successfully.\", \"success\")\r\n\r\n    except Exception as e:\r\n        print(\"❌ add_user ERROR:\", e)\r\n        flash(f\"⚠\uFE0F Error adding user: {e}\", \"danger\")\r\n        try: conn.rollback()\r\n        except: pass\r\n    finally:\r\n        try:\r\n            conn.close()\r\n        except:\r\n            pass\r\n\r\n    return redirect(url_for('user_maintenance'))\r\n\r\n\r\n@app.route('/delete_user/<int:user_id>', methods=['POST', 'GET'])\r\n@login_required\r\ndef delete_user(user_id):\r\n    if not current_user.is_admin():\r\n        flash(\"Access denied: Admins only.\")\r\n        return redirect(url_for('main_menu'))\r\n\r\n    conn = get_db_connection()\r\n    cursor = conn.cursor()\r\n    cursor.execute(\"DELETE FROM dbo.users WHERE id = ?\", (user_id,))\r\n    conn.commit()\r\n    cursor.close()\r\n    conn.close()\r\n\r\n    flash(\"\uD83D\uDDD1\uFE0F User deleted successfully.\")\r\n    return redirect(url_for('user_maintenance'))\r\n\r\n@app.route('/user_maintenance', methods=['GET', 'POST'])\r\n@login_required\r\ndef user_maintenance():\r\n    if not current_user.is_admin():\r\n        flash(\"Access denied: Admins only.\", \"warning\")\r\n        return redirect(url_for('main_menu'))\r\n\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    # ---------- POST = Add User ----------\r\n    if request.method == 'POST':\r\n        username = request.form.get('username', '').strip()\r\n        display_name = request.form.get('display_name', '').strip()\r\n        email = request.form.get('email', '').strip()\r\n        role = request.form.get('role', 'user')\r\n        status = request.form.get('status', 'active')\r\n\r\n        locations = request.form.getlist('locations')\r\n        approver_locations = request.form.getlist('approver_locations')\r\n\r\n        print(\"\\n\uD83D\uDFE6 DEBUG ADD USER\")\r\n        print(\"username:\", username)\r\n        print(\"locations:\", locations)\r\n        print(\"approver_locations:\", approver_locations)\r\n\r\n        try:\r\n            if not username:\r\n                flash(\"Username required.\", \"warning\")\r\n                return redirect(url_for('user_maintenance'))\r\n\r\n            # Check if exists\r\n            cur.execute(\"SELECT COUNT(*) FROM users WHERE username = ?\", (username,))\r\n            if cur.fetchone()[0] > 0:\r\n                flash(f\"⚠\uFE0F User {username} already exists.\", \"warning\")\r\n                return redirect(url_for('user_maintenance'))\r\n\r\n            # Insert user\r\n            cur.execute(\"\"\"\r\n                INSERT INTO users (username, display_name, email, role, status, created_at, updated_at)\r\n                VALUES (?, ?, ?, ?, ?, GETDATE(), GETDATE())\r\n            \"\"\", (username, display_name, email, role, status))\r\n            conn.commit()\r\n\r\n            # fetch ID\r\n            cur.execute(\"SELECT id FROM users WHERE username = ?\", (username,))\r\n            new_id = cur.fetchone()[0]\r\n\r\n            # assign locations\r\n            assign_user_locations(new_id, locations)\r\n\r\n            # assign approver\r\n            for loc in approver_locations:\r\n                existing = get_location_approvers(loc)\r\n                if username not in existing:\r\n                    assign_location_approvers(loc, existing + [username])\r\n\r\n            flash(\"✅ User added successfully!\", \"success\")\r\n\r\n        except Exception as e:\r\n            print(\"❌ Add User Error:\", e)\r\n            flash(f\"Error adding user: {e}\", \"danger\")\r\n\r\n        finally:\r\n            cur.close()\r\n            conn.close()\r\n\r\n        return redirect(url_for('user_maintenance'))\r\n\r\n    # ---------- GET = Load Page ----------\r\n\r\n    # Reload connection for GET\r\n    conn = get_db_connection()\r\n    cur = conn.cursor()\r\n\r\n    cur.execute(\"\"\"\r\n        SELECT id, username, display_name, email, role, status, last_login, last_login_ip\r\n        FROM users ORDER BY created_at DESC\r\n    \"\"\")\r\n    users = cur.fetchall()\r\n\r\n    locations = get_all_room_locations()\r\n\r\n    cur.close()\r\n    conn.close()\r\n\r\n    return render_template(\r\n        'user_maintenance.html',\r\n        users=users,\r\n        locations=locations\r\n    )\r\n\r\n\r\n# @app.route('/user_maintenance', methods=['GET', 'POST'])\r\n# @login_required\r\n# def user_maintenance():\r\n#     if not current_user.is_admin():\r\n#         flash(\"Access denied: Admins only.\", \"warning\")\r\n#         return redirect(url_for('main_menu'))\r\n#\r\n#     try:\r\n#         conn = get_db_connection()\r\n#         cursor = conn.cursor()\r\n#\r\n#         # Handle POST (Add new user)\r\n#         if request.method == 'POST':\r\n#             username = request.form['username'].strip()\r\n#             email = request.form.get('email')\r\n#             display_name = request.form.get('display_name')\r\n#             role = request.form.get('role', 'user')\r\n#             status = request.form.get('status', 'active')\r\n#             # # 1. Read user locations\r\n#             locations = request.form.getlist(\"locations\")\r\n#\r\n#             cursor.execute(\"SELECT COUNT(*) FROM dbo.users WHERE username = ?\", (username,))\r\n#             (exists,) = cursor.fetchone() or (0,)\r\n#             if exists:\r\n#                 flash(f\"⚠\uFE0F User {username} already exists.\", \"warning\")\r\n#             else:\r\n#                 cursor.execute(\"\"\"\r\n#                     INSERT INTO dbo.users (username, email, display_name, role, status, created_at, updated_at)\r\n#                     VALUES (?, ?, ?, ?, ?, GETDATE(), GETDATE())\r\n#                 \"\"\", (username, email, display_name, role, status))\r\n#                 conn.commit()\r\n#                 flash(f\"✅ User {username} added successfully.\", \"success\")\r\n#                 log_audit(\"USER_ADDED\", f\"Added user {username} with role {role}\")\r\n#\r\n#         # Fetch all users\r\n#         cursor.execute(\"\"\"\r\n#             SELECT id, username, display_name, email, role, status, last_login, last_login_ip\r\n#             FROM dbo.users\r\n#             ORDER BY created_at DESC\r\n#         \"\"\")\r\n#         users = cursor.fetchall()\r\n#         conn.close()\r\n#\r\n#         print(f\"\uD83D\uDCCB Loaded {len(users)} users.\")\r\n#         return render_template('user_maintenance.html', users=users)\r\n#\r\n#     except Exception as e:\r\n#         print(\"⚠\uFE0F user_maintenance error:\", e)\r\n#         flash(\"System error while loading users.\", \"danger\")\r\n#         # ✅ Add this redirect or fallback render:\r\n#         return redirect(url_for('main_menu'))\r\n#\r\n#     # except Exception as e:\r\n#     #     print(\"⚠\uFE0F user_maintenance error:\", e)\r\n#     #     # Log and show descriptive error\r\n#     #     flash(f\"⚠\uFE0F A system error occurred while loading users.<br><small>{e}</small>\", \"danger\")\r\n#     #     # ✅ Render the page with an empty user list (so it won't break)\r\n#     #     return render_template('user_maintenance.html', users=[])\r\n\r\n@app.route('/menu')\r\n@login_required\r\ndef main_menu():\r\n    # ---------------------------------------------------------\r\n    # 1. DB Status\r\n    # ---------------------------------------------------------\r\n    db_status = \"❌ Database Connection Failed\"\r\n    try:\r\n        conn = get_db_connection()\r\n        cursor = conn.cursor()\r\n        cursor.execute(\"SELECT 1\")\r\n        db_status = \"\uD83D\uDFE2 Database Connected\"\r\n        conn.close()\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F DB check failed:\", e)\r\n\r\n    # ---------------------------------------------------------\r\n    # 2. AD Status\r\n    # ---------------------------------------------------------\r\n    ad_status = \"⚠\uFE0F AD Test Credentials Missing\"\r\n    try:\r\n        if AD_SERVER and AD_TEST_USER and AD_TEST_PASS:\r\n            server = Server(\r\n                AD_SERVER,\r\n                port=AD_PORT,\r\n                use_ssl=AD_USE_SSL,\r\n                get_info=ALL,\r\n                connect_timeout=3\r\n            )\r\n            conn_ldap = Connection(\r\n                server,\r\n                user=AD_TEST_USER,\r\n                password=AD_TEST_PASS,\r\n                auto_bind=True\r\n            )\r\n            ad_status = \"\uD83D\uDD12 AD Connection OK\"\r\n            conn_ldap.unbind()\r\n        else:\r\n            ad_status = \"⚠\uFE0F AD Test Credentials Missing in .env\"\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F AD connection test failed:\", e)\r\n        ad_status = \"❌ AD Unreachable\"\r\n\r\n    # ---------------------------------------------------------\r\n    # 3. Load Dashboard Stats (optimized)\r\n    # ---------------------------------------------------------\r\n    username = current_user.username\r\n\r\n    try:\r\n        conn = get_db_connection()\r\n        cursor = conn.cursor()\r\n\r\n        # One optimized query for ALL COUNT metrics\r\n        cursor.execute(\"\"\"\r\n            SELECT \r\n                -- total active rooms user can see\r\n                (SELECT COUNT(*) FROM rooms r\r\n                     WHERE r.status='Active'\r\n                     AND EXISTS (\r\n                        SELECT 1 FROM user_locations ul\r\n                        JOIN users u ON ul.user_id = u.id\r\n                        WHERE u.username = ? AND ul.location_name = r.location\r\n                     )\r\n                ) AS room_count,\r\n\r\n                -- pending\r\n                (SELECT COUNT(*) FROM reservations rs\r\n                     JOIN rooms r ON r.id = rs.room_id\r\n                     WHERE rs.status='Pending' AND r.status='Active'\r\n                     AND EXISTS (\r\n                        SELECT 1 FROM user_locations ul\r\n                        JOIN users u ON ul.user_id = u.id\r\n                        WHERE u.username = ? AND ul.location_name = r.location\r\n                     )\r\n                ) AS pending_count,\r\n\r\n                -- approved\r\n                (SELECT COUNT(*) FROM reservations rs\r\n                     JOIN rooms r ON r.id = rs.room_id\r\n                     WHERE rs.status='Approved' AND r.status='Active'\r\n                     AND EXISTS (\r\n                        SELECT 1 FROM user_locations ul\r\n                        JOIN users u ON ul.user_id = u.id\r\n                        WHERE u.username = ? AND ul.location_name = r.location\r\n                     )\r\n                ) AS approved_count,\r\n\r\n                -- cancelled\r\n                (SELECT COUNT(*) FROM reservations rs\r\n                     JOIN rooms r ON r.id = rs.room_id\r\n                     WHERE rs.status='Cancelled' AND r.status='Active'\r\n                     AND EXISTS (\r\n                        SELECT 1 FROM user_locations ul\r\n                        JOIN users u ON ul.user_id = u.id\r\n                        WHERE u.username = ? AND ul.location_name = r.location\r\n                     )\r\n                ) AS cancelled_count\r\n        \"\"\", (username, username, username, username))\r\n\r\n        row = cursor.fetchone()\r\n        room_count, pending_count, approved_count, cancelled_count = row\r\n\r\n        # ---------------------------------------------------------\r\n        # Chart Query (Last 7 days, location-filtered)\r\n        # ---------------------------------------------------------\r\n        cursor.execute(\"\"\"\r\n            SELECT \r\n                CONVERT(VARCHAR(10), rs.start_time, 120) AS date,\r\n                rs.status,\r\n                COUNT(*) AS count\r\n            FROM reservations rs\r\n            JOIN rooms r ON r.id = rs.room_id\r\n            WHERE rs.start_time >= DATEADD(DAY, -6, CAST(GETDATE() AS date))\r\n            AND EXISTS (\r\n                SELECT 1 FROM user_locations ul\r\n                JOIN users u ON ul.user_id = u.id\r\n                WHERE u.username = ? AND ul.location_name = r.location\r\n            )\r\n            GROUP BY CONVERT(VARCHAR(10), rs.start_time, 120), rs.status\r\n            ORDER BY date\r\n        \"\"\", (username,))\r\n\r\n        rows = cursor.fetchall()\r\n        conn.close()\r\n\r\n        # ---------------------------------------------------------\r\n        # Build chart arrays\r\n        # ---------------------------------------------------------\r\n        date_list = [(datetime.now() - timedelta(days=i)).strftime(\"%Y-%m-%d\") for i in range(6, -1, -1)]\r\n        date_map = {d: {\"Pending\": 0, \"Approved\": 0} for d in date_list}\r\n\r\n        for d, status, cnt in rows:\r\n            if d in date_map and status in date_map[d]:\r\n                date_map[d][status] = cnt\r\n\r\n        chart_labels = date_list\r\n        chart_pending = [date_map[d][\"Pending\"] for d in date_list]\r\n        chart_approved = [date_map[d][\"Approved\"] for d in date_list]\r\n\r\n    except Exception as e:\r\n        print(\"⚠\uFE0F Dashboard load error:\", e)\r\n        room_count = pending_count = approved_count = cancelled_count = 0\r\n        chart_labels = chart_pending = chart_approved = []\r\n\r\n    # ---------------------------------------------------------\r\n    # 4. Render\r\n    # ---------------------------------------------------------\r\n    user_info = f\"{current_user.display_name or current_user.username} ({current_user.role})\"\r\n\r\n    return render_template(\r\n        \"menu.html\",\r\n        room_count=room_count,\r\n        pending_count=pending_count,\r\n        approved_count=approved_count,\r\n        cancelled_count=cancelled_count,\r\n        chart_labels=chart_labels,\r\n        chart_pending=chart_pending,\r\n        chart_approved=chart_approved,\r\n        db_status=db_status,\r\n        ad_status=ad_status,\r\n        user_info=user_info\r\n    )\r\n\r\n\r\n# if __name__ == '__main__':\r\n#     print(\"\uD83E\uDDE9 Initializing WebAXIS System...\")\r\n#     ensure_default_admin()\r\n#     is_dev = os.getenv(\"FLASK_ENV\", \"development\").lower() == \"development\"\r\n#     print(f\"\uD83D\uDCBB Running in {'Development' if is_dev else 'Production'} mode\")\r\n#     print(\"\uD83D\uDE80 WebAXIS RoomSys available at http://127.0.0.1:5000/login\")\r\n#     if is_dev and os.environ.get(\"WERKZEUG_RUN_MAIN\") == \"true\":\r\n#         threading.Timer(1.5, lambda: webbrowser.open_new(\"http://127.0.0.1:5000/login\")).start()\r\n#     app.run(debug=is_dev, use_reloader=False)\r\n# @app.route('/')\r\n# def splash():\r\n#     return render_template('splash.html')\r\n\r\nif __name__ == '__main__':\r\n    print(\"Initializing WebAXIS System...\")\r\n    ensure_default_admin()\r\n\r\n    # True if running local dev, false if running inside docker\r\n    is_dev = os.getenv(\"FLASK_ENV\", \"development\").lower() == \"development\"\r\n    print(f\"Running in {'Development' if is_dev else 'Production'} mode\")\r\n\r\n    if is_dev:\r\n        # Development mode → Local PC → 127.0.0.1 binding\r\n        print(\"WebAXIS RoomSys available at http://127.0.0.1:5000/login\")\r\n\r\n        # Auto-open browser only during development\r\n        if os.environ.get(\"WERKZEUG_RUN_MAIN\") == \"true\":\r\n            threading.Timer(\r\n                1.5,\r\n                lambda: webbrowser.open_new(\"http://127.0.0.1:5000/login\")\r\n            #     webbrowser.open_new(\"http://127.0.0.1:5000/login\")\r\n\r\n            ).start()\r\n\r\n        app.run(\r\n            host=\"127.0.0.1\",\r\n            port=5000,\r\n            debug=True,\r\n            use_reloader=True\r\n        )\r\n\r\n    else:\r\n        # Production mode → Docker → must bind to 0.0.0.0\r\n        print(\"WebAXIS RoomSys available at http://0.0.0.0:5000/login\")\r\n\r\n        app.run(\r\n            host=\"0.0.0.0\",\r\n            port=5000,\r\n            debug=False,\r\n            use_reloader=False\r\n        )\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app.py b/app.py
--- a/app.py	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
+++ b/app.py	(date 1772034156521)
@@ -583,40 +583,158 @@
         return True
 
 
+# @app.route('/login', methods=['GET', 'POST'])
+# def login():
+#     if current_user.is_authenticated:
+#         return redirect(url_for('main_menu'))
+#     if request.method == 'POST':
+#         username = request.form.get('username', '').strip()
+#         password = request.form.get('password', '').strip()
+#         remember = bool(request.form.get('remember'))
+#         if not username or not password:
+#             flash("Please enter username and password.")
+#             return redirect(url_for('login'))
+#         user = None
+#         ad_ok = False
+#         if AD_SERVER:
+#              ad_ok = True
+#             # ad_ok = authenticate_ldap(username, password)
+#         if ad_ok:
+#             conn = get_db_connection(); cursor = conn.cursor()
+#             cursor.execute("SELECT id, username, email, display_name, role FROM dbo.users WHERE username = ?", (username,))
+#             row = cursor.fetchone(); conn.close()
+#             if row:
+#                 uid, uname, email, display_name, role = row
+#                 user = User(uid, uname, email, display_name, role)
+#         else:
+#             user = authenticate_local(username, password)
+#         if not user:
+#             flash("❌ Invalid username or password.")
+#             log_audit("LOGIN_FAILED", f"Failed login for {username}")
+#             return redirect(url_for('login'))
+#         login_user(user, remember=remember)
+#         log_audit("LOGIN_SUCCESS", f"User {user.username} logged in")
+#         flash(f"✅ Welcome {user.display_name or user.username}!")
+#         return redirect(url_for('main_menu'))
+#     return render_template('login.html')
 @app.route('/login', methods=['GET', 'POST'])
 def login():
+
     if current_user.is_authenticated:
         return redirect(url_for('main_menu'))
-    if request.method == 'POST':
+
+    username = None
+    password = None
+    remember = False
+
+    # ----------------------------------
+    # 1️⃣ API JSON LOGIN
+    # ----------------------------------
+    if request.is_json:
+        data = request.get_json()
+        username = data.get("username", "").strip()
+        password = data.get("password", "").strip()
+
+    # ----------------------------------
+    # 2️⃣ FORM LOGIN (login.html)
+    # ----------------------------------
+    elif request.method == 'POST':
         username = request.form.get('username', '').strip()
         password = request.form.get('password', '').strip()
         remember = bool(request.form.get('remember'))
-        if not username or not password:
-            flash("Please enter username and password.")
-            return redirect(url_for('login'))
-        user = None
-        ad_ok = False
-        if AD_SERVER:
-             ad_ok = True
-            # ad_ok = authenticate_ldap(username, password)
-        if ad_ok:
-            conn = get_db_connection(); cursor = conn.cursor()
-            cursor.execute("SELECT id, username, email, display_name, role FROM dbo.users WHERE username = ?", (username,))
-            row = cursor.fetchone(); conn.close()
-            if row:
-                uid, uname, email, display_name, role = row
-                user = User(uid, uname, email, display_name, role)
-        else:
-            user = authenticate_local(username, password)
-        if not user:
-            flash("❌ Invalid username or password.")
-            log_audit("LOGIN_FAILED", f"Failed login for {username}")
-            return redirect(url_for('login'))
-        login_user(user, remember=remember)
-        log_audit("LOGIN_SUCCESS", f"User {user.username} logged in")
-        flash(f"✅ Welcome {user.display_name or user.username}!")
-        return redirect(url_for('main_menu'))
-    return render_template('login.html')
+
+    # ----------------------------------
+    # 3️⃣ OPTIONAL: URL PARAM LOGIN
+    # ----------------------------------
+    elif request.method == 'GET' and request.args.get("username"):
+        username = request.args.get("username", "").strip()
+        password = request.args.get("password", "").strip()
+
+    # If just opening /login normally
+    else:
+        return render_template('login.html')
+
+    # ----------------------------------
+    # VALIDATION
+    # ----------------------------------
+    if not username or not password:
+        return jsonify({"success": False, "message": "Missing credentials"}), 400
+
+    user = None
+    ad_ok = False
+
+    if AD_SERVER:
+        ad_ok = True
+        # ad_ok = authenticate_ldap(username, password)
+
+    if ad_ok:
+        conn = get_db_connection()
+        cursor = conn.cursor()
+        cursor.execute(
+            "SELECT id, username, email, display_name, role FROM dbo.users WHERE username = ?",
+            (username,)
+        )
+        row = cursor.fetchone()
+        conn.close()
+
+        if row:
+            uid, uname, email, display_name, role = row
+            user = User(uid, uname, email, display_name, role)
+    else:
+        user = authenticate_local(username, password)
+
+    if not user:
+        log_audit("LOGIN_FAILED", f"Failed login for {username}")
+        return jsonify({"success": False, "message": "Invalid credentials"}), 401
+
+    login_user(user, remember=remember)
+    log_audit("LOGIN_SUCCESS", f"User {user.username} logged in")
+
+    # If API request → return JSON
+    if request.is_json:
+        return jsonify({"success": True, "redirect": url_for('main_menu')})
+
+    # Otherwise redirect normally
+    return redirect(url_for('main_menu'))
+
+import itsdangerous
+serializer = itsdangerous.URLSafeTimedSerializer(app.secret_key)
+
+@app.route('/sso-login')
+def sso_login():
+    token = request.args.get("token")
+
+    if not token:
+        return "Missing token", 400
+
+    try:
+        # Token expires after 60 seconds
+        data = serializer.loads(token, max_age=60)
+        username = data.get("username")
+
+    except Exception:
+        return "Invalid or expired token", 401
+
+    # Load user from DB
+    conn = get_db_connection()
+    cursor = conn.cursor()
+    cursor.execute(
+        "SELECT id, username, email, display_name, role FROM dbo.users WHERE username = ?",
+        (username,)
+    )
+    row = cursor.fetchone()
+    conn.close()
+
+    if not row:
+        return "User not found", 404
+
+    uid, uname, email, display_name, role = row
+    user = User(uid, uname, email, display_name, role)
+
+    login_user(user)
+    log_audit("SSO_LOGIN", f"SSO login for {user.username}")
+
+    return redirect(url_for("main_menu"))
 
 @app.route('/logout')
 @login_required
@@ -3192,6 +3310,7 @@
 # def splash():
 #     return render_template('splash.html')
 
+
 if __name__ == '__main__':
     print("Initializing WebAXIS System...")
     ensure_default_admin()
Index: .idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM__Changes_.xml
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM__Changes_.xml b/.idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM__Changes_.xml
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM__Changes_.xml	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
+++ /dev/null	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
@@ -1,9 +0,0 @@
-<changelist name="Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM_[Changes]" date="1771499800784" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM_[Changes]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before Update at 2/19/2026 7:15 PM [Changes]" />
-  <binary>
-    <option name="BEFORE_PATH" value="static/img/Pepsi_logo_Flash.png" />
-    <option name="AFTER_PATH" value="static/img/Pepsi_logo_Flash.png" />
-    <option name="SHELVED_PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM_[Changes]/Pepsi_logo_Flash.png" />
-  </binary>
-</changelist>
\ No newline at end of file
Index: .idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM__Changes_.xml
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM__Changes_.xml b/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM__Changes_.xml
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM__Changes_.xml	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
+++ /dev/null	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
@@ -1,9 +0,0 @@
-<changelist name="Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]" date="1771415277211" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before Update at 2/18/2026 7:46 PM [Changes]" />
-  <binary>
-    <option name="BEFORE_PATH" value="static/img/Pepsi_logo_Flash.png" />
-    <option name="AFTER_PATH" value="static/img/Pepsi_logo_Flash.png" />
-    <option name="SHELVED_PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]/Pepsi_logo_Flash.png" />
-  </binary>
-</changelist>
\ No newline at end of file
Index: .idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]/shelved.patch
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]/shelved.patch b/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]/shelved.patch
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]/shelved.patch	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
+++ /dev/null	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
@@ -1,285 +0,0 @@
-Index: templates/splash.html
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n<meta charset=\"UTF-8\">\r\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';\">\r\n<title>WebAXIS Loading...</title>\r\n\r\n<style>\r\n  body {\r\n    background: #0047AB;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    height: 100vh;\r\n    margin: 0;\r\n    opacity: 1;\r\n    transition: opacity 1.3s ease-out;\r\n  }\r\n\r\n  /* Splash Logo */\r\n  .splash-logo {\r\n    width: 200px;       /* Perfect size for splash */\r\n    height: auto;\r\n    animation: fadeIn 2.2s ease-out forwards;\r\n  }\r\n\r\n  /* Fade-in animation */\r\n  @keyframes fadeIn {\r\n    0% { opacity: 0; transform: scale(0.85); }\r\n    100% { opacity: 1; transform: scale(1); }\r\n  }\r\n    /* Spinner Style */\r\n.spinner {\r\n  border: 4px solid rgba(255, 255, 255, 0.3); /* Light grey ring */\r\n  border-top: 4px solid #ffffff; /* White moving part */\r\n  border-radius: 50%;\r\n  width: 30px;\r\n  height: 30px;\r\n  margin-top: 20px; /* Space it below the logo */\r\n  animation: spin 1s linear infinite;\r\n  opacity: 0; /* Start hidden */\r\n  animation-delay: 0.5s; /* Wait for logo to appear */\r\n  animation-fill-mode: forwards;\r\n}\r\n\r\n/* Spinner Rotation Keyframes */\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n</style>\r\n\r\n<script>\r\n  // Stay visible for 3.2s → fade out → then go to login\r\n  setTimeout(function() {\r\n\r\n      // Fade-out\r\n      document.body.style.opacity = \"0\";\r\n\r\n      // After fade-out completes, redirect\r\n      setTimeout(() => {\r\n          window.location.href = \"/login\";\r\n      }, 1300); // fade-out time\r\n\r\n  }, 3200); // visible duration before fade-out starts\r\n</script>\r\n\r\n</head>\r\n<body>\r\n    <div style=\"display: flex; flex-direction: column; align-items: center;\">\r\n        <img src=\"{{ url_for('static', filename='img/pepsi_logo_flash.png') }}\"\r\n            alt=\"WebAXIS Logo\"\r\n            class=\"splash-logo\">\r\n\r\n        <div class=\"spinner\"></div>\r\n    </div>\r\n</body>\r\n</html>\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/templates/splash.html b/templates/splash.html
---- a/templates/splash.html	(revision 717a3fbe0330875d38ef6a5b5112ce31e6a64010)
-+++ b/templates/splash.html	(date 1764080809548)
-@@ -20,7 +20,7 @@
- 
-   /* Splash Logo */
-   .splash-logo {
--    width: 200px;       /* Perfect size for splash */
-+    width: 500px;       /* Perfect size for splash */
-     height: auto;
-     animation: fadeIn 2.2s ease-out forwards;
-   }
-@@ -35,8 +35,8 @@
-   border: 4px solid rgba(255, 255, 255, 0.3); /* Light grey ring */
-   border-top: 4px solid #ffffff; /* White moving part */
-   border-radius: 50%;
--  width: 30px;
--  height: 30px;
-+  width: 100px;
-+  height: 100px;
-   margin-top: 20px; /* Space it below the logo */
-   animation: spin 1s linear infinite;
-   opacity: 0; /* Start hidden */
-Index: templates/login.html
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>{% extends \"base_login.html\" %}\r\n{% block title %}Login | WebAXIS{% endblock %}\r\n\r\n{% block content %}\r\n<div class=\"login-card text-center shadow-lg\">\r\n  <img src=\"{{ url_for('static', filename='img/pcppi_logo.png') }}\" alt=\"PCPPI Logo\" class=\"login-logo mb-3\">\r\n\r\n  <h2 class=\"fw-bold text-primary mb-1\">WebAXIS RoomSys</h2>\r\n  <p class=\"text-muted mb-4 fw-semibold\">PCPPI Room Reservation Portal</p>\r\n\r\n  <form method=\"POST\" action=\"{{ url_for('login') }}\">\r\n    <div class=\"mb-3 text-start\">\r\n      <label for=\"username\" class=\"form-label fw-bold text-dark\">Domain Username</label>\r\n      <input type=\"text\" name=\"username\" id=\"username\"\r\n             class=\"form-control form-control-lg fw-semibold\"\r\n             placeholder=\"e.g. mlvelasco\" required>\r\n    </div>\r\n\r\n    <div class=\"mb-3 text-start\">\r\n      <label for=\"password\" class=\"form-label fw-bold text-dark\">Password</label>\r\n      <input type=\"password\" name=\"password\" id=\"password\"\r\n             class=\"form-control form-control-lg fw-semibold\" required>\r\n    </div>\r\n\r\n    <div class=\"form-check mb-4 text-start\">\r\n      <input type=\"checkbox\" class=\"form-check-input\" id=\"remember\" name=\"remember\">\r\n      <label class=\"form-check-label text-dark\" for=\"remember\">Remember me on this device</label>\r\n    </div>\r\n\r\n    <button type=\"submit\" class=\"btn btn-primary w-100 py-3 fw-bold\">\r\n      <i class=\"bi bi-box-arrow-in-right me-2\"></i> Sign In\r\n    </button>\r\n  </form>\r\n\r\n  <div class=\"text-light small mt-4 opacity-75\">\r\n    <i class=\"bi bi-shield-lock\"></i> Secured by <strong>Active Directory</strong>\r\n  </div>\r\n</div>\r\n{% endblock %}\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/templates/login.html b/templates/login.html
---- a/templates/login.html	(revision 717a3fbe0330875d38ef6a5b5112ce31e6a64010)
-+++ b/templates/login.html	(date 1764081436319)
-@@ -1,39 +1,102 @@
--{% extends "base_login.html" %}
--{% block title %}Login | WebAXIS{% endblock %}
-+<!DOCTYPE html>
-+<html lang="en">
-+<head>
-+    <meta charset="UTF-8">
-+    <meta name="viewport" content="width=device-width, initial-scale=1.0">
-+    <title>WebAXIS - Secure Login</title>
-+    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
-+
-+    <style>
-+        /* Body Styling: Keeps the same background blue */
-+        body {
-+            background: #0047AB; /* Pepsi Blue */
-+            font-family: Arial, sans-serif;
-+            display: flex;
-+            justify-content: center;
-+            align-items: center;
-+            height: 100vh;
-+            margin: 0;
-+        }
-+
-+        /* Login Card */
-+        .login-card {
-+            background: #ffffff;
-+            padding: 40px;
-+            border-radius: 10px;
-+            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
-+            width: 350px;
-+            text-align: center;
-+        }
-+
-+        /* Logo Styling */
-+        .login-logo {
-+            width: 120px; /* Smaller size for the main login page */
-+            margin-bottom: 20px;
-+        }
-+
-+        /* Form Elements */
-+        .input-group {
-+            margin-bottom: 20px;
-+            text-align: left;
-+        }
-+
-+        .input-group label {
-+            display: block;
-+            margin-bottom: 5px;
-+            font-weight: bold;
-+            color: #333;
-+        }
-+
-+        .input-group input[type="text"], 
-+        .input-group input[type="password"] {
-+            width: 100%;
-+            padding: 10px;
-+            border: 1px solid #ccc;
-+            border-radius: 5px;
-+            box-sizing: border-box; /* Includes padding in the width */
-+        }
-+
-+        .login-button {
-+            width: 100%;
-+            padding: 12px;
-+            background-color: #D3171B; /* Pepsi Red/Maroon for contrast */
-+            color: white;
-+            border: none;
-+            border-radius: 5px;
-+            font-size: 16px;
-+            cursor: pointer;
-+            transition: background-color 0.3s ease;
-+        }
- 
--{% block content %}
--<div class="login-card text-center shadow-lg">
--  <img src="{{ url_for('static', filename='img/pcppi_logo.png') }}" alt="PCPPI Logo" class="login-logo mb-3">
-+        .login-button:hover {
-+            background-color: #b31416;
-+        }
-+    </style>
-+</head>
-+<body>
- 
--  <h2 class="fw-bold text-primary mb-1">WebAXIS RoomSys</h2>
--  <p class="text-muted mb-4 fw-semibold">PCPPI Room Reservation Portal</p>
-+    <div class="login-card">
-+        <img src="{{ url_for('static', filename='img/pepsi_logo_flash.png') }}"
-+            alt="WebAXIS Logo"
-+            class="login-logo">
- 
--  <form method="POST" action="{{ url_for('login') }}">
--    <div class="mb-3 text-start">
--      <label for="username" class="form-label fw-bold text-dark">Domain Username</label>
--      <input type="text" name="username" id="username"
--             class="form-control form-control-lg fw-semibold"
--             placeholder="e.g. mlvelasco" required>
--    </div>
--
--    <div class="mb-3 text-start">
--      <label for="password" class="form-label fw-bold text-dark">Password</label>
--      <input type="password" name="password" id="password"
--             class="form-control form-control-lg fw-semibold" required>
--    </div>
-+        <h2>Room Reservation Login</h2>
-+        
-+        <form method="POST" action="/login">
-+            
-+            <div class="input-group">
-+                <label for="username">Username / ID</label>
-+                <input type="text" id="username" name="username" required>
-+            </div>
- 
--    <div class="form-check mb-4 text-start">
--      <input type="checkbox" class="form-check-input" id="remember" name="remember">
--      <label class="form-check-label text-dark" for="remember">Remember me on this device</label>
--    </div>
-+            <div class="input-group">
-+                <label for="password">Password</label>
-+                <input type="password" id="password" name="password" required>
-+            </div>
- 
--    <button type="submit" class="btn btn-primary w-100 py-3 fw-bold">
--      <i class="bi bi-box-arrow-in-right me-2"></i> Sign In
--    </button>
--  </form>
--
--  <div class="text-light small mt-4 opacity-75">
--    <i class="bi bi-shield-lock"></i> Secured by <strong>Active Directory</strong>
--  </div>
--</div>
--{% endblock %}
-+            <button type="submit" class="login-button">Log In</button>
-+        </form>
-+    </div>
-+
-+</body>
-+</html>
-\ No newline at end of file
-Index: templates/room_schedule.html
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>{% extends \"base_dashboard.html\" %}\r\n{% block title %}Room Schedule | WebAXIS{% endblock %}\r\n\r\n{% block content %}\r\n<div class=\"container-fluid py-3\">\r\n  <div class=\"d-flex justify-content-between align-items-center mb-3\">\r\n    <div class=\"d-flex align-items-center gap-3\">\r\n      <h3 class=\"fw-bold mb-0\"><i class=\"bi bi-journal-bookmark\"></i> Shared Resources</h3>\r\n\r\n      <form id=\"dateForm\" method=\"get\" class=\"d-inline-block\">\r\n        <input type=\"date\" name=\"date\" id=\"selectedDate\" class=\"form-control form-control-sm\"\r\n               value=\"{{ selected_date.strftime('%Y-%m-%d') if selected_date else '' }}\">\r\n      </form>\r\n\r\n      <button id=\"goToday\" class=\"btn btn-sm btn-outline-secondary\">Today</button>\r\n\r\n      <div class=\"btn-group btn-group-sm ms-2\" role=\"group\" aria-label=\"View mode\">\r\n        <button id=\"dailyBtn\" class=\"btn btn-primary\">Daily</button>\r\n        <button id=\"weeklyBtn\" class=\"btn btn-outline-primary\">Weekly</button>\r\n      </div>\r\n    </div>\r\n\r\n    <div>\r\n      <a class=\"btn btn-outline-secondary btn-sm\" href=\"{{ url_for('menu') }}\"><i class=\"bi bi-house\"></i> Home</a>\r\n      <a class=\"btn btn-outline-info btn-sm\" href=\"{{ url_for('room_list') }}\"><i class=\"bi bi-list\"></i> All Rooms</a>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"row gx-3\">\r\n    <!-- Left: room tree / list -->\r\n    <div class=\"col-md-3\">\r\n      <div class=\"card shadow-sm mb-3\" style=\"max-height:75vh; overflow:auto;\">\r\n        <div class=\"card-body p-3\">\r\n          <h6 class=\"fw-semibold\">Rooms</h6>\r\n          <div class=\"list-group list-group-flush\">\r\n            {% for room in rooms %}\r\n              <a href=\"#room-{{ room.id }}\" class=\"list-group-item list-group-item-action small\">\r\n                {{ room.building ~ ' › ' ~ room.name }}\r\n              </a>\r\n            {% else %}\r\n              <div class=\"text-muted small\">No rooms defined.</div>\r\n            {% endfor %}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"card shadow-sm\">\r\n        <div class=\"card-body p-3\">\r\n          <h6 class=\"fw-semibold\">Legend</h6>\r\n          <div class=\"small\">\r\n            <div class=\"d-flex align-items-center mb-1\"><span style=\"width:18px;height:18px;display:inline-block;background:#2ca02c;border-radius:3px;margin-right:8px;\"></span> Approved</div>\r\n            <div class=\"d-flex align-items-center mb-1\"><span style=\"width:18px;height:18px;display:inline-block;background:#ffcc00;border-radius:3px;margin-right:8px;\"></span> Pending</div>\r\n            <div class=\"d-flex align-items-center\"><span style=\"width:18px;height:18px;display:inline-block;background:#d9534f;border-radius:3px;margin-right:8px;\"></span> Cancelled</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Right: timeline -->\r\n    <div class=\"col-md-9\">\r\n      <div class=\"card shadow-sm\">\r\n        <div class=\"card-body p-3\">\r\n          <div class=\"table-responsive\">\r\n            <table class=\"table table-borderless align-middle\">\r\n              <thead>\r\n                <tr>\r\n                  <th class=\"w-25\">Resource</th>\r\n                  {% for h in range(0,24) %}\r\n                    <th class=\"text-center p-1 small\" style=\"min-width:36px;\">{{ '%02d' % h }}</th>\r\n                  {% endfor %}\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {% for room in rooms %}\r\n                <tr id=\"room-{{ room.id }}\">\r\n                  <td class=\"align-middle\">\r\n                    <div class=\"fw-semibold\">{{ room.building }} › {{ room.name }}</div>\r\n                    <div class=\"small text-muted\">{{ room.capacity or '-' }} pax — {{ room.location or '-' }}</div>\r\n                    <div class=\"mt-2\">\r\n                      <a href=\"{{ url_for('reserve', room_id=room.id) }}\" class=\"btn btn-sm btn-primary me-1\">\r\n                        <i class=\"bi bi-plus-square\"></i> Reserve\r\n                      </a>\r\n                      <button type=\"button\" class=\"btn btn-sm btn-outline-info\" onclick=\"showRoomInfo({{ room.id }})\">\r\n                        <i class=\"bi bi-info-circle\"></i> Info\r\n                      </button>\r\n                    </div>\r\n                  </td>\r\n\r\n                  {% for hour in range(0,24) %}\r\n                  <td class=\"timeline-cell p-0\" data-room=\"{{ room.id }}\" data-hour=\"{{ hour }}\">\r\n                    <div class=\"cell-inner w-100 h-100\" style=\"height:38px;\"></div>\r\n                  </td>\r\n                  {% endfor %}\r\n                </tr>\r\n                {% else %}\r\n                <tr><td colspan=\"25\" class=\"text-center text-muted\">No rooms available.</td></tr>\r\n                {% endfor %}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- My reservations for the day (quick list) -->\r\n      <div class=\"card shadow-sm mt-3\">\r\n        <div class=\"card-body p-3\">\r\n          <h6 class=\"fw-semibold\">My Reservations ({{ selected_date.strftime('%Y-%m-%d') if selected_date else '' }})</h6>\r\n          <div class=\"table-responsive\">\r\n            <table class=\"table table-sm table-striped\">\r\n              <thead class=\"table-light\">\r\n                <tr>\r\n                  <th>Room</th>\r\n                  <th>Time</th>\r\n                  <th>Remarks / Purpose</th>\r\n                  <th>Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody id=\"myReservationsBody\">\r\n                <!-- Filled by JS -->\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div> <!-- col-md-9 -->\r\n  </div> <!-- row -->\r\n</div>\r\n\r\n<!-- Room info modal (simple) -->\r\n<div class=\"modal fade\" id=\"roomInfoModal\" tabindex=\"-1\" aria-hidden=\"true\">\r\n  <div class=\"modal-dialog modal-dialog-centered\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h5 id=\"roomInfoTitle\" class=\"modal-title\"></h5>\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n      </div>\r\n      <div class=\"modal-body\" id=\"roomInfoBody\"></div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary btn-sm\" data-bs-dismiss=\"modal\">Close</button>\r\n        <a id=\"reserveFromInfo\" class=\"btn btn-primary btn-sm\" href=\"#\">Reserve</a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .timeline-cell { border-left: 1px solid rgba(0,0,0,0.03); vertical-align: middle; }\r\n  .cell-inner { transition: background-color .2s ease; border-radius: 6px; margin:3px; padding:2px; }\r\n  .cell-approved { background:#2ca02c33; box-shadow: 0 2px 8px rgba(0,0,0,0.08) inset; }\r\n  .cell-pending  { background:#ffcc0033; }\r\n  .cell-cancelled{ background:#d9534f33; }\r\n  .small-legend { font-size:0.85rem; }\r\n  @media (max-width: 992px) {\r\n    .timeline-cell .cell-inner { height:28px; }\r\n  }\r\n</style>\r\n\r\n<script>\r\n  // pass server-side objects to JS\r\n  const reservations = {{ reservations|tojson | safe }};\r\n  const rooms = {{ rooms|tojson | safe }};\r\n  const currentUser = \"{{ current_user.username if current_user else '' }}\";\r\n\r\n  // Map for status -> CSS class + badge\r\n  const statusClass = {\r\n    \"Approved\": \"cell-approved\",\r\n    \"Pending\": \"cell-pending\",\r\n    \"Cancelled\": \"cell-cancelled\"\r\n  };\r\n\r\n  // Utility: parse ISO timestamps (server should send ISO strings)\r\n  function parseISO(s) {\r\n    // If incoming is already Date object, return it\r\n    if (!s) return null;\r\n    return new Date(s);\r\n  }\r\n\r\n  // Fill timeline cells based on reservations\r\n  function paintTimeline() {\r\n    // clear all cells\r\n    document.querySelectorAll('.timeline-cell .cell-inner').forEach(el => {\r\n      el.className = 'cell-inner w-100 h-100';\r\n      el.title = '';\r\n      el.innerHTML = '';\r\n    });\r\n\r\n    // Build map of my reservations for \"My Reservations\" area\r\n    const myRows = [];\r\n\r\n    for (const r of reservations) {\r\n      // ensure iso strings\r\n      const start = parseISO(r.start_time);\r\n      const end = parseISO(r.end_time);\r\n      if (!start || !end) continue;\r\n\r\n      // calculate hour range (inclusive start hour, exclusive end)\r\n      const roomId = String(r.room_id || r.roomId || r.room_id);\r\n\r\n      // push to my reservations if reserved_by == currentUser\r\n      if (r.reserved_by === currentUser) {\r\n        myRows.push(r);\r\n      }\r\n\r\n      // mark hourly cells for that reservation\r\n      for (let h = 0; h < 24; h++) {\r\n        // cell hour start and end\r\n        const cellStart = new Date(start);\r\n        cellStart.setHours(h, 0, 0, 0);\r\n        const cellEnd = new Date(start);\r\n        cellEnd.setHours(h + 1, 0, 0, 0);\r\n\r\n        // if reservation overlaps with this cell hour\r\n        if (cellEnd > start && cellStart < end) {\r\n          const td = document.querySelector(`.timeline-cell[data-room=\"${roomId}\"][data-hour=\"${h}\"] .cell-inner`);\r\n          if (td) {\r\n            const cls = statusClass[r.status] || 'cell-pending';\r\n            td.classList.add(cls);\r\n            // tooltip text\r\n            td.title = `${r.reserved_by} — ${new Date(r.start_time).toLocaleString()} → ${new Date(r.end_time).toLocaleTimeString()} (${r.status})`;\r\n            // show small label when cell is first hour of reservation\r\n            const hourStart = (new Date(r.start_time)).getHours();\r\n            if (h === hourStart) {\r\n              td.innerHTML = `<div class=\"small text-truncate\"><b>${r.reserved_by}</b></div>`;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // populate My Reservations table\r\n    const tbody = document.getElementById('myReservationsBody');\r\n    tbody.innerHTML = '';\r\n    if (myRows.length === 0) {\r\n      tbody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center text-muted\">No reservations for this date.</td></tr>';\r\n    } else {\r\n      myRows.sort((a,b) => new Date(a.start_time) - new Date(b.start_time));\r\n      for (const r of myRows) {\r\n        const roomObj = rooms.find(x => String(x.id) === String(r.room_id));\r\n        const roomName = roomObj ? `${roomObj.building} › ${roomObj.name}` : `#${r.room_id}`;\r\n        const tr = document.createElement('tr');\r\n        tr.innerHTML = `\r\n          <td>${roomName}</td>\r\n          <td>${new Date(r.start_time).toLocaleString()} - ${new Date(r.end_time).toLocaleTimeString()}</td>\r\n          <td>${r.remarks || r.purpose || '-'}</td>\r\n          <td><span class=\"badge ${r.status === 'Approved' ? 'bg-success' : r.status === 'Pending' ? 'bg-warning text-dark' : 'bg-danger'}\">${r.status}</span></td>\r\n        `;\r\n        tbody.appendChild(tr);\r\n      }\r\n    }\r\n  }\r\n\r\n  function showRoomInfo(roomId) {\r\n    const r = rooms.find(x => String(x.id) === String(roomId));\r\n    if (!r) return;\r\n    document.getElementById('roomInfoTitle').innerText = `${r.building} › ${r.name}`;\r\n    document.getElementById('roomInfoBody').innerHTML = `\r\n      <p><strong>Capacity:</strong> ${r.capacity || '-'} pax</p>\r\n      <p><strong>Location:</strong> ${r.location || '-'}</p>\r\n      <p><strong>Description:</strong><br>${(r.description || '-')}</p>\r\n    `;\r\n    const reserveUrl = \"{{ url_for('reserve', room_id='__ROOMID__') }}\".replace('__ROOMID__', r.id);\r\n    document.getElementById('reserveFromInfo').href = reserveUrl;\r\n    const modal = new bootstrap.Modal(document.getElementById('roomInfoModal'));\r\n    modal.show();\r\n  }\r\n\r\n  // initialize\r\n  document.addEventListener('DOMContentLoaded', function() {\r\n    paintTimeline();\r\n\r\n    // if user changes date -> submit\r\n    document.getElementById('selectedDate').addEventListener('change', function(){ document.getElementById('dateForm').submit(); });\r\n    document.getElementById('goToday').addEventListener('click', function(){ window.location = \"{{ url_for('room_schedule') }}\"; });\r\n\r\n    // daily/weekly quick styling (week not implemented here; placeholder)\r\n    document.getElementById('dailyBtn').addEventListener('click', function(){\r\n      this.classList.add('btn-primary'); document.getElementById('weeklyBtn').classList.remove('btn-primary');\r\n      // if you implement weekly view, load it here\r\n    });\r\n    document.getElementById('weeklyBtn').addEventListener('click', function(){\r\n      this.classList.add('btn-primary'); document.getElementById('dailyBtn').classList.remove('btn-primary');\r\n      Swal.fire({icon:'info', title:'Weekly view', text:'Weekly view is planned (Phase 2).'});\r\n    });\r\n\r\n    // simple tooltips enable\r\n    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'))\r\n    tooltipTriggerList.map(function (el) {\r\n      new bootstrap.Tooltip(el)\r\n    })\r\n  });\r\n</script>\r\n{% endblock %}\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/templates/room_schedule.html b/templates/room_schedule.html
---- a/templates/room_schedule.html	(revision 717a3fbe0330875d38ef6a5b5112ce31e6a64010)
-+++ b/templates/room_schedule.html	(date 1770641280768)
-@@ -289,4 +289,5 @@
-     })
-   });
- </script>
-+
- {% endblock %}
-Index: .idea/shelf/Uncommitted_changes_before_Update_at_11_20_2025_6_41_PM__Changes_.xml
-===================================================================
-diff --git a/.idea/shelf/Uncommitted_changes_before_Update_at_11_20_2025_6_41_PM__Changes_.xml b/.idea/shelf/Uncommitted_changes_before_Update_at_11_20_2025_6_41_PM__Changes_.xml
-deleted file mode 100644
---- a/.idea/shelf/Uncommitted_changes_before_Update_at_11_20_2025_6_41_PM__Changes_.xml	(revision 717a3fbe0330875d38ef6a5b5112ce31e6a64010)
-+++ /dev/null	(revision 717a3fbe0330875d38ef6a5b5112ce31e6a64010)
-@@ -1,4 +0,0 @@
--<changelist name="Uncommitted_changes_before_Update_at_11_20_2025_6_41_PM_[Changes]" date="1763635301990" recycled="true" deleted="true">
--  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_11_20_2025_6_41_PM_[Changes]/shelved.patch" />
--  <option name="DESCRIPTION" value="Uncommitted changes before Update at 11/20/2025 6:41 PM [Changes]" />
--</changelist>
-\ No newline at end of file
-Index: .idea/workspace.xml
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"e38152d8-cf4c-4200-8245-858a548afff2\" name=\"Changes\" comment=\"Room 11/20/2025 Home laptop V2\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/WebAXIS Room.iml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/WebAXIS Room.iml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/misc.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/misc.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_11_14_2025_6_40_PM_[Changes]/shelved.patch\" beforeDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_11_14_2025_6_40_PM__Changes_.xml\" beforeDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/static/css/webaxis_dashboard.css\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/static/css/webaxis_dashboard.css\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/templates/IndexBack.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/IndexBack.html\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/templates/base_dashboard.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/base_dashboard.html\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/templates/index.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/index.html\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/templates/menu.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/menu.html\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Python Script\" />\r\n        <option value=\"CSS File\" />\r\n        <option value=\"HTML File\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;,\r\n    &quot;assignee&quot;: &quot;mrmlvelasco-hue&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">{\r\n  &quot;selectedUrlAndAccountId&quot;: {\r\n    &quot;url&quot;: &quot;https://github.com/mrmlvelasco-hue/WebAxis-Room.git&quot;,\r\n    &quot;accountId&quot;: &quot;5cb6a370-6101-4134-8beb-5de7ec3dd091&quot;\r\n  }\r\n}</component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;associatedIndex&quot;: 1\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"35As1UHHHHOsoksZwy0hDrBZRRd\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">{\r\n  &quot;keyToString&quot;: {\r\n    &quot;DefaultHtmlFileTemplate&quot;: &quot;HTML File&quot;,\r\n    &quot;JavaScript Debug.admin.html.executor&quot;: &quot;Run&quot;,\r\n    &quot;JavaScript Debug.calendar_view.html.executor&quot;: &quot;Run&quot;,\r\n    &quot;JavaScript Debug.index.html.executor&quot;: &quot;Run&quot;,\r\n    &quot;JavaScript Debug.user_maintenance.html.executor&quot;: &quot;Run&quot;,\r\n    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,\r\n    &quot;Python.WebAXIS Room.executor&quot;: &quot;Run&quot;,\r\n    &quot;Python.app.executor&quot;: &quot;Run&quot;,\r\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\r\n    &quot;git-widget-placeholder&quot;: &quot;master&quot;,\r\n    &quot;list.type.of.created.stylesheet&quot;: &quot;CSS&quot;,\r\n    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,\r\n    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,\r\n    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,\r\n    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,\r\n    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,\r\n    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;\r\n  }\r\n}</component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"MoveFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\mlvelasco\\PycharmProjects\\WebAXIS Room\\templates\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"RunManager\">\r\n    <configuration name=\"WebAXIS Room\" type=\"PythonConfigurationType\" factoryName=\"Python\" temporary=\"true\">\r\n      <module name=\"WebAXIS Room\" />\r\n      <option name=\"ENV_FILES\" value=\"\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"true\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/app.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <recent_temporary>\r\n      <list>\r\n        <item itemvalue=\"Python.WebAXIS Room\" />\r\n      </list>\r\n    </recent_temporary>\r\n  </component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-python-sdk-b3d66beaba9a-c6efb3732140-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-252.26199.168\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"e38152d8-cf4c-4200-8245-858a548afff2\" name=\"Changes\" comment=\"\" />\r\n      <created>1762563995612</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1762563995612</updated>\r\n      <workItem from=\"1762563996713\" duration=\"6263000\" />\r\n      <workItem from=\"1762610684125\" duration=\"9930000\" />\r\n      <workItem from=\"1762652964113\" duration=\"42236000\" />\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"Room 11/09/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762653084027</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762653084027</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"Room 11/09/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762687548691</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762687548691</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"Room 11/13/2025 Home laptop\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763041154616</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763041154616</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"Room 11/14/2025 Home laptop V2\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763048441590</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763048441590</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"Room 11/15/2025 Home laptop V2\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763144582111</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763144582111</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"Room 11/16/2025 Home laptop V2\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763300814441</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763300814441</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"7\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State />\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"Room 11/09/2025\" />\r\n    <MESSAGE value=\"Room 11/13/2025 Home laptop\" />\r\n    <MESSAGE value=\"Room 11/14/2025 Home laptop V2\" />\r\n    <MESSAGE value=\"Room 11/15/2025 Home laptop V2\" />\r\n    <MESSAGE value=\"Room 11/16/2025 Home laptop V2\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"Room 11/16/2025 Home laptop V2\" />\r\n  </component>\r\n  <component name=\"XDebuggerManager\">\r\n    <breakpoint-manager>\r\n      <breakpoints>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>618</line>\r\n          <option name=\"timeStamp\" value=\"7\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>370</line>\r\n          <option name=\"timeStamp\" value=\"13\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>202</line>\r\n          <option name=\"timeStamp\" value=\"14\" />\r\n        </line-breakpoint>\r\n      </breakpoints>\r\n    </breakpoint-manager>\r\n  </component>\r\n  <component name=\"com.intellij.coverage.CoverageDataManagerImpl\">\r\n    <SUITE FILE_PATH=\"coverage/WebAXIS_Room$app.coverage\" NAME=\"app Coverage Results\" MODIFIED=\"1762876383583\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"false\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$\" />\r\n  </component>\r\n</project>
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/.idea/workspace.xml b/.idea/workspace.xml
---- a/.idea/workspace.xml	(revision 717a3fbe0330875d38ef6a5b5112ce31e6a64010)
-+++ b/.idea/workspace.xml	(date 1771415142462)
-@@ -4,17 +4,13 @@
-     <option name="autoReloadType" value="SELECTIVE" />
-   </component>
-   <component name="ChangeListManager">
--    <list default="true" id="e38152d8-cf4c-4200-8245-858a548afff2" name="Changes" comment="Room 11/20/2025 Home laptop V2">
--      <change beforePath="$PROJECT_DIR$/.idea/WebAXIS Room.iml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/WebAXIS Room.iml" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/.idea/misc.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/misc.xml" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_11_14_2025_6_40_PM_[Changes]/shelved.patch" beforeDir="false" />
--      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_11_14_2025_6_40_PM__Changes_.xml" beforeDir="false" />
-+    <list default="true" id="e38152d8-cf4c-4200-8245-858a548afff2" name="Changes" comment="Room 11/25/2025 Home laptop V2">
-+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_11_20_2025_6_41_PM__Changes_.xml" beforeDir="false" />
-       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/static/css/webaxis_dashboard.css" beforeDir="false" afterPath="$PROJECT_DIR$/static/css/webaxis_dashboard.css" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/templates/IndexBack.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/IndexBack.html" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/templates/base_dashboard.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/base_dashboard.html" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/templates/index.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/index.html" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/templates/menu.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/menu.html" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/static/img/Pepsi_logo_Flash.png" beforeDir="false" afterPath="$PROJECT_DIR$/static/img/Pepsi_logo_Flash.png" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/templates/login.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/login.html" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/templates/room_schedule.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/room_schedule.html" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/templates/splash.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/splash.html" afterDir="false" />
-     </list>
-     <option name="SHOW_DIALOG" value="false" />
-     <option name="HIGHLIGHT_CONFLICTS" value="true" />
-@@ -67,6 +63,7 @@
-     &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,
-     &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
-     &quot;git-widget-placeholder&quot;: &quot;master&quot;,
-+    &quot;last_opened_file_path&quot;: &quot;C:/Users/mlvelasco/PycharmProjects/WebAXIS Room/static/img&quot;,
-     &quot;list.type.of.created.stylesheet&quot;: &quot;CSS&quot;,
-     &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
-     &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
-@@ -77,6 +74,9 @@
-   }
- }</component>
-   <component name="RecentsManager">
-+    <key name="CopyFile.RECENT_KEYS">
-+      <recent name="C:\Users\mlvelasco\PycharmProjects\WebAXIS Room\static\img" />
-+    </key>
-     <key name="MoveFile.RECENT_KEYS">
-       <recent name="C:\Users\mlvelasco\PycharmProjects\WebAXIS Room\templates" />
-     </key>
-@@ -176,7 +176,15 @@
-       <option name="project" value="LOCAL" />
-       <updated>1763300814441</updated>
-     </task>
--    <option name="localTasksCounter" value="7" />
-+    <task id="LOCAL-00007" summary="Room 11/25/2025 Home laptop V2">
-+      <option name="closed" value="true" />
-+      <created>1764080687119</created>
-+      <option name="number" value="00007" />
-+      <option name="presentableId" value="LOCAL-00007" />
-+      <option name="project" value="LOCAL" />
-+      <updated>1764080687119</updated>
-+    </task>
-+    <option name="localTasksCounter" value="8" />
-     <servers />
-   </component>
-   <component name="TypeScriptGeneratedFilesManager">
-@@ -199,7 +207,8 @@
-     <MESSAGE value="Room 11/14/2025 Home laptop V2" />
-     <MESSAGE value="Room 11/15/2025 Home laptop V2" />
-     <MESSAGE value="Room 11/16/2025 Home laptop V2" />
--    <option name="LAST_COMMIT_MESSAGE" value="Room 11/16/2025 Home laptop V2" />
-+    <MESSAGE value="Room 11/25/2025 Home laptop V2" />
-+    <option name="LAST_COMMIT_MESSAGE" value="Room 11/25/2025 Home laptop V2" />
-   </component>
-   <component name="XDebuggerManager">
-     <breakpoint-manager>
Index: .idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM_[Changes]/shelved.patch
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM_[Changes]/shelved.patch b/.idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM_[Changes]/shelved.patch
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_Update_at_2_19_2026_7_15_PM_[Changes]/shelved.patch	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
+++ /dev/null	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
@@ -1,327 +0,0 @@
-Index: .idea/workspace.xml
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"e38152d8-cf4c-4200-8245-858a548afff2\" name=\"Changes\" comment=\"Room 12/01/2025 office\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/app.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/static/css/webaxis_dashboard.css\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/static/css/webaxis_dashboard.css\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Python Script\" />\r\n        <option value=\"CSS File\" />\r\n        <option value=\"HTML File\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;,\r\n    &quot;assignee&quot;: &quot;mrmlvelasco-hue&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">{\r\n  &quot;selectedUrlAndAccountId&quot;: {\r\n    &quot;url&quot;: &quot;https://github.com/mrmlvelasco-hue/WebAxis-Room.git&quot;,\r\n    &quot;accountId&quot;: &quot;2983f355-5b3f-42cc-95eb-38a80702a70b&quot;\r\n  }\r\n}</component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;associatedIndex&quot;: 1\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"35As1UHHHHOsoksZwy0hDrBZRRd\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">{\r\n  &quot;keyToString&quot;: {\r\n    &quot;DefaultHtmlFileTemplate&quot;: &quot;HTML File&quot;,\r\n    &quot;JavaScript Debug.admin.html.executor&quot;: &quot;Run&quot;,\r\n    &quot;JavaScript Debug.user_maintenance.html.executor&quot;: &quot;Run&quot;,\r\n    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,\r\n    &quot;Python.PCPPI_Room.executor&quot;: &quot;Run&quot;,\r\n    &quot;Python.app.executor&quot;: &quot;Run&quot;,\r\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\r\n    &quot;git-widget-placeholder&quot;: &quot;master&quot;,\r\n    &quot;last_opened_file_path&quot;: &quot;D:/Python Project/WebAxis-Room/static/img&quot;,\r\n    &quot;list.type.of.created.stylesheet&quot;: &quot;CSS&quot;,\r\n    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,\r\n    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,\r\n    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,\r\n    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,\r\n    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,\r\n    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;\r\n  }\r\n}</component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"D:\\Python Project\\WebAxis-Room\\static\\img\" />\r\n    </key>\r\n    <key name=\"MoveFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\mlvelasco\\PycharmProjects\\WebAXIS Room\\templates\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"RunManager\">\r\n    <configuration name=\"PCPPI_Room\" type=\"PythonConfigurationType\" factoryName=\"Python\" temporary=\"true\">\r\n      <module name=\"WebAXIS Room\" />\r\n      <option name=\"ENV_FILES\" value=\"\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"true\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/app.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <recent_temporary>\r\n      <list>\r\n        <item itemvalue=\"Python.PCPPI_Room\" />\r\n      </list>\r\n    </recent_temporary>\r\n  </component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-python-sdk-7e47963ff851-f0eec537fc84-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-252.23892.515\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"e38152d8-cf4c-4200-8245-858a548afff2\" name=\"Changes\" comment=\"\" />\r\n      <created>1762563995612</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1762563995612</updated>\r\n      <workItem from=\"1762563996713\" duration=\"6263000\" />\r\n      <workItem from=\"1762610684125\" duration=\"9930000\" />\r\n      <workItem from=\"1762652964113\" duration=\"42236000\" />\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"Room 11/09/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762653084027</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762653084027</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"Room 11/09/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762687548691</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762687548691</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"Room 11/10/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762940174210</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762940174210</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"Room 11/13/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763000122876</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763000122876</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"Room 11/13/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763015848332</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763015848332</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"Room 11/18/2025 office\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763458485226</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763458485226</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00007\" summary=\"Room 11/19/2025 office\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763544630861</created>\r\n      <option name=\"number\" value=\"00007\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763544630861</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00008\" summary=\"Room 12/01/2025 office\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1764579364363</created>\r\n      <option name=\"number\" value=\"00008\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00008\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1764579364363</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"9\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"Room 11/09/2025\" />\r\n    <MESSAGE value=\"Room 11/10/2025\" />\r\n    <MESSAGE value=\"Room 11/13/2025\" />\r\n    <MESSAGE value=\"Room 11/18/2025 office\" />\r\n    <MESSAGE value=\"Room 11/19/2025 office\" />\r\n    <MESSAGE value=\"Room 12/01/2025 office\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"Room 12/01/2025 office\" />\r\n  </component>\r\n  <component name=\"XDebuggerManager\">\r\n    <breakpoint-manager>\r\n      <breakpoints>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>482</line>\r\n          <option name=\"timeStamp\" value=\"7\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>728</line>\r\n          <option name=\"timeStamp\" value=\"14\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>267</line>\r\n          <option name=\"timeStamp\" value=\"27\" />\r\n        </line-breakpoint>\r\n      </breakpoints>\r\n    </breakpoint-manager>\r\n  </component>\r\n  <component name=\"com.intellij.coverage.CoverageDataManagerImpl\">\r\n    <SUITE FILE_PATH=\"coverage/WebAXIS_Room$app.coverage\" NAME=\"app Coverage Results\" MODIFIED=\"1762697729366\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"false\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$\" />\r\n  </component>\r\n</project>
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/.idea/workspace.xml b/.idea/workspace.xml
---- a/.idea/workspace.xml	(revision 88ea0e2a6935f03ee9fcf80ca8c7cc66104be9f2)
-+++ b/.idea/workspace.xml	(date 1771499739522)
-@@ -4,10 +4,14 @@
-     <option name="autoReloadType" value="SELECTIVE" />
-   </component>
-   <component name="ChangeListManager">
--    <list default="true" id="e38152d8-cf4c-4200-8245-858a548afff2" name="Changes" comment="Room 12/01/2025 office">
-+    <list default="true" id="e38152d8-cf4c-4200-8245-858a548afff2" name="Changes" comment="Room 02/18/2026 Home laptop V2">
-+      <change beforePath="$PROJECT_DIR$/.idea/WebAXIS Room.iml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/WebAXIS Room.iml" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/.idea/misc.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/misc.xml" afterDir="false" />
-       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/app.py" beforeDir="false" afterPath="$PROJECT_DIR$/app.py" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/static/css/webaxis_dashboard.css" beforeDir="false" afterPath="$PROJECT_DIR$/static/css/webaxis_dashboard.css" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/static/img/Pepsi_logo_Flash.png" beforeDir="false" afterPath="$PROJECT_DIR$/static/img/Pepsi_logo_Flash.png" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/templates/login.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/login.html" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/templates/room_schedule.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/room_schedule.html" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/templates/splash.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/splash.html" afterDir="false" />
-     </list>
-     <option name="SHOW_DIALOG" value="false" />
-     <option name="HIGHLIGHT_CONFLICTS" value="true" />
-@@ -35,7 +39,7 @@
-   <component name="GithubPullRequestsUISettings">{
-   &quot;selectedUrlAndAccountId&quot;: {
-     &quot;url&quot;: &quot;https://github.com/mrmlvelasco-hue/WebAxis-Room.git&quot;,
--    &quot;accountId&quot;: &quot;2983f355-5b3f-42cc-95eb-38a80702a70b&quot;
-+    &quot;accountId&quot;: &quot;5cb6a370-6101-4134-8beb-5de7ec3dd091&quot;
-   }
- }</component>
-   <component name="ProjectColorInfo">{
-@@ -50,15 +54,16 @@
-   &quot;keyToString&quot;: {
-     &quot;DefaultHtmlFileTemplate&quot;: &quot;HTML File&quot;,
-     &quot;JavaScript Debug.admin.html.executor&quot;: &quot;Run&quot;,
-+    &quot;JavaScript Debug.calendar_view.html.executor&quot;: &quot;Run&quot;,
-+    &quot;JavaScript Debug.index.html.executor&quot;: &quot;Run&quot;,
-     &quot;JavaScript Debug.user_maintenance.html.executor&quot;: &quot;Run&quot;,
-     &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
--    &quot;Python.PCPPI_Room.executor&quot;: &quot;Run&quot;,
-+    &quot;Python.WebAXIS Room.executor&quot;: &quot;Run&quot;,
-     &quot;Python.app.executor&quot;: &quot;Run&quot;,
-     &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
-     &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,
-     &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
-     &quot;git-widget-placeholder&quot;: &quot;master&quot;,
--    &quot;last_opened_file_path&quot;: &quot;D:/Python Project/WebAxis-Room/static/img&quot;,
-     &quot;list.type.of.created.stylesheet&quot;: &quot;CSS&quot;,
-     &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
-     &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
-@@ -69,15 +74,12 @@
-   }
- }</component>
-   <component name="RecentsManager">
--    <key name="CopyFile.RECENT_KEYS">
--      <recent name="D:\Python Project\WebAxis-Room\static\img" />
--    </key>
-     <key name="MoveFile.RECENT_KEYS">
-       <recent name="C:\Users\mlvelasco\PycharmProjects\WebAXIS Room\templates" />
-     </key>
-   </component>
-   <component name="RunManager">
--    <configuration name="PCPPI_Room" type="PythonConfigurationType" factoryName="Python" temporary="true">
-+    <configuration name="WebAXIS Room" type="PythonConfigurationType" factoryName="Python" temporary="true">
-       <module name="WebAXIS Room" />
-       <option name="ENV_FILES" value="" />
-       <option name="INTERPRETER_OPTIONS" value="" />
-@@ -101,14 +103,14 @@
-     </configuration>
-     <recent_temporary>
-       <list>
--        <item itemvalue="Python.PCPPI_Room" />
-+        <item itemvalue="Python.WebAXIS Room" />
-       </list>
-     </recent_temporary>
-   </component>
-   <component name="SharedIndexes">
-     <attachedChunks>
-       <set>
--        <option value="bundled-python-sdk-7e47963ff851-f0eec537fc84-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-252.23892.515" />
-+        <option value="bundled-python-sdk-b3d66beaba9a-c6efb3732140-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-252.26199.168" />
-       </set>
-     </attachedChunks>
-   </component>
-@@ -139,91 +141,94 @@
-       <option name="project" value="LOCAL" />
-       <updated>1762687548691</updated>
-     </task>
--    <task id="LOCAL-00003" summary="Room 11/10/2025">
-+    <task id="LOCAL-00003" summary="Room 11/13/2025 Home laptop">
-       <option name="closed" value="true" />
--      <created>1762940174210</created>
-+      <created>1763041154616</created>
-       <option name="number" value="00003" />
-       <option name="presentableId" value="LOCAL-00003" />
-       <option name="project" value="LOCAL" />
--      <updated>1762940174210</updated>
-+      <updated>1763041154616</updated>
-     </task>
--    <task id="LOCAL-00004" summary="Room 11/13/2025">
-+    <task id="LOCAL-00004" summary="Room 11/14/2025 Home laptop V2">
-       <option name="closed" value="true" />
--      <created>1763000122876</created>
-+      <created>1763048441590</created>
-       <option name="number" value="00004" />
-       <option name="presentableId" value="LOCAL-00004" />
-       <option name="project" value="LOCAL" />
--      <updated>1763000122876</updated>
-+      <updated>1763048441590</updated>
-     </task>
--    <task id="LOCAL-00005" summary="Room 11/13/2025">
-+    <task id="LOCAL-00005" summary="Room 11/15/2025 Home laptop V2">
-       <option name="closed" value="true" />
--      <created>1763015848332</created>
-+      <created>1763144582111</created>
-       <option name="number" value="00005" />
-       <option name="presentableId" value="LOCAL-00005" />
-       <option name="project" value="LOCAL" />
--      <updated>1763015848332</updated>
-+      <updated>1763144582111</updated>
-     </task>
--    <task id="LOCAL-00006" summary="Room 11/18/2025 office">
-+    <task id="LOCAL-00006" summary="Room 11/16/2025 Home laptop V2">
-       <option name="closed" value="true" />
--      <created>1763458485226</created>
-+      <created>1763300814441</created>
-       <option name="number" value="00006" />
-       <option name="presentableId" value="LOCAL-00006" />
-       <option name="project" value="LOCAL" />
--      <updated>1763458485226</updated>
-+      <updated>1763300814441</updated>
-     </task>
--    <task id="LOCAL-00007" summary="Room 11/19/2025 office">
-+    <task id="LOCAL-00007" summary="Room 02/18/2026 Home laptop V2">
-       <option name="closed" value="true" />
--      <created>1763544630861</created>
-+      <created>1771421121940</created>
-       <option name="number" value="00007" />
-       <option name="presentableId" value="LOCAL-00007" />
-       <option name="project" value="LOCAL" />
--      <updated>1763544630861</updated>
--    </task>
--    <task id="LOCAL-00008" summary="Room 12/01/2025 office">
--      <option name="closed" value="true" />
--      <created>1764579364363</created>
--      <option name="number" value="00008" />
--      <option name="presentableId" value="LOCAL-00008" />
--      <option name="project" value="LOCAL" />
--      <updated>1764579364363</updated>
-+      <updated>1771421121941</updated>
-     </task>
--    <option name="localTasksCounter" value="9" />
-+    <option name="localTasksCounter" value="8" />
-     <servers />
-   </component>
-   <component name="TypeScriptGeneratedFilesManager">
-     <option name="version" value="3" />
-+  </component>
-+  <component name="Vcs.Log.Tabs.Properties">
-+    <option name="TAB_STATES">
-+      <map>
-+        <entry key="MAIN">
-+          <value>
-+            <State />
-+          </value>
-+        </entry>
-+      </map>
-+    </option>
-   </component>
-   <component name="VcsManagerConfiguration">
-     <MESSAGE value="Room 11/09/2025" />
--    <MESSAGE value="Room 11/10/2025" />
--    <MESSAGE value="Room 11/13/2025" />
--    <MESSAGE value="Room 11/18/2025 office" />
--    <MESSAGE value="Room 11/19/2025 office" />
--    <MESSAGE value="Room 12/01/2025 office" />
--    <option name="LAST_COMMIT_MESSAGE" value="Room 12/01/2025 office" />
-+    <MESSAGE value="Room 11/13/2025 Home laptop" />
-+    <MESSAGE value="Room 11/14/2025 Home laptop V2" />
-+    <MESSAGE value="Room 11/15/2025 Home laptop V2" />
-+    <MESSAGE value="Room 11/16/2025 Home laptop V2" />
-+    <MESSAGE value="Room 02/18/2026 Home laptop V2" />
-+    <option name="LAST_COMMIT_MESSAGE" value="Room 02/18/2026 Home laptop V2" />
-   </component>
-   <component name="XDebuggerManager">
-     <breakpoint-manager>
-       <breakpoints>
-         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
-           <url>file://$PROJECT_DIR$/app.py</url>
--          <line>482</line>
-+          <line>618</line>
-           <option name="timeStamp" value="7" />
-         </line-breakpoint>
-         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
-           <url>file://$PROJECT_DIR$/app.py</url>
--          <line>728</line>
--          <option name="timeStamp" value="14" />
-+          <line>370</line>
-+          <option name="timeStamp" value="13" />
-         </line-breakpoint>
-         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
-           <url>file://$PROJECT_DIR$/app.py</url>
--          <line>267</line>
--          <option name="timeStamp" value="27" />
-+          <line>202</line>
-+          <option name="timeStamp" value="14" />
-         </line-breakpoint>
-       </breakpoints>
-     </breakpoint-manager>
-   </component>
-   <component name="com.intellij.coverage.CoverageDataManagerImpl">
--    <SUITE FILE_PATH="coverage/WebAXIS_Room$app.coverage" NAME="app Coverage Results" MODIFIED="1762697729366" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="false" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
-+    <SUITE FILE_PATH="coverage/WebAXIS_Room$app.coverage" NAME="app Coverage Results" MODIFIED="1762876383583" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="false" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
-   </component>
- </project>
-\ No newline at end of file
-Index: templates/splash.html
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n<meta charset=\"UTF-8\">\r\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';\">\r\n<title>WebAXIS Loading...</title>\r\n\r\n<style>\r\n  body {\r\n    background: #0047AB;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    height: 100vh;\r\n    margin: 0;\r\n    opacity: 1;\r\n    transition: opacity 1.3s ease-out;\r\n  }\r\n\r\n  /* Splash Logo */\r\n  .splash-logo {\r\n    width: 200px;       /* Perfect size for splash */\r\n    height: auto;\r\n    animation: fadeIn 2.2s ease-out forwards;\r\n  }\r\n\r\n  /* Fade-in animation */\r\n  @keyframes fadeIn {\r\n    0% { opacity: 0; transform: scale(0.85); }\r\n    100% { opacity: 1; transform: scale(1); }\r\n  }\r\n    /* Spinner Style */\r\n.spinner {\r\n  border: 4px solid rgba(255, 255, 255, 0.3); /* Light grey ring */\r\n  border-top: 4px solid #ffffff; /* White moving part */\r\n  border-radius: 50%;\r\n  width: 30px;\r\n  height: 30px;\r\n  margin-top: 20px; /* Space it below the logo */\r\n  animation: spin 1s linear infinite;\r\n  opacity: 0; /* Start hidden */\r\n  animation-delay: 0.5s; /* Wait for logo to appear */\r\n  animation-fill-mode: forwards;\r\n}\r\n\r\n/* Spinner Rotation Keyframes */\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n</style>\r\n\r\n<script>\r\n  // Stay visible for 3.2s → fade out → then go to login\r\n  setTimeout(function() {\r\n\r\n      // Fade-out\r\n      document.body.style.opacity = \"0\";\r\n\r\n      // After fade-out completes, redirect\r\n      setTimeout(() => {\r\n          window.location.href = \"/login\";\r\n      }, 1300); // fade-out time\r\n\r\n  }, 3200); // visible duration before fade-out starts\r\n</script>\r\n\r\n</head>\r\n<body>\r\n    <div style=\"display: flex; flex-direction: column; align-items: center;\">\r\n        <img src=\"{{ url_for('static', filename='img/pepsi_logo_flash.png') }}\"\r\n            alt=\"WebAXIS Logo\"\r\n            class=\"splash-logo\">\r\n\r\n        <div class=\"spinner\"></div>\r\n    </div>\r\n</body>\r\n</html>\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/templates/splash.html b/templates/splash.html
---- a/templates/splash.html	(revision 88ea0e2a6935f03ee9fcf80ca8c7cc66104be9f2)
-+++ b/templates/splash.html	(date 1771415204458)
-@@ -20,7 +20,7 @@
- 
-   /* Splash Logo */
-   .splash-logo {
--    width: 200px;       /* Perfect size for splash */
-+    width: 500px;       /* Perfect size for splash */
-     height: auto;
-     animation: fadeIn 2.2s ease-out forwards;
-   }
-@@ -35,8 +35,8 @@
-   border: 4px solid rgba(255, 255, 255, 0.3); /* Light grey ring */
-   border-top: 4px solid #ffffff; /* White moving part */
-   border-radius: 50%;
--  width: 30px;
--  height: 30px;
-+  width: 100px;
-+  height: 100px;
-   margin-top: 20px; /* Space it below the logo */
-   animation: spin 1s linear infinite;
-   opacity: 0; /* Start hidden */
-Index: templates/login.html
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>{% extends \"base_login.html\" %}\r\n{% block title %}Login | WebAXIS{% endblock %}\r\n\r\n{% block content %}\r\n<div class=\"login-card text-center shadow-lg\">\r\n  <img src=\"{{ url_for('static', filename='img/pcppi_logo.png') }}\" alt=\"PCPPI Logo\" class=\"login-logo mb-3\">\r\n\r\n  <h2 class=\"fw-bold text-primary mb-1\">PCPPI</h2>\r\n  <p class=\"text-muted mb-4 fw-semibold\">Room Reservation Portal</p>\r\n\r\n  <form method=\"POST\" action=\"{{ url_for('login') }}\">\r\n    <div class=\"mb-3 text-start\">\r\n      <label for=\"username\" class=\"form-label fw-bold text-dark\">Domain Username</label>\r\n      <input type=\"text\" name=\"username\" id=\"username\"\r\n             class=\"form-control form-control-lg fw-semibold\"\r\n             placeholder=\"e.g. mlvelasco\" required>\r\n    </div>\r\n\r\n    <div class=\"mb-3 text-start\">\r\n      <label for=\"password\" class=\"form-label fw-bold text-dark\">Password</label>\r\n      <input type=\"password\" name=\"password\" id=\"password\"\r\n             class=\"form-control form-control-lg fw-semibold\" required>\r\n    </div>\r\n\r\n    <div class=\"form-check mb-4 text-start\">\r\n      <input type=\"checkbox\" class=\"form-check-input\" id=\"remember\" name=\"remember\">\r\n      <label class=\"form-check-label text-dark\" for=\"remember\">Remember me on this device</label>\r\n    </div>\r\n\r\n    <button type=\"submit\" class=\"btn btn-primary w-100 py-3 fw-bold\">\r\n      <i class=\"bi bi-box-arrow-in-right me-2\"></i> Sign In\r\n    </button>\r\n  </form>\r\n\r\n  <div class=\"text-light small mt-4 opacity-75\">\r\n    <i class=\"bi bi-shield-lock\"></i> Secured by <strong>Active Directory</strong>\r\n  </div>\r\n</div>\r\n{% endblock %}\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/templates/login.html b/templates/login.html
---- a/templates/login.html	(revision 88ea0e2a6935f03ee9fcf80ca8c7cc66104be9f2)
-+++ b/templates/login.html	(date 1771415250745)
-@@ -5,8 +5,8 @@
- <div class="login-card text-center shadow-lg">
-   <img src="{{ url_for('static', filename='img/pcppi_logo.png') }}" alt="PCPPI Logo" class="login-logo mb-3">
- 
--  <h2 class="fw-bold text-primary mb-1">PCPPI</h2>
--  <p class="text-muted mb-4 fw-semibold">Room Reservation Portal</p>
-+  <h2 class="fw-bold text-primary mb-1">WebAXIS RoomSys</h2>
-+  <p class="text-muted mb-4 fw-semibold">PCPPI Room Reservation Portal</p>
- 
-   <form method="POST" action="{{ url_for('login') }}">
-     <div class="mb-3 text-start">
-Index: templates/room_schedule.html
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>{% extends \"base_dashboard.html\" %}\r\n{% block title %}Room Schedule | WebAXIS{% endblock %}\r\n\r\n{% block content %}\r\n<div class=\"container-fluid py-3\">\r\n  <div class=\"d-flex justify-content-between align-items-center mb-3\">\r\n    <div class=\"d-flex align-items-center gap-3\">\r\n      <h3 class=\"fw-bold mb-0\"><i class=\"bi bi-journal-bookmark\"></i> Shared Resources</h3>\r\n\r\n      <form id=\"dateForm\" method=\"get\" class=\"d-inline-block\">\r\n        <input type=\"date\" name=\"date\" id=\"selectedDate\" class=\"form-control form-control-sm\"\r\n               value=\"{{ selected_date.strftime('%Y-%m-%d') if selected_date else '' }}\">\r\n      </form>\r\n\r\n      <button id=\"goToday\" class=\"btn btn-sm btn-outline-secondary\">Today</button>\r\n\r\n      <div class=\"btn-group btn-group-sm ms-2\" role=\"group\" aria-label=\"View mode\">\r\n        <button id=\"dailyBtn\" class=\"btn btn-primary\">Daily</button>\r\n        <button id=\"weeklyBtn\" class=\"btn btn-outline-primary\">Weekly</button>\r\n      </div>\r\n    </div>\r\n\r\n    <div>\r\n      <a class=\"btn btn-outline-secondary btn-sm\" href=\"{{ url_for('menu') }}\"><i class=\"bi bi-house\"></i> Home</a>\r\n      <a class=\"btn btn-outline-info btn-sm\" href=\"{{ url_for('room_list') }}\"><i class=\"bi bi-list\"></i> All Rooms</a>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"row gx-3\">\r\n    <!-- Left: room tree / list -->\r\n    <div class=\"col-md-3\">\r\n      <div class=\"card shadow-sm mb-3\" style=\"max-height:75vh; overflow:auto;\">\r\n        <div class=\"card-body p-3\">\r\n          <h6 class=\"fw-semibold\">Rooms</h6>\r\n          <div class=\"list-group list-group-flush\">\r\n            {% for room in rooms %}\r\n              <a href=\"#room-{{ room.id }}\" class=\"list-group-item list-group-item-action small\">\r\n                {{ room.building ~ ' › ' ~ room.name }}\r\n              </a>\r\n            {% else %}\r\n              <div class=\"text-muted small\">No rooms defined.</div>\r\n            {% endfor %}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"card shadow-sm\">\r\n        <div class=\"card-body p-3\">\r\n          <h6 class=\"fw-semibold\">Legend</h6>\r\n          <div class=\"small\">\r\n            <div class=\"d-flex align-items-center mb-1\"><span style=\"width:18px;height:18px;display:inline-block;background:#2ca02c;border-radius:3px;margin-right:8px;\"></span> Approved</div>\r\n            <div class=\"d-flex align-items-center mb-1\"><span style=\"width:18px;height:18px;display:inline-block;background:#ffcc00;border-radius:3px;margin-right:8px;\"></span> Pending</div>\r\n            <div class=\"d-flex align-items-center\"><span style=\"width:18px;height:18px;display:inline-block;background:#d9534f;border-radius:3px;margin-right:8px;\"></span> Cancelled</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Right: timeline -->\r\n    <div class=\"col-md-9\">\r\n      <div class=\"card shadow-sm\">\r\n        <div class=\"card-body p-3\">\r\n          <div class=\"table-responsive\">\r\n            <table class=\"table table-borderless align-middle\">\r\n              <thead>\r\n                <tr>\r\n                  <th class=\"w-25\">Resource</th>\r\n                  {% for h in range(0,24) %}\r\n                    <th class=\"text-center p-1 small\" style=\"min-width:36px;\">{{ '%02d' % h }}</th>\r\n                  {% endfor %}\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {% for room in rooms %}\r\n                <tr id=\"room-{{ room.id }}\">\r\n                  <td class=\"align-middle\">\r\n                    <div class=\"fw-semibold\">{{ room.building }} › {{ room.name }}</div>\r\n                    <div class=\"small text-muted\">{{ room.capacity or '-' }} pax — {{ room.location or '-' }}</div>\r\n                    <div class=\"mt-2\">\r\n                      <a href=\"{{ url_for('reserve', room_id=room.id) }}\" class=\"btn btn-sm btn-primary me-1\">\r\n                        <i class=\"bi bi-plus-square\"></i> Reserve\r\n                      </a>\r\n                      <button type=\"button\" class=\"btn btn-sm btn-outline-info\" onclick=\"showRoomInfo({{ room.id }})\">\r\n                        <i class=\"bi bi-info-circle\"></i> Info\r\n                      </button>\r\n                    </div>\r\n                  </td>\r\n\r\n                  {% for hour in range(0,24) %}\r\n                  <td class=\"timeline-cell p-0\" data-room=\"{{ room.id }}\" data-hour=\"{{ hour }}\">\r\n                    <div class=\"cell-inner w-100 h-100\" style=\"height:38px;\"></div>\r\n                  </td>\r\n                  {% endfor %}\r\n                </tr>\r\n                {% else %}\r\n                <tr><td colspan=\"25\" class=\"text-center text-muted\">No rooms available.</td></tr>\r\n                {% endfor %}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- My reservations for the day (quick list) -->\r\n      <div class=\"card shadow-sm mt-3\">\r\n        <div class=\"card-body p-3\">\r\n          <h6 class=\"fw-semibold\">My Reservations ({{ selected_date.strftime('%Y-%m-%d') if selected_date else '' }})</h6>\r\n          <div class=\"table-responsive\">\r\n            <table class=\"table table-sm table-striped\">\r\n              <thead class=\"table-light\">\r\n                <tr>\r\n                  <th>Room</th>\r\n                  <th>Time</th>\r\n                  <th>Remarks / Purpose</th>\r\n                  <th>Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody id=\"myReservationsBody\">\r\n                <!-- Filled by JS -->\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div> <!-- col-md-9 -->\r\n  </div> <!-- row -->\r\n</div>\r\n\r\n<!-- Room info modal (simple) -->\r\n<div class=\"modal fade\" id=\"roomInfoModal\" tabindex=\"-1\" aria-hidden=\"true\">\r\n  <div class=\"modal-dialog modal-dialog-centered\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h5 id=\"roomInfoTitle\" class=\"modal-title\"></h5>\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n      </div>\r\n      <div class=\"modal-body\" id=\"roomInfoBody\"></div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary btn-sm\" data-bs-dismiss=\"modal\">Close</button>\r\n        <a id=\"reserveFromInfo\" class=\"btn btn-primary btn-sm\" href=\"#\">Reserve</a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .timeline-cell { border-left: 1px solid rgba(0,0,0,0.03); vertical-align: middle; }\r\n  .cell-inner { transition: background-color .2s ease; border-radius: 6px; margin:3px; padding:2px; }\r\n  .cell-approved { background:#2ca02c33; box-shadow: 0 2px 8px rgba(0,0,0,0.08) inset; }\r\n  .cell-pending  { background:#ffcc0033; }\r\n  .cell-cancelled{ background:#d9534f33; }\r\n  .small-legend { font-size:0.85rem; }\r\n  @media (max-width: 992px) {\r\n    .timeline-cell .cell-inner { height:28px; }\r\n  }\r\n</style>\r\n\r\n<script>\r\n  // pass server-side objects to JS\r\n  const reservations = {{ reservations|tojson | safe }};\r\n  const rooms = {{ rooms|tojson | safe }};\r\n  const currentUser = \"{{ current_user.username if current_user else '' }}\";\r\n\r\n  // Map for status -> CSS class + badge\r\n  const statusClass = {\r\n    \"Approved\": \"cell-approved\",\r\n    \"Pending\": \"cell-pending\",\r\n    \"Cancelled\": \"cell-cancelled\"\r\n  };\r\n\r\n  // Utility: parse ISO timestamps (server should send ISO strings)\r\n  function parseISO(s) {\r\n    // If incoming is already Date object, return it\r\n    if (!s) return null;\r\n    return new Date(s);\r\n  }\r\n\r\n  // Fill timeline cells based on reservations\r\n  function paintTimeline() {\r\n    // clear all cells\r\n    document.querySelectorAll('.timeline-cell .cell-inner').forEach(el => {\r\n      el.className = 'cell-inner w-100 h-100';\r\n      el.title = '';\r\n      el.innerHTML = '';\r\n    });\r\n\r\n    // Build map of my reservations for \"My Reservations\" area\r\n    const myRows = [];\r\n\r\n    for (const r of reservations) {\r\n      // ensure iso strings\r\n      const start = parseISO(r.start_time);\r\n      const end = parseISO(r.end_time);\r\n      if (!start || !end) continue;\r\n\r\n      // calculate hour range (inclusive start hour, exclusive end)\r\n      const roomId = String(r.room_id || r.roomId || r.room_id);\r\n\r\n      // push to my reservations if reserved_by == currentUser\r\n      if (r.reserved_by === currentUser) {\r\n        myRows.push(r);\r\n      }\r\n\r\n      // mark hourly cells for that reservation\r\n      for (let h = 0; h < 24; h++) {\r\n        // cell hour start and end\r\n        const cellStart = new Date(start);\r\n        cellStart.setHours(h, 0, 0, 0);\r\n        const cellEnd = new Date(start);\r\n        cellEnd.setHours(h + 1, 0, 0, 0);\r\n\r\n        // if reservation overlaps with this cell hour\r\n        if (cellEnd > start && cellStart < end) {\r\n          const td = document.querySelector(`.timeline-cell[data-room=\"${roomId}\"][data-hour=\"${h}\"] .cell-inner`);\r\n          if (td) {\r\n            const cls = statusClass[r.status] || 'cell-pending';\r\n            td.classList.add(cls);\r\n            // tooltip text\r\n            td.title = `${r.reserved_by} — ${new Date(r.start_time).toLocaleString()} → ${new Date(r.end_time).toLocaleTimeString()} (${r.status})`;\r\n            // show small label when cell is first hour of reservation\r\n            const hourStart = (new Date(r.start_time)).getHours();\r\n            if (h === hourStart) {\r\n              td.innerHTML = `<div class=\"small text-truncate\"><b>${r.reserved_by}</b></div>`;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // populate My Reservations table\r\n    const tbody = document.getElementById('myReservationsBody');\r\n    tbody.innerHTML = '';\r\n    if (myRows.length === 0) {\r\n      tbody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center text-muted\">No reservations for this date.</td></tr>';\r\n    } else {\r\n      myRows.sort((a,b) => new Date(a.start_time) - new Date(b.start_time));\r\n      for (const r of myRows) {\r\n        const roomObj = rooms.find(x => String(x.id) === String(r.room_id));\r\n        const roomName = roomObj ? `${roomObj.building} › ${roomObj.name}` : `#${r.room_id}`;\r\n        const tr = document.createElement('tr');\r\n        tr.innerHTML = `\r\n          <td>${roomName}</td>\r\n          <td>${new Date(r.start_time).toLocaleString()} - ${new Date(r.end_time).toLocaleTimeString()}</td>\r\n          <td>${r.remarks || r.purpose || '-'}</td>\r\n          <td><span class=\"badge ${r.status === 'Approved' ? 'bg-success' : r.status === 'Pending' ? 'bg-warning text-dark' : 'bg-danger'}\">${r.status}</span></td>\r\n        `;\r\n        tbody.appendChild(tr);\r\n      }\r\n    }\r\n  }\r\n\r\n  function showRoomInfo(roomId) {\r\n    const r = rooms.find(x => String(x.id) === String(roomId));\r\n    if (!r) return;\r\n    document.getElementById('roomInfoTitle').innerText = `${r.building} › ${r.name}`;\r\n    document.getElementById('roomInfoBody').innerHTML = `\r\n      <p><strong>Capacity:</strong> ${r.capacity || '-'} pax</p>\r\n      <p><strong>Location:</strong> ${r.location || '-'}</p>\r\n      <p><strong>Description:</strong><br>${(r.description || '-')}</p>\r\n    `;\r\n    const reserveUrl = \"{{ url_for('reserve', room_id='__ROOMID__') }}\".replace('__ROOMID__', r.id);\r\n    document.getElementById('reserveFromInfo').href = reserveUrl;\r\n    const modal = new bootstrap.Modal(document.getElementById('roomInfoModal'));\r\n    modal.show();\r\n  }\r\n\r\n  // initialize\r\n  document.addEventListener('DOMContentLoaded', function() {\r\n    paintTimeline();\r\n\r\n    // if user changes date -> submit\r\n    document.getElementById('selectedDate').addEventListener('change', function(){ document.getElementById('dateForm').submit(); });\r\n    document.getElementById('goToday').addEventListener('click', function(){ window.location = \"{{ url_for('room_schedule') }}\"; });\r\n\r\n    // daily/weekly quick styling (week not implemented here; placeholder)\r\n    document.getElementById('dailyBtn').addEventListener('click', function(){\r\n      this.classList.add('btn-primary'); document.getElementById('weeklyBtn').classList.remove('btn-primary');\r\n      // if you implement weekly view, load it here\r\n    });\r\n    document.getElementById('weeklyBtn').addEventListener('click', function(){\r\n      this.classList.add('btn-primary'); document.getElementById('dailyBtn').classList.remove('btn-primary');\r\n      Swal.fire({icon:'info', title:'Weekly view', text:'Weekly view is planned (Phase 2).'});\r\n    });\r\n\r\n    // simple tooltips enable\r\n    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'))\r\n    tooltipTriggerList.map(function (el) {\r\n      new bootstrap.Tooltip(el)\r\n    })\r\n  });\r\n</script>\r\n{% endblock %}\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/templates/room_schedule.html b/templates/room_schedule.html
---- a/templates/room_schedule.html	(revision 88ea0e2a6935f03ee9fcf80ca8c7cc66104be9f2)
-+++ b/templates/room_schedule.html	(date 1771415250773)
-@@ -289,4 +289,5 @@
-     })
-   });
- </script>
-+
- {% endblock %}
-Index: .idea/misc.xml
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"Black\">\r\n    <option name=\"sdkName\" value=\"Python 3.13 (WebAXIS Room)\" />\r\n  </component>\r\n  <component name=\"ProjectRootManager\" version=\"2\" project-jdk-name=\"Python 3.13 (WebAxis-Room)\" project-jdk-type=\"Python SDK\" />\r\n</project>
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/.idea/misc.xml b/.idea/misc.xml
---- a/.idea/misc.xml	(revision 88ea0e2a6935f03ee9fcf80ca8c7cc66104be9f2)
-+++ b/.idea/misc.xml	(date 1771417385324)
-@@ -3,5 +3,5 @@
-   <component name="Black">
-     <option name="sdkName" value="Python 3.13 (WebAXIS Room)" />
-   </component>
--  <component name="ProjectRootManager" version="2" project-jdk-name="Python 3.13 (WebAxis-Room)" project-jdk-type="Python SDK" />
-+  <component name="ProjectRootManager" version="2" project-jdk-name="Python 3.13 (WebAXIS Room)" project-jdk-type="Python SDK" />
- </project>
-\ No newline at end of file
-Index: .idea/WebAXIS Room.iml
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<module type=\"PYTHON_MODULE\" version=\"4\">\r\n  <component name=\"NewModuleRootManager\">\r\n    <content url=\"file://$MODULE_DIR$\">\r\n      <excludeFolder url=\"file://$MODULE_DIR$/.venv\" />\r\n    </content>\r\n    <orderEntry type=\"jdk\" jdkName=\"Python 3.13 (WebAxis-Room)\" jdkType=\"Python SDK\" />\r\n    <orderEntry type=\"sourceFolder\" forTests=\"false\" />\r\n  </component>\r\n</module>
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/.idea/WebAXIS Room.iml b/.idea/WebAXIS Room.iml
---- a/.idea/WebAXIS Room.iml	(revision 88ea0e2a6935f03ee9fcf80ca8c7cc66104be9f2)
-+++ b/.idea/WebAXIS Room.iml	(date 1771417385295)
-@@ -4,7 +4,7 @@
-     <content url="file://$MODULE_DIR$">
-       <excludeFolder url="file://$MODULE_DIR$/.venv" />
-     </content>
--    <orderEntry type="jdk" jdkName="Python 3.13 (WebAxis-Room)" jdkType="Python SDK" />
-+    <orderEntry type="jdk" jdkName="Python 3.13 (WebAXIS Room)" jdkType="Python SDK" />
-     <orderEntry type="sourceFolder" forTests="false" />
-   </component>
- </module>
-\ No newline at end of file
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"e38152d8-cf4c-4200-8245-858a548afff2\" name=\"Changes\" comment=\"Room 02/23/2026 Home laptop V2\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/WebAXIS Room.iml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/WebAXIS Room.iml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/misc.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/misc.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/app.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/templates/calendar_view_v2_embed.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/calendar_view_v2_embed.html\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/templates/reserve_v2.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/reserve_v2.html\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Python Script\" />\r\n        <option value=\"CSS File\" />\r\n        <option value=\"HTML File\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;,\r\n    &quot;assignee&quot;: &quot;mrmlvelasco-hue&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">{\r\n  &quot;selectedUrlAndAccountId&quot;: {\r\n    &quot;url&quot;: &quot;https://github.com/mrmlvelasco-hue/WebAxis-Room.git&quot;,\r\n    &quot;accountId&quot;: &quot;5cb6a370-6101-4134-8beb-5de7ec3dd091&quot;\r\n  }\r\n}</component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;associatedIndex&quot;: 1\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"35As1UHHHHOsoksZwy0hDrBZRRd\" />\r\n  <component name=\"ProjectLevelVcsManager\">\r\n    <OptionsSetting value=\"false\" id=\"Update\" />\r\n  </component>\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\"><![CDATA[{\r\n  \"keyToString\": {\r\n    \"DefaultHtmlFileTemplate\": \"HTML File\",\r\n    \"JavaScript Debug.admin.html.executor\": \"Run\",\r\n    \"JavaScript Debug.user_maintenance.html.executor\": \"Run\",\r\n    \"ModuleVcsDetector.initialDetectionPerformed\": \"true\",\r\n    \"Python.PCPPI_Room.executor\": \"Run\",\r\n    \"Python.app.executor\": \"Run\",\r\n    \"RunOnceActivity.ShowReadmeOnStart\": \"true\",\r\n    \"RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252\": \"true\",\r\n    \"RunOnceActivity.git.unshallow\": \"true\",\r\n    \"git-widget-placeholder\": \"master\",\r\n    \"last_opened_file_path\": \"D:/Python Project/WebAxis-Room/static/img\",\r\n    \"list.type.of.created.stylesheet\": \"CSS\",\r\n    \"node.js.detected.package.eslint\": \"true\",\r\n    \"node.js.detected.package.tslint\": \"true\",\r\n    \"node.js.selected.package.eslint\": \"(autodetect)\",\r\n    \"node.js.selected.package.tslint\": \"(autodetect)\",\r\n    \"nodejs_package_manager_path\": \"npm\",\r\n    \"vue.rearranger.settings.migration\": \"true\"\r\n  }\r\n}]]></component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"D:\\Python Project\\WebAxis-Room\\static\\img\" />\r\n    </key>\r\n    <key name=\"MoveFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\mlvelasco\\PycharmProjects\\WebAXIS Room\\templates\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"RunManager\">\r\n    <configuration name=\"PCPPI_Room\" type=\"PythonConfigurationType\" factoryName=\"Python\" temporary=\"true\">\r\n      <module name=\"WebAXIS Room\" />\r\n      <option name=\"ENV_FILES\" value=\"\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"\" />\r\n      <option name=\"SDK_NAME\" value=\"Python 3.13 (WebAXIS Room)\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"false\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/app.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <recent_temporary>\r\n      <list>\r\n        <item itemvalue=\"Python.PCPPI_Room\" />\r\n      </list>\r\n    </recent_temporary>\r\n  </component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-python-sdk-b3d66beaba9a-c6efb3732140-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-252.26199.168\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"e38152d8-cf4c-4200-8245-858a548afff2\" name=\"Changes\" comment=\"\" />\r\n      <created>1762563995612</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1762563995612</updated>\r\n      <workItem from=\"1762563996713\" duration=\"6263000\" />\r\n      <workItem from=\"1762610684125\" duration=\"9930000\" />\r\n      <workItem from=\"1762652964113\" duration=\"42236000\" />\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"Room 11/09/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762653084027</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762653084027</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"Room 11/09/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762687548691</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762687548691</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"Room 11/10/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1762940174210</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1762940174210</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"Room 11/13/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763000122876</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763000122876</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"Room 11/13/2025\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763015848332</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763015848332</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"Room 11/18/2025 office\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763458485226</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763458485226</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00007\" summary=\"Room 11/19/2025 office\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1763544630861</created>\r\n      <option name=\"number\" value=\"00007\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1763544630861</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00008\" summary=\"Room 12/01/2025 office\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1764579364363</created>\r\n      <option name=\"number\" value=\"00008\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00008\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1764579364363</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00009\" summary=\"Room 02/19/2026 Home laptop V2\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1771514418551</created>\r\n      <option name=\"number\" value=\"00009\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00009\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1771514418551</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00010\" summary=\"Room 02/20/2026 Home laptop V2\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1771601194067</created>\r\n      <option name=\"number\" value=\"00010\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00010\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1771601194067</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"11\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"Room 11/09/2025\" />\r\n    <MESSAGE value=\"Room 11/10/2025\" />\r\n    <MESSAGE value=\"Room 11/13/2025\" />\r\n    <MESSAGE value=\"Room 11/18/2025 office\" />\r\n    <MESSAGE value=\"Room 11/19/2025 office\" />\r\n    <MESSAGE value=\"Room 12/01/2025 office\" />\r\n    <MESSAGE value=\"Room 02/19/2026 Home laptop V2\" />\r\n    <MESSAGE value=\"Room 02/20/2026 Home laptop V2\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"Room 02/20/2026 Home laptop V2\" />\r\n  </component>\r\n  <component name=\"XDebuggerManager\">\r\n    <breakpoint-manager>\r\n      <breakpoints>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>482</line>\r\n          <option name=\"timeStamp\" value=\"7\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>728</line>\r\n          <option name=\"timeStamp\" value=\"14\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>267</line>\r\n          <option name=\"timeStamp\" value=\"27\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>2268</line>\r\n          <option name=\"timeStamp\" value=\"28\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>1247</line>\r\n          <option name=\"timeStamp\" value=\"33\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>1881</line>\r\n          <option name=\"timeStamp\" value=\"34\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>834</line>\r\n          <option name=\"timeStamp\" value=\"40\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/app.py</url>\r\n          <line>1178</line>\r\n          <option name=\"timeStamp\" value=\"41\" />\r\n        </line-breakpoint>\r\n      </breakpoints>\r\n    </breakpoint-manager>\r\n  </component>\r\n  <component name=\"com.intellij.coverage.CoverageDataManagerImpl\">\r\n    <SUITE FILE_PATH=\"coverage/WebAXIS_Room$app.coverage\" NAME=\"app Coverage Results\" MODIFIED=\"1762697729366\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"false\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 9c9e35e7e2b5a7fb418301a84c95281fa905afe0)
+++ b/.idea/workspace.xml	(date 1772113380215)
@@ -4,13 +4,12 @@
     <option name="autoReloadType" value="SELECTIVE" />
   </component>
   <component name="ChangeListManager">
-    <list default="true" id="e38152d8-cf4c-4200-8245-858a548afff2" name="Changes" comment="Room 02/23/2026 Home laptop V2">
-      <change beforePath="$PROJECT_DIR$/.idea/WebAXIS Room.iml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/WebAXIS Room.iml" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/.idea/misc.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/misc.xml" afterDir="false" />
+    <list default="true" id="e38152d8-cf4c-4200-8245-858a548afff2" name="Changes" comment="Room 02/24/2026 Home laptop V2">
+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]/Pepsi_logo_Flash.png" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM_[Changes]/shelved.patch" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_2_18_2026_7_46_PM__Changes_.xml" beforeDir="false" />
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/app.py" beforeDir="false" afterPath="$PROJECT_DIR$/app.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/templates/calendar_view_v2_embed.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/calendar_view_v2_embed.html" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/templates/reserve_v2.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/reserve_v2.html" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -52,28 +51,28 @@
     <option name="hideEmptyMiddlePackages" value="true" />
     <option name="showLibraryContents" value="true" />
   </component>
-  <component name="PropertiesComponent"><![CDATA[{
-  "keyToString": {
-    "DefaultHtmlFileTemplate": "HTML File",
-    "JavaScript Debug.admin.html.executor": "Run",
-    "JavaScript Debug.user_maintenance.html.executor": "Run",
-    "ModuleVcsDetector.initialDetectionPerformed": "true",
-    "Python.PCPPI_Room.executor": "Run",
-    "Python.app.executor": "Run",
-    "RunOnceActivity.ShowReadmeOnStart": "true",
-    "RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252": "true",
-    "RunOnceActivity.git.unshallow": "true",
-    "git-widget-placeholder": "master",
-    "last_opened_file_path": "D:/Python Project/WebAxis-Room/static/img",
-    "list.type.of.created.stylesheet": "CSS",
-    "node.js.detected.package.eslint": "true",
-    "node.js.detected.package.tslint": "true",
-    "node.js.selected.package.eslint": "(autodetect)",
-    "node.js.selected.package.tslint": "(autodetect)",
-    "nodejs_package_manager_path": "npm",
-    "vue.rearranger.settings.migration": "true"
+  <component name="PropertiesComponent">{
+  &quot;keyToString&quot;: {
+    &quot;DefaultHtmlFileTemplate&quot;: &quot;HTML File&quot;,
+    &quot;JavaScript Debug.admin.html.executor&quot;: &quot;Run&quot;,
+    &quot;JavaScript Debug.user_maintenance.html.executor&quot;: &quot;Run&quot;,
+    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
+    &quot;Python.PCPPI_Room.executor&quot;: &quot;Run&quot;,
+    &quot;Python.app.executor&quot;: &quot;Run&quot;,
+    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
+    &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,
+    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
+    &quot;git-widget-placeholder&quot;: &quot;master&quot;,
+    &quot;last_opened_file_path&quot;: &quot;D:/Python Project/WebAxis-Room/static/img&quot;,
+    &quot;list.type.of.created.stylesheet&quot;: &quot;CSS&quot;,
+    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
+    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
+    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,
+    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,
+    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,
+    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;
   }
-}]]></component>
+}</component>
   <component name="RecentsManager">
     <key name="CopyFile.RECENT_KEYS">
       <recent name="D:\Python Project\WebAxis-Room\static\img" />
@@ -210,7 +209,15 @@
       <option name="project" value="LOCAL" />
       <updated>1771601194067</updated>
     </task>
-    <option name="localTasksCounter" value="11" />
+    <task id="LOCAL-00011" summary="Room 02/24/2026 Home laptop V2">
+      <option name="closed" value="true" />
+      <created>1771940178183</created>
+      <option name="number" value="00011" />
+      <option name="presentableId" value="LOCAL-00011" />
+      <option name="project" value="LOCAL" />
+      <updated>1771940178183</updated>
+    </task>
+    <option name="localTasksCounter" value="12" />
     <servers />
   </component>
   <component name="TypeScriptGeneratedFilesManager">
@@ -225,7 +232,8 @@
     <MESSAGE value="Room 12/01/2025 office" />
     <MESSAGE value="Room 02/19/2026 Home laptop V2" />
     <MESSAGE value="Room 02/20/2026 Home laptop V2" />
-    <option name="LAST_COMMIT_MESSAGE" value="Room 02/20/2026 Home laptop V2" />
+    <MESSAGE value="Room 02/24/2026 Home laptop V2" />
+    <option name="LAST_COMMIT_MESSAGE" value="Room 02/24/2026 Home laptop V2" />
   </component>
   <component name="XDebuggerManager">
     <breakpoint-manager>
@@ -237,7 +245,7 @@
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/app.py</url>
-          <line>728</line>
+          <line>846</line>
           <option name="timeStamp" value="14" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
@@ -247,27 +255,27 @@
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/app.py</url>
-          <line>2268</line>
+          <line>2386</line>
           <option name="timeStamp" value="28" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/app.py</url>
-          <line>1247</line>
+          <line>1365</line>
           <option name="timeStamp" value="33" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/app.py</url>
-          <line>1881</line>
+          <line>1999</line>
           <option name="timeStamp" value="34" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/app.py</url>
-          <line>834</line>
+          <line>952</line>
           <option name="timeStamp" value="40" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/app.py</url>
-          <line>1178</line>
+          <line>1296</line>
           <option name="timeStamp" value="41" />
         </line-breakpoint>
       </breakpoints>
