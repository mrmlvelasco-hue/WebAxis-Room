{% extends "base_dashboard.html" %}
{% block title %}Room Maintenance | WebAXIS{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold text-primary"><i class="bi bi-building-gear me-2"></i> Room Maintenance</h3>
    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addRoomModal">
      <i class="bi bi-plus-lg"></i> Add Room
    </button>
  </div>

  <div class="table-responsive shadow-sm">
    <table class="table table-sm table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Location</th>
          <th>Group Code</th>
          <th>Capacity</th>
          <th>Approver</th>
          <th>Combined</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for r in rooms %}
        <tr>
          <td>{{ r.id }}</td>
          <td>{{ r.name }}</td>
          <td>{{ r.location or '—' }}</td>
          <td>{{ r.group_code or '—' }}</td>
          <td>{{ r.capacity or 0 }}</td>
          <td>{{ r.approver or '—' }}</td>
          <td>{{ 'Yes' if r.is_combined else 'No' }}</td>
          <td>{{ r.status }}</td>
          <td class="text-end">
            <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editModal{{ r.id }}">Edit</button>
            <a href="{{ url_for('deactivate_room', id=r.id) }}" class="btn btn-outline-danger btn-sm">Deactivate</a>
          </td>
        </tr>

        <!-- Edit Modal -->
        <div class="modal fade" id="editModal{{ r.id }}" tabindex="-1">
          <div class="modal-dialog">
            <form class="modal-content" method="post" action="{{ url_for('edit_room', id=r.id) }}">
              <div class="modal-header">
                <h5 class="modal-title">Edit Room</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-2"><label class="form-label">Name</label><input name="name" value="{{ r.name }}" class="form-control" required></div>
                <div class="mb-2"><label class="form-label">Location</label><input name="location" value="{{ r.location }}" class="form-control"></div>
                <div class="mb-2"><label class="form-label">Group Code</label><input name="group_code" value="{{ r.group_code }}" class="form-control"></div>
                <div class="mb-2"><label class="form-label">Capacity</label><input name="capacity" type="number" value="{{ r.capacity }}" class="form-control"></div>
                <div class="form-check mb-2"><input class="form-check-input" type="checkbox" name="is_combined" {% if r.is_combined %}checked{% endif %}><label class="form-check-label">Is Combined</label></div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-primary">Save</button>
              </div>
            </form>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Add Room Modal -->
<div class="modal fade" id="addRoomModal" tabindex="-1">
  <div class="modal-dialog">
    <form class="modal-content" method="post" action="{{ url_for('add_room') }}">
      <div class="modal-header">
        <h5 class="modal-title">Add Room</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2"><label class="form-label">Name</label><input name="name" class="form-control" required></div>
        <div class="mb-2"><label class="form-label">Location</label><input name="location" class="form-control"></div>
        <div class="mb-2"><label class="form-label">Group Code</label><input name="group_code" class="form-control"></div>
        <div class="mb-2"><label class="form-label">Capacity</label><input name="capacity" type="number" class="form-control"></div>
        <div class="mb-2"><label class="form-label">Approver (username)</label><input name="approver" class="form-control"></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" name="is_combined"><label class="form-check-label">Is Combined</label></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary">Add Room</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
