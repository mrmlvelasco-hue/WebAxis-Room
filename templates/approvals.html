{% extends "base_dashboard.html" %}
{% block title %}Approvals | WebAXIS{% endblock %}

{% block content %}
<div class="container-fluid py-4">

  <h2 class="fw-bold mb-3">
    <i class="bi bi-clipboard-check"></i> Pending Approvals
    <span class="badge bg-primary ms-2">{{ pending_count }}</span>
  </h2>

  <!-- FILTER BAR -->
  <form method="GET" class="row g-2 mb-4">
      {% if assigned_locations %}
        <div class="mb-3">
          <span class="fw-bold">Your Assigned Locations:</span>
          {% for loc in assigned_locations %}
            <span class="badge bg-secondary ms-1">{{ loc }}</span>
          {% endfor %}
        </div>
        {% endif %}

    <div class="col-md-3">
      <select name="location" class="form-select">
        <option value="">All Locations</option>
        {% for loc in locations %}
          <option value="{{ loc }}" {% if filter_location == loc %}selected{% endif %}>{{ loc }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <select name="room" class="form-select">
        <option value="">All Rooms</option>
        {% for rm in rooms %}
          <option value="{{ rm }}" {% if filter_room == rm %}selected{% endif %}>{{ rm }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-2">
      <input type="date" name="date" class="form-control" value="{{ filter_date }}">
    </div>

    <div class="col-md-3">
      <input type="text" name="search" class="form-control" placeholder="Search…" value="{{ search_text }}">
    </div>

    <div class="col-md-1">
      <button class="btn btn-primary w-100"><i class="bi bi-search"></i></button>
    </div>

  </form>

  {% if reservations %}
  <div class="list-group">

    {% for r in reservations %}
    <div class="list-group-item p-3 mb-2 rounded shadow-sm">

      <div class="d-flex justify-content-between align-items-start flex-wrap">

        <!-- LEFT SIDE -->
        <div class="me-3">

          <!-- ROOM + LOCATION -->
          <div class="fw-bold fs-5 mb-1">
            {{ r.room_name }}
            <span class="badge bg-info text-dark ms-2">{{ r.location }}</span>
          </div>

          <!-- RESERVED BY -->
          <div class="text-muted small">
            Requested by: <span class="fw-semibold">{{ r.reserved_by }}</span>
          </div>

          <!-- SCHEDULE -->
          <div class="small mt-1">
            <i class="bi bi-calendar-event"></i>
            {{ r.start_time }} → {{ r.end_time }}
          </div>

          <!-- REMARKS -->
          <div class="mt-2">
            <span class="text-muted small">Remarks:</span><br>
            <span>{{ r.remarks or '—' }}</span>
          </div>

        </div>

        <!-- RIGHT SIDE -->
        <div class="text-end mt-2">

          <form action="{{ url_for('approve_reservation', res_id=r.id) }}" method="post" class="d-inline">
            <button class="btn btn-success btn-sm px-3">
              <i class="bi bi-check-circle"></i> Approve
            </button>
          </form>

          <form action="{{ url_for('deny_reservation', res_id=r.id) }}" method="post" class="d-inline ms-1">
            <button class="btn btn-danger btn-sm px-3">
              <i class="bi bi-x-circle"></i> Deny
            </button>
          </form>

        </div>

      </div>

    </div>
    {% endfor %}

  </div>

  {% else %}
    <div class="alert alert-info shadow-sm">
      No pending approvals match your filters.
    </div>
  {% endif %}

</div>
{% endblock %}
