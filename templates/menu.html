{% extends "base.html" %}
{% block title %}Dashboard | WebAXIS RoomSys{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-5">
  <div class="text-center mb-5">
    <h1 class="fw-bold">üìä WebAXIS Room Reservation Dashboard</h1>
      <div class="alert alert-light border rounded shadow-sm mt-3 mb-4 p-3" role="alert">
  <div class="d-flex justify-content-between align-items-center flex-wrap">
    <div><strong>{{ db_status }}</strong></div>
    <div><strong>{{ ad_status }}</strong></div>
    <div><strong>üë§ Logged in as:</strong> {{ user_info }}</div>
  </div>
</div>

    <p class="text-muted">Quick overview of current booking statistics and trends.</p>
  </div>

  <!-- KPI Cards -->
  <div class="row g-4 mb-5">
    <div class="col-md-3">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h5 class="text-muted">Total Rooms</h5>
          <h2 class="fw-bold text-primary">{{ room_count }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h5 class="text-muted">Pending</h5>
          <h2 class="fw-bold text-warning">{{ pending_count }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h5 class="text-muted">Approved</h5>
          <h2 class="fw-bold text-success">{{ approved_count }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h5 class="text-muted">Cancelled</h5>
          <h2 class="fw-bold text-danger">{{ cancelled_count }}</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Reservation Trend Chart -->
  <div class="card shadow-sm border-0 mb-5">
    <div class="card-body">
      <h5 class="fw-bold text-dark mb-3">üìÖ Reservation Activity (Last 7 Days)</h5>
      <canvas id="reservationChart" height="100"></canvas>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row justify-content-center g-4">
    <div class="col-md-4">
      <div class="card text-center border-0 shadow h-100 hover-card">
        <div class="card-body">
          <h4 class="card-title mb-3">üìã View Rooms</h4>
          <a href="{{ url_for('room_list') }}" class="btn btn-primary w-100">Go</a>

        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card text-center border-0 shadow h-100 hover-card">
        <div class="card-body">
          <h4 class="card-title mb-3">üßë‚Äçüíº Manage Reservations</h4>
          <a href="{{ url_for('admin_dashboard') }}" class="btn btn-success w-100">Open</a>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card text-center border-0 shadow h-100 hover-card">
        <div class="card-body">
          <h4 class="card-title mb-3">‚úÖ Confirm Reservation</h4>
          <a href="{{ url_for('confirm') }}" class="btn btn-info w-100">View</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('reservationChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: {{ chart_labels|tojson }},
    datasets: [
      {
        label: 'Approved',
        data: {{ chart_approved|tojson }},
        backgroundColor: 'rgba(46, 204, 113, 0.8)'
      },
      {
        label: 'Pending',
        data: {{ chart_pending|tojson }},
        backgroundColor: 'rgba(241, 196, 15, 0.8)'
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'top' },
      title: {
        display: false
      }
    },
    scales: {
      x: {
        grid: { display: false },
        ticks: { font: { size: 12 } }
      },
      y: {
        beginAtZero: true,
        ticks: { stepSize: 1 }
      }
    }
  }
});
</script>

<style>
.hover-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.hover-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}
</style>
{% endblock %}
