{% extends "base_dashboard.html" %}
{% block title %}Dashboard | WebAXIS{% endblock %}

{% block content %}
<h2 class="fw-bold page-title mb-4">
  <i class="bi bi-graph-up-arrow"></i> WebAXIS Room Reservation Dashboard

</h2>

<!-- KPI Cards -->
<div class="row g-3 mb-4">
  <div class="col-12 col-md-3">
    <div class="card text-center p-4">
      <h6 class="fw-semibold text-secondary mb-2"><i class="bi bi-building"></i> Total Rooms</h6>
      <h2 class="text-primary mb-0">{{ room_count }}</h2>
    </div>
  </div>
  <div class="col-12 col-md-3">
    <div class="card text-center p-4">
      <h6 class="fw-semibold text-secondary mb-2"><i class="bi bi-hourglass-split"></i> Pending</h6>
      <h2 class="text-warning mb-0">{{ pending_count }}</h2>
    </div>
  </div>
  <div class="col-12 col-md-3">
    <div class="card text-center p-4">
      <h6 class="fw-semibold text-secondary mb-2"><i class="bi bi-check-circle-fill"></i> Approved</h6>
      <h2 class="text-success mb-0">{{ approved_count }}</h2>
    </div>
  </div>
  <div class="col-12 col-md-3">
    <div class="card text-center p-4">
      <h6 class="fw-semibold text-secondary mb-2"><i class="bi bi-x-circle-fill"></i> Cancelled</h6>
      <h2 class="text-danger mb-0">{{ cancelled_count }}</h2>
    </div>
  </div>
</div>

<!-- Chart Section -->
<div class="card p-4 mb-5">
  <h5 class="fw-bold mb-3">
    <i class="bi bi-calendar-week"></i> Reservation Activity (Last 7 Days)
  </h5>
  <canvas id="reservationChart" height="120"></canvas>
</div>

<div class="footer">
  Â© 2025 PCPPI | WebAXIS Room Reservation System
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let reservationChart;

function renderReservationChart(isDarkMode) {
  const ctx = document.getElementById('reservationChart').getContext('2d');

  const chartColors = {
    pending: isDarkMode ? '#ffcc00' : '#ffc107',
    approved: isDarkMode ? '#4dd599' : '#198754',
    text: isDarkMode ? '#ddd' : '#333',
    grid: isDarkMode ? '#444' : '#ccc',
  };

  if (reservationChart) {
    reservationChart.destroy();
  }

  reservationChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ chart_labels|tojson }},
      datasets: [
        {
          label: 'Pending',
          data: {{ chart_pending|tojson }},
          backgroundColor: chartColors.pending,
        },
        {
          label: 'Approved',
          data: {{ chart_approved|tojson }},
          backgroundColor: chartColors.approved,
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
          labels: { color: chartColors.text, font: { size: 12 } }
        }
      },
      scales: {
        x: {
          grid: { color: chartColors.grid },
          ticks: { color: chartColors.text }
        },
        y: {
          beginAtZero: true,
          grid: { color: chartColors.grid },
          ticks: { color: chartColors.text, stepSize: 1 }
        }
      }
    }
  });
}

// === Initial render based on theme ===
document.addEventListener('DOMContentLoaded', () => {
  const isDarkMode = document.body.classList.contains('dark-mode');
  renderReservationChart(isDarkMode);
});

// === Re-render chart when theme toggled ===
document.getElementById('toggleTheme').addEventListener('click', () => {
  setTimeout(() => {
    const isDarkMode = document.body.classList.contains('dark-mode');
    renderReservationChart(isDarkMode);
  }, 200);
});
</script>
{% endblock %}
