{% extends "base_dashboard.html" %}
{% block title %}User Maintenance | WebAXIS{% endblock %}

{% block content %}
<div class="card shadow-sm p-4 mb-4">
  <!-- Header -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
    <h2 class="fw-bold page-title mb-2 mb-md-0">
      <i class="bi bi-person-check"></i> User Maintenance
    </h2>

    <a href="{{ url_for('main_menu') }}" class="btn btn-outline-secondary fw-semibold back-btn">
      <i class="bi bi-arrow-left"></i> Back to Dashboard
    </a>
  </div>

  <!-- Add User Form -->
  <div class="card p-4 border-0 mb-4 user-form-card">
    <h5 class="fw-semibold mb-3"><i class="bi bi-person-plus"></i> Add New User</h5>

    <form method="POST" action="{{ url_for('user_maintenance') }}">
  <div class="row g-3">
    <div class="col-md-3">
      <input type="text" name="username" class="form-control" placeholder="Domain Username" required>
    </div>
    <div class="col-md-3">
      <input type="text" name="display_name" class="form-control" placeholder="Display Name" required>
    </div>
    <div class="col-md-3">
      <input type="email" name="email" class="form-control" placeholder="Email" required>
    </div>
    <div class="col-md-2">
      <select name="role" class="form-select">
        <option value="user" selected>User</option>
        <option value="admin">admin</option>
      </select>
    </div>
    <div class="col-md-1">
      <select name="status" class="form-select">
        <option value="active" selected>Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>
  </div>
<!-- Assigned Locations -->
<div class="mb-3">
    <label class="form-label fw-bold">Assigned Locations</label>
    <select name="locations" class="form-select" multiple>
        {% for loc in locations %}
            <option value="{{ loc }}">{{ loc }}</option>
        {% endfor %}
    </select>
    <div class="form-text">Select one or more locations this user belongs to.</div>
</div>

<!-- Approver for Locations -->
<div class="mb-3">
    <label class="form-label fw-bold">Approver for Locations</label>
    <div class="row">
        {% for loc in locations %}
        <div class="col-4">
            <div class="form-check">
                <input class="form-check-input" type="checkbox"
                       name="approver_locations" value="{{ loc }}">
                <label class="form-check-label">{{ loc }}</label>
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="form-text">Tick locations where this user should serve as approver.</div>
</div>

  <div class="mt-3 text-end">
    <button type="submit" class="btn btn-primary fw-semibold px-4">
      <i class="bi bi-person-plus"></i> Add User
    </button>
  </div>
</form>

  </div>

  <!-- Registered Users -->
  <div class="card p-4 border-0 user-table-card">
  <h5 class="fw-semibold mb-3"><i class="bi bi-people"></i> Registered Users</h5>

  <div class="table-responsive">
    <table class="table table-hover align-middle table-bordered">
      <thead class="table-primary text-center">
        <tr>
          <th>Username</th>
          <th>Display Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th>Last Login</th>
          <th>IP</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.display_name }}</td>
          <td>{{ user.email }}</td>
          <td class="text-center">{{ user.role|capitalize }}</td>
          <td class="text-center">
            {% if user.status == 'active' %}
              <span class="badge bg-success">Active</span>
            {% else %}
              <span class="badge bg-secondary">Inactive</span>
            {% endif %}
          </td>
          <td>{{ user.last_login or 'N/A' }}</td>
          <td>{{ user.ip or '-' }}</td>
          <td class="text-center">
            <a href="{{ url_for('user_edit', user_id=user.id) }}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-pencil"></i> Edit
            </a>
            <a href="{{ url_for('delete_user', user_id=user.id) }}" class="btn btn-outline-danger btn-sm">
              <i class="bi bi-trash"></i> Delete
            </a>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="8" class="text-center text-muted">No registered users.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

</div>
{% endblock %}
